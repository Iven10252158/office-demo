(this["webpackJsonpmochar-viewer"]=this["webpackJsonpmochar-viewer"]||[]).push([[0],{179:function(e,t,n){},231:function(e,t,n){},232:function(e,t,n){},293:function(e,t,n){},295:function(e,t,n){},296:function(e,t,n){},297:function(e,t,n){},299:function(e,t,n){},322:function(e){e.exports=JSON.parse('{"name":"mochar-viewer","version":"1.2.0","private":true,"dependencies":{"@apollo/client":"^3.2.9","@emotion/core":"^11.0.0","@emotion/react":"^11.4.1","@emotion/styled":"^11.3.0","@fortawesome/fontawesome-svg-core":"^1.2.32","@fortawesome/free-brands-svg-icons":"^5.15.1","@fortawesome/free-solid-svg-icons":"^5.15.1","@fortawesome/react-fontawesome":"^0.1.14","@material-ui/core":"^4.12.2","@material-ui/icons":"^4.11.2","@material-ui/lab":"^4.0.0-alpha.60","@testing-library/jest-dom":"^5.11.4","@testing-library/react":"^11.1.0","@testing-library/user-event":"^12.1.10","@tweenjs/tween.js":"^18.6.4","@types/animejs":"^3.1.2","@types/jest":"^26.0.15","@types/node":"^12.0.0","@types/react":"^16.9.53","@types/react-dom":"^16.9.8","@vimeo/player":"^2.14.1","add":"^2.0.6","agora-rtc-sdk-ng":"^4.11.1","agora-rtm-sdk":"^1.4.3","animejs":"^3.2.1","axios":"^0.21.1","chroma-js":"^2.4.2","classnames":"^2.3.1","eventemitter3":"^4.0.7","firebase":"^8.8.0","graphql":"^15.4.0","i18next":"^19.8.4","is-ua-webview":"^1.0.5","lil-gui":"^0.16.1","postprocessing":"^6.25.0","react":"^17.0.1","react-device-detect":"^1.17.0","react-dom":"^17.0.1","react-i18next":"^11.8.5","react-page-visibility":"^6.4.0","react-redux":"^7.2.4","react-router-dom":"^5.2.0","react-scripts":"4.0.2","redux-thunk":"^2.3.0","set-interval-async":"^2.0.3","stats.js":"^0.17.0","talkjs":"^0.15.4","three":"^0.124.0","three-plain-animator":"^1.0.6","typescript":"^4.0.3","web-vitals":"^0.2.4","youtube-player":"^5.5.2"},"scripts":{"start":"REACT_APP_STAGE=dev react-scripts start --host 0.0.0.0","sdk":"REACT_APP_STAGE=sdk GENERATE_SOURCEMAP=false PUBLIC_URL=/3dviewer react-scripts build","build":"REACT_APP_STAGE=prod GENERATE_SOURCEMAP=false react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},324:function(e,t,n){"use strict";n.r(t);var i,a,o,r,s=n(2),c=n.n(s),u=n(39),l=n.n(u),h=(n(231),n(15)),d=(n(232),n(18)),p=n(3),f=n.n(p),v=n(9),m=n(4),b=n(5),g=n(0),y=n(23),w=n(61),x=n(14),O=n(217),j=n(364),k=n(366),M=n(365),A=n(183),E=Object(A.a)((function(e,t){var n=t.headers,i="eyJhbGciOiJSUzI1NiIsImtpZCI6IjNlNTQyN2NkMzUxMDhiNDc2NjUyMDhlYTA0YjhjYTZjODZkMDljOTMiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vdnJtYWtlci1wcm8tZGV2IiwiYXVkIjoidnJtYWtlci1wcm8tZGV2IiwiYXV0aF90aW1lIjoxNjA2MDM1NzY2LCJ1c2VyX2lkIjoiTlNieEc3ZVFrN2JFQzRCTjY5ZVREZVZhWDlFMiIsInN1YiI6Ik5TYnhHN2VRazdiRUM0Qk42OWVURGVWYVg5RTIiLCJpYXQiOjE2MDYwMzU3NjYsImV4cCI6MTYwNjAzOTM2NiwiZW1haWwiOiJpc3RhZ2luZ0BudHVzdC5vcmcudHciLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZW1haWwiOlsiaXN0YWdpbmdAbnR1c3Qub3JnLnR3Il19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.hLKMwW6Qa2-XiWzI16E1m2a7drK-YrKriYIk3xc6dFIymNG2azUzicftNyuVGovKyfMT08miV4qHiHoUWgmZUxhAropHiH6dpoIVMtp0O4OkP98cVlLDeUtGyZS3sueGDHpd1Ge4WjvY6aoUriCkY-PW6rIAyioMRWAcIcq4DrE_tjHHAT0jpWrJGEo39swyGjogzEraaZ1zuYyuL7UD96Iv7QE-xxHgDFmStoJEe0YP6cWMoH6d_620iaTI_UuK7zwoYdDta_3njq5OSaeCBV7FfRDVGocZ4npS3rztmKV4dxmyfFTKsVS5ZV_GhhbHh7hTen9sQK-HrzfgL723aA";return{headers:Object(x.a)(Object(x.a)({},n),{},{authorization:"Bearer ".concat(i)})}})),T=Object(O.a)({uri:"https://mochar.herokuapp.com/graphql"}),C=function(){function e(){Object(m.a)(this,e),this.client=void 0,this.client=new j.a({link:E.concat(T),cache:new k.a})}return Object(b.a)(e,[{key:"get",value:function(e,t,n){n(this.client.query({query:Object(M.a)(i||(i=Object(w.a)(["",""])),e),variables:t}))}},{key:"getAsync",value:function(e,t){return this.client.query({query:Object(M.a)(a||(a=Object(w.a)(["",""])),e),variables:t})}},{key:"write",value:function(e,t){this.client.writeQuery({query:Object(M.a)(o||(o=Object(w.a)(["",""])),e),data:t})}}]),e}(),S=n(185),I=n(186),P=n.n(I);n(58);g.p.enabled=!0,function(e){e[e.Image=0]="Image",e[e.Model=1]="Model",e[e.Music=2]="Music",e[e.Video=3]="Video",e[e.Cubemap=4]="Cubemap",e[e.Texture=5]="Texture",e[e.Preload=6]="Preload"}(r||(r={}));var R=function(){function e(){Object(m.a)(this,e),this.gltfLoader=new S.a,this.cubeTextuerLoader=new g.y,this.textureloader=new g.qc,this.mediaResources={},this.videoResources={}}return Object(b.a)(e,[{key:"load",value:function(e,t,n){switch(t){case r.Preload:return this.preloadCubeMap(e);case r.Cubemap:return this.loadCubeMap(e);case r.Texture:return this.loadTexture(e);case r.Image:case r.Model:return this.loadModel(e,n);case r.Music:case r.Video:return this.loadVideo(e)}}},{key:"loadTexture",value:function(e){var t=this;return new Promise((function(n){t.textureloader.load(e,(function(e){e.encoding=g.M,n(e)}))}))}},{key:"loadModel",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gltfLoader.loadAsync(t,n||null);case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadEnvCubeMap",value:function(e){var t,n=e.skybox,i=[n[2],n[4],n[0],n[5],n[1],n[3]].map((function(e){var t=(new g.qc).load(e);return t.encoding=g.M,new g.tb({map:t,side:g.E,combine:0,transparent:!0})})),a=new g.l(1e4,1e4,1e4),o=new g.sb(a,i);return e.shiftY&&(o.position.y=e.shiftY),o.userData.animation=null!==(t=e.animation)&&void 0!==t&&t,o}},{key:"loadCubeMap",value:function(e){var t=this,n=[e[2],e[4],e[0],e[5],e[1],e[3]];return new Promise((function(e){t.cubeTextuerLoader.load(n,e)}))}},{key:"preloadCubeMap",value:function(e){var t=[e[2],e[4],e[0],e[5],e[1],e[3]],n=[];return t.forEach((function(e){var t=P.a.get(e);n.push(t)})),Promise.all(n)}},{key:"removeVideo",value:function(e){e.pause(),e.removeAttribute("src"),e.load()}},{key:"loadVideo",value:function(e){return new Promise((function(t,n){void 0===e&&n();var i=document.createElement("video"),a=document.createElement("source");i.setAttribute("playsinline",""),a.src=e,a.type="video/mp4",i.crossOrigin="anonymous",i.loop=!0,i.muted=!0,i.appendChild(a),i.load(),i.addEventListener("loadedmetadata",(function(e){t({video:i,width:this.videoWidth,height:this.videoHeight})}),!1)}))}}]),e}(),D=n(12),B=n(10),L=n(6),N=n(7),z=function(e,t){this.panConstrain=function(e,t){return!0},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new g.Bc,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:g.ob.LEFT,MIDDLE:g.ob.MIDDLE,RIGHT:g.ob.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.onZoom=function(){},this.onPan=function(){},this.getPolarAngle=function(){return u.phi},this.dollyOut=function(e){I(e)},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),s=r.NONE},this.update=function(){var t=new g.Bc,a=(new g.Sb).setFromUnitVectors(e.up,new g.Bc(0,1,0)),o=a.clone().invert(),f=new g.Bc,v=new g.Sb;return function(){var e=n.object.position;return t.copy(e).sub(n.target),t.applyQuaternion(a),u.setFromVector3(t),n.autoRotate&&s===r.NONE&&M(2*Math.PI/60/60*n.autoRotateSpeed),u.theta+=l.theta,u.phi+=l.phi,u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=h,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===this.panConstrain(n.target,d)&&n.target.add(d),t.setFromSpherical(u),t.applyQuaternion(o),e.copy(n.target).add(t),n.object.isPerspectiveCamera&&n.object.lookAt(n.target),!0===n.enableDamping?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),h=1,!!(p||f.distanceToSquared(n.object.position)>c||8*(1-v.dot(n.object.quaternion))>c)&&(n.dispatchEvent(i),f.copy(n.object.position),v.copy(n.object.quaternion),p=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",V,!1),n.domElement.removeEventListener("mousedown",R,!1),n.domElement.removeEventListener("wheel",L,!1),n.domElement.removeEventListener("touchstart",z,!1),n.domElement.removeEventListener("touchend",H,!1),n.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",D,!1),document.removeEventListener("mouseup",B,!1),window.removeEventListener("keydown",N,!1)};var n=this,i={type:"change"},a={type:"start"},o={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},s=r.NONE,c=1e-6,u=new g.kc,l=new g.kc,h=1,d=new g.Bc,p=!1,f=new g.Ac,v=new g.Ac,m=new g.Ac,b=new g.Ac,y=new g.Ac,w=new g.Ac,x=new g.Ac,O=new g.Ac,j=new g.Ac;function k(){return Math.pow(.95,n.zoomSpeed)}function M(e){l.theta-=e}function A(e){l.phi-=e}var E=function(){var e=new g.Bc;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}}(),T=function(){var e=new g.Bc;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),C=function(){var e=new g.Bc;return function(t,i){var a=n.domElement===document?n.domElement.body:n.domElement;if(n.object.isPerspectiveCamera){var o=n.object.position;e.copy(o).sub(n.target);var r=e.length();r*=Math.tan(n.object.fov/2*Math.PI/180),E(2*t*r/a.clientHeight,n.object.matrix),T(2*i*r/a.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(E(t*(n.object.right-n.object.left)/n.object.zoom/a.clientWidth,n.object.matrix),T(i*(n.object.top-n.object.bottom)/n.object.zoom/a.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function S(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),p=!0,n.onZoom()):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),p=!0,n.onZoom()):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function P(e){b.set(e.clientX,e.clientY)}function R(e){if(!1!==n.enabled){switch(e.preventDefault(),null!==n.domElement.focus?n.domElement.focus():window.focus(),e.button){case n.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;P(e),s=r.PAN}else{if(!1===n.enableRotate)return;!function(e){f.set(e.clientX,e.clientY)}(e),s=r.ROTATE}break;case n.mouseButtons.MIDDLE:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY)}(e),s=r.DOLLY;break;case n.mouseButtons.RIGHT:if(!1===n.enablePan)return;P(e),s=r.PAN}s!==r.NONE&&(document.addEventListener("mousemove",D,!1),document.addEventListener("mouseup",B,!1),n.dispatchEvent(a))}}function D(e){if(!1!==n.enabled)switch(e.preventDefault(),s){case r.ROTATE:if(!1===n.enableRotate)return;!function(e){v.set(e.clientX,e.clientY),m.subVectors(v,f).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*m.x/t.clientHeight),A(2*Math.PI*m.y/t.clientHeight),f.copy(v),n.update()}(e);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(e){O.set(e.clientX,e.clientY),j.subVectors(O,x),j.y>0?S(k()):j.y<0&&I(k()),x.copy(O),n.update()}(e);break;case r.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),w.subVectors(y,b).multiplyScalar(n.panSpeed),C(w.x,w.y),b.copy(y),n.update(),n.onPan()}(e)}}function B(e){!1!==n.enabled&&(document.removeEventListener("mousemove",D,!1),document.removeEventListener("mouseup",B,!1),n.dispatchEvent(o),s=r.NONE)}function L(e){!1===n.enabled||!1===n.enableZoom||s!==r.NONE&&s!==r.ROTATE||(e.preventDefault(),e.stopPropagation(),n.dispatchEvent(a),function(e){e.deltaY<0?I(k()):e.deltaY>0&&S(k()),n.update()}(e),n.dispatchEvent(o))}function N(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&function(e){var t=!1;switch(e.keyCode){case n.keys.UP:C(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:C(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:C(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:C(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function z(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===n.enableRotate)return;!function(e){f.set(e.touches[0].pageX,e.touches[0].pageY)}(e),s=r.TOUCH_ROTATE;break;case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){if(n.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);x.set(0,a)}if(n.enablePan){var o=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(o,r)}}(e),s=r.TOUCH_DOLLY_PAN;break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(a)}}function U(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===n.enableRotate)return;if(s!==r.TOUCH_ROTATE)return;!function(e){v.set(e.touches[0].pageX,e.touches[0].pageY),m.subVectors(v,f).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;M(2*Math.PI*m.x/t.clientHeight),A(2*Math.PI*m.y/t.clientHeight),f.copy(v),n.update()}(e);break;case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;if(s!==r.TOUCH_DOLLY_PAN)return;!function(e){if(n.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);O.set(0,a),j.set(0,Math.pow(O.y/x.y,n.zoomSpeed)),S(j.y),x.copy(O)}if(n.enablePan){var o=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(o,r),w.subVectors(y,b).multiplyScalar(n.panSpeed),C(w.x,w.y),b.copy(y)}n.update()}(e);break;default:s=r.NONE}}function H(e){!1!==n.enabled&&(n.dispatchEvent(o),s=r.NONE)}function V(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",V,!1),n.domElement.addEventListener("mousedown",R,!1),n.domElement.addEventListener("mouseout",(function(e){s!==r.NONE&&B(e)}),!1),n.domElement.addEventListener("wheel",L,!1),n.domElement.addEventListener("touchstart",z,!1),n.domElement.addEventListener("touchend",H,!1),n.domElement.addEventListener("touchmove",U,!1),this.update()};(z.prototype=Object.create(g.H.prototype)).constructor=z,Object.defineProperties(z.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var U,H=z,V=n(59),F=n(187),_=n(26),W=n(46),G=n.n(W),Y=n(137),Z="SET_THREE_VIEW",J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===Z?t.payload:e},K="SET_SCENE",q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===K?t.payload:e},X="SET_Floors",Q=function(e){return{type:X,payload:Object.entries(e).map((function(e){var t=Object(h.a)(e,2),n=t[0],i=t[1];return{id:n,name:i.name,azimuthAngle:i.azimuthAngle,polarAngle:i.polarAngle}}))}},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===X?t.payload:e},ee="SET_IFRAME_HANDLE";!function(e){e[e.sceneinfo=0]="sceneinfo",e[e.taginfo=1]="taginfo",e[e.progressbar=2]="progressbar",e[e.sceneready=3]="sceneready",e[e.userhasinteract=4]="userhasinteract",e[e.createobject=5]="createobject",e[e.deleteobject=6]="deleteobject",e[e.selectobject=7]="selectobject",e[e.setmovemode=8]="setmovemode",e[e.setdollhousemode=9]="setdollhousemode",e[e.opencomponent=10]="opencomponent",e[e.opentag=11]="opentag",e[e.closecomponent=12]="closecomponent",e[e.floortransition=13]="floortransition",e[e.sendmessageboxwarning=14]="sendmessageboxwarning",e[e.membercount=15]="membercount",e[e.memberjoin=16]="memberjoin",e[e.memberleave=17]="memberleave",e[e.memberupdated=18]="memberupdated",e[e.memberfollow=19]="memberfollow",e[e.memberclick=20]="memberclick"}(U||(U={}));var te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===ee?t.payload:e},ne=n(62),ie=n(151);n(325);ie.a.initializeApp({apiKey:"AIzaSyDAJOFRKPuO0NIAcvs6koF6cPstlkIUpDQ",authDomain:"mochar-dad76.firebaseapp.com",projectId:"mochar-dad76",storageBucket:"mochar-dad76.appspot.com",messagingSenderId:"855274896471",appId:"1:855274896471:web:296113e1e4c290bbe37712",measurementId:"G-QNMHV9HJH5"});ie.a.firestore();var ae,oe="SET_USER";!function(e){e.audience="audience",e.participant="participant",e.host="host"}(ae||(ae={}));var re,se=function(e){return{type:oe,payload:e}},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.type===oe?[].concat(Object(ne.a)(e),[t.payload]):e},ue="SET_AVATARS",le=function(e){return{type:ue,payload:e}},he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.type===ue?t.payload:e},de="SET_AVATAR_MODE",pe=function(e){return{type:de,payload:e}},fe=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===de?t.payload:e},ve="SET_PRODUCT",me=function(e){return{type:ve,payload:e}},be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return t.type===ve?[].concat(Object(ne.a)(e),[t.payload]):e},ge="SET_PRODUCT_CATALOG",ye="SET_SYNC",we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{productCatalog:!1,sync:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ge:return{productCatalog:t.payload,sync:e.sync};case ye:return{productCatalog:e.productCatalog,sync:t.payload};default:return e}},xe="SET_LAST_TAG",Oe=function(e,t){return{type:xe,payload:{tag:e,visible:t}}},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===xe?t.payload:e},ke="SET_CAPTURE",Me=function(e){return{type:ke,payload:{capture:e}}},Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return t.type===ke?t.payload.capture:e},Ee="SET_CAMERA_DEVICE",Te=function(e,t){return{type:Ee,payload:{videoTrack:e,audioTrack:t}}},Ce=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0;return i.type===Ee?{audioTrack:null!==(e=i.payload.audioTrack)&&void 0!==e?e:n?n.audioTrack:null,videoTrack:null!==(t=i.payload.videoTrack)&&void 0!==t?t:n?n.videoTrack:null}:n},Se="SET_MODE";!function(e){e[e.Editor=0]="Editor",e[e.Viewer=1]="Viewer"}(re||(re={}));var Ie,Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.Editor,t=arguments.length>1?arguments[1]:void 0;return t.type===Se?t.payload:e},Re=n(188),De=Object(Y.b)({threeViewReducer:J,sceneReducer:q,floorReducer:$,iframeReducer:te,usersReducer:ce,avatarsReducer:he,avatarModeReducer:fe,productsReducer:be,controlReducer:we,captureReducer:Ae,modeReducer:Pe,cameraDeviceReducer:Ce,tagReducer:je}),Be=Object(Y.c)(De,Object(Y.a)(Re.a)),Le=function(){function e(t,n,i,a){var o;Object(m.a)(this,e),this.bloomEffectPass=void 0,this.selectiveBloomPass=void 0,this.blurPass=void 0,this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.clock=void 0,this.composer=void 0,this.noiseEffect=void 0,this.vignetteEffect=void 0,this.bokehEffect=void 0,this.hueSaturationEffect=void 0,this.brightnessContrastEffect=void 0,this.bloomEffect=void 0,this.selectiveBloomEffect=void 0,this.postProcessingEnabled=void 0,this.conf=void 0,this.area=void 0,this.search=void 0,this.scene=t,this.camera=n,this.renderer=i,this.composer=new _.f(this.renderer),this.clock=new g.u,this.renderer.outputEncoding=g.Jc,this.renderer.physicallyCorrectLights=!0,this.noiseEffect=new _.j({premultiply:!0}),this.vignetteEffect=new _.p,this.bokehEffect=new _.c,this.conf=a,this.postProcessingEnabled=null!==(o=this.conf&&this.conf.postProcessingEnabled)&&void 0!==o&&o,this.hueSaturationEffect=new _.h({blendFunction:_.a.SKIP,saturation:.4,hue:0}),this.brightnessContrastEffect=new _.d({blendFunction:_.a.SKIP});var r={blendFunction:_.a.SOFT_LIGHT,kernelSize:_.i.SMALL,luminanceThreshold:.4,luminanceSmoothing:.1,height:480};this.bloomEffect=new _.b(this.scene,this.camera,r),this.selectiveBloomEffect=new _.o(this.scene,this.camera,r),this.load()}return Object(b.a)(e,[{key:"load",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSmaaImage();case 2:(t=new _.l(this.search,this.area,_.n.HIGH,_.e.DEPTH)).setDepthTexture(this.search),t.edgeDetectionMaterial.setEdgeDetectionThreshold(.02),this.bloomEffectPass=this.getEffectPass(t,this.bloomEffect),this.selectiveBloomPass=this.getEffectPass(t,this.selectiveBloomEffect),this.blurPass=new _.g(this.camera,this.bokehEffect),this.selectiveBloomPass.renderToScreen=!0,this.bloomEffectPass.renderToScreen=!0,this.resetPostProcess(),Be.getState().modeReducer===re.Editor?(this.defaultSetup(),(n=new F.a).title("Scene Filters Editor"),y.isMobile||G()(navigator.userAgent)?n.hide():(this.registerOptions(n),n.close())):this.defaultSetup();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSize",value:function(){this.composer.setSize(window.innerWidth,window.innerHeight)}},{key:"resetPostProcess",value:function(){this.composer.reset(),this.postProcessingEnabled?(this.composer.addPass(new _.k(this.scene,this.camera)),this.composer.addPass(this.blurPass),this.composer.addPass(this.bloomEffectPass),this.composer.addPass(this.selectiveBloomPass)):this.composer.addPass(new _.k(this.scene,this.camera))}},{key:"getEffectPass",value:function(e,t){return new _.g(this.camera,e,this.noiseEffect,this.vignetteEffect,this.brightnessContrastEffect,this.hueSaturationEffect,t)}},{key:"defaultSetup",value:function(){this.selectiveBloomPass.setEnabled(!1),this.blurPass.setEnabled(!1),this.selectiveBloomEffect.inverted=!1,this.conf?(this.bloomEffect.resolution.height=this.conf.bloomResolution,this.bloomEffect.blurPass.setScale(this.conf.bloomBlurScale),this.bloomEffect.blurPass.setKernelSize(this.conf.kernelSize),this.bloomEffect.blendMode.opacity.value=this.conf.bloomOpacity,this.bloomEffect.setIntensity(this.conf.bloomIntensity),this.bloomEffect.luminanceMaterial.threshold=this.conf.luminThreshold,this.bloomEffect.luminanceMaterial.smoothing=this.conf.luminSmooth,this.bloomEffect.blendMode.setBlendFunction(this.conf.bloomBlendMode),this.brightnessContrastEffect.uniforms.get("brightness").value=this.conf.brightness,this.brightnessContrastEffect.blendMode.opacity.value=this.conf.brightnessOpacity,this.brightnessContrastEffect.uniforms.get("contrast").value=this.conf.contrast,this.brightnessContrastEffect.blendMode.setBlendFunction(this.conf.brightnessBlendMode),this.hueSaturationEffect.setHue(this.conf.hue),this.hueSaturationEffect.uniforms.get("saturation").value=this.conf.saturation,this.hueSaturationEffect.blendMode.opacity.value=this.conf.saturationOpacity,this.hueSaturationEffect.blendMode.setBlendFunction(this.conf.saturationBlendMode),this.blurPass.setEnabled(this.conf.blurEnabled),this.bokehEffect.blendMode.opacity.value=this.conf.blurOpacity,this.noiseEffect.blendMode.opacity.value=this.conf.noiseOpacity,this.vignetteEffect.blendMode.opacity.value=this.conf.vignetteOpacity):(this.bloomEffect.resolution.height=480,this.bloomEffect.blendMode.setBlendFunction(17),this.selectiveBloomEffect.blendMode.setBlendFunction(17),this.hueSaturationEffect.blendMode.setBlendFunction(17),this.brightnessContrastEffect.blendMode.setBlendFunction(17),this.bloomEffect.blurPass.setScale(.63),this.selectiveBloomEffect.blurPass.setScale(.63),this.bloomEffect.blurPass.setKernelSize(_.i.SMALL),this.selectiveBloomEffect.blurPass.setKernelSize(_.i.SMALL),this.noiseEffect.blendMode.opacity.value=0,this.vignetteEffect.blendMode.opacity.value=0,this.bokehEffect.blendMode.opacity.value=0)}},{key:"getOptions",value:function(){return{postProcessingEnabled:this.postProcessingEnabled,bloomResolution:this.bloomEffect.resolution.height,bloomBlurScale:this.bloomEffect.blurPass.getScale(),bloomIntensity:this.bloomEffect.getIntensity(),bloomOpacity:this.bloomEffect.blendMode.opacity.value,kernelSize:this.bloomEffect.blurPass.getKernelSize(),luminThreshold:this.bloomEffect.luminanceMaterial.threshold,luminSmooth:this.bloomEffect.luminanceMaterial.smoothing,brightness:this.brightnessContrastEffect.uniforms.get("brightness").value,contrast:this.brightnessContrastEffect.uniforms.get("contrast").value,brightnessOpacity:this.brightnessContrastEffect.blendMode.opacity.value,saturation:this.hueSaturationEffect.uniforms.get("saturation").value,hue:this.hueSaturationEffect.getHue(),saturationOpacity:this.hueSaturationEffect.blendMode.opacity.value,noiseOpacity:this.noiseEffect.blendMode.opacity.value,vignetteOpacity:this.vignetteEffect.blendMode.opacity.value,blurEnabled:this.blurPass.isEnabled(),blurOpacity:this.bokehEffect.blendMode.opacity.value,bloomBlendMode:this.bloomEffect.blendMode.blendFunction,saturationBlendMode:this.hueSaturationEffect.blendMode.blendFunction,brightnessBlendMode:this.brightnessContrastEffect.blendMode.blendFunction}}},{key:"registerOptions",value:function(e){var t=this,n=this.selectiveBloomPass,i=(this.bloomEffectPass,this.blurPass),a=this.bloomEffect,o=this.selectiveBloomEffect,r=this.brightnessContrastEffect,s=this.hueSaturationEffect,c=a.blendMode,u=o.blendMode,l=this.noiseEffect.blendMode,h=this.bokehEffect.blendMode,d=this.vignetteEffect.blendMode,p={"effects enabled":this.postProcessingEnabled,resolution:a.resolution.height,"kernel size":a.blurPass.getKernelSize(),"blur scale":a.blurPass.getScale(),intensity:a.getIntensity(),luminance:{filter:a.luminancePass.isEnabled(),threshold:a.luminanceMaterial.threshold,smoothing:a.luminanceMaterial.smoothing},bloom:{"global disabled":n.isEnabled(),"bloom opacity":c.opacity.value,"blend mode":c.blendFunction},brightnessContrast:{brightness:r.uniforms.get("brightness").value,contrast:r.uniforms.get("contrast").value,opacity:r.blendMode.opacity.value,"blend mode":r.blendMode.blendFunction},hueSaturation:{hue:s.getHue(),saturation:s.uniforms.get("saturation").value,opacity:s.blendMode.opacity.value,"blend mode":s.blendMode.blendFunction},moreEffects:{noise:l.opacity.value,vignette:d.opacity.value,"blur enabled":i.isEnabled(),"blur opacity":h.opacity.value}};e.add(p,"effects enabled").onChange((function(e){t.postProcessingEnabled=!t.postProcessingEnabled,t.resetPostProcess()})),e.add(p,"resolution",[240,360,480,720,1080]).onChange((function(e){a.resolution.height=o.resolution.height=Number(e)})),e.add(p,"kernel size",_.i).onChange((function(e){a.blurPass.setKernelSize(Number(e)),o.blurPass.setKernelSize(Number(e))})),e.add(p,"blur scale",0,1,.01).onChange((function(e){a.blurPass.setScale(Number(e)),o.blurPass.setScale(Number(e))})),e.add(p,"intensity",0,3,.01).onChange((function(e){a.setIntensity(Number(e)),o.setIntensity(Number(e))}));var f=e.addFolder("Luminance");f.add(p.luminance,"filter").onChange((function(e){a.luminancePass.setEnabled(e),o.luminancePass.setEnabled(e)})),f.add(p.luminance,"threshold",0,1,.001).onChange((function(e){a.luminanceMaterial.threshold=Number(e),o.luminanceMaterial.threshold=Number(e)})),f.add(p.luminance,"smoothing",0,1,.001).onChange((function(e){a.luminanceMaterial.smoothing=Number(e),o.luminanceMaterial.smoothing=Number(e)})),f.open(),(f=e.addFolder("Bloom")).add(p.bloom,"bloom opacity",0,2,.01).onChange((function(e){c.opacity.value=e,u.opacity.value=e})),f.add(p.bloom,"blend mode",_.a).onChange((function(e){c.setBlendFunction(Number(e)),u.setBlendFunction(Number(e))})),(f=e.addFolder("Brightness & Contrast")).add(p.brightnessContrast,"brightness",-1,1,.001).onChange((function(e){r.uniforms.get("brightness").value=e})),f.add(p.brightnessContrast,"contrast",-1,1,.001).onChange((function(e){r.uniforms.get("contrast").value=e})),f.add(p.brightnessContrast,"opacity",0,1,.01).onChange((function(e){r.blendMode.opacity.value=e})),f.add(p.brightnessContrast,"blend mode",_.a).onChange((function(e){r.blendMode.setBlendFunction(Number(e))})),(f=e.addFolder("Hue & Saturation")).add(p.hueSaturation,"hue",0,2*Math.PI,.001).onChange((function(e){s.setHue(e)})),f.add(p.hueSaturation,"saturation",-1,1,.001).onChange((function(e){s.uniforms.get("saturation").value=e})),f.add(p.hueSaturation,"opacity",0,1,.01).onChange((function(e){s.blendMode.opacity.value=e})),f.add(p.hueSaturation,"blend mode",_.a).onChange((function(e){s.blendMode.setBlendFunction(Number(e))})),(f=e.addFolder("More Effects")).add(p.moreEffects,"noise",0,2,.01).onChange((function(e){l.opacity.value=e})),f.add(p.moreEffects,"vignette",0,2,.01).onChange((function(e){d.opacity.value=e})),e.add(p.moreEffects,"blur enabled").onChange((function(e){i.setEnabled(e)})),e.add(p.moreEffects,"blur opacity",0,2,.01).onChange((function(e){h.opacity.value=e})),window.innerWidth<720&&e.close()}},{key:"loadSmaaImage",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var i=new g.mb;i.onLoad=function(){return setTimeout(e,250)},i.onError=function(e){return console.error("Failed to load ".concat(e))};var a=new _.m(i),o=t;a.load((function(e){var t=Object(h.a)(e,2),n=t[0],i=t[1];o.search=n,o.area=i}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"composerRender",value:function(){var e=this.clock.getDelta();this.composer.render(e)}}]),e}(),Ne=n(156),ze=n(189),Ue=n(103),He=n(218),Ve=new g.tb({color:"black"}),Fe={},_e=function(){function e(t,n,i){Object(m.a)(this,e),this.bloomComposer=void 0,this.finalComposer=void 0,this.scene=void 0,this.camera=void 0,this.renderer=void 0,this.clock=void 0,this.bloomLayer=void 0,this.scene=t,this.camera=n,this.renderer=i;var a=1.1,o=.37,r=.02,s=new He.a(new g.Ac(window.innerWidth,window.innerHeight),1.5,.4,.85);s.threshold=o,s.strength=a,s.radius=r;var c=new ze.a(this.scene,this.camera);this.bloomComposer=new Ne.a(this.renderer),this.bloomComposer.renderToScreen=!1,this.bloomComposer.setSize(window.innerWidth,window.innerHeight),this.bloomComposer.addPass(c),this.bloomComposer.addPass(s),this.bloomComposer.render();var u=new Ue.a(new g.fc({uniforms:{baseTexture:{value:null},bloomTexture:{value:this.bloomComposer.renderTarget2.texture}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"\nuniform sampler2D baseTexture;\nuniform sampler2D bloomTexture;\nvarying vec2 vUv;\n\nvoid main() {\n    gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n}\n",defines:{}}),"baseTexture");u.needsSwap=!0,this.finalComposer=new Ne.a(this.renderer),this.finalComposer.addPass(c),this.finalComposer.addPass(u),this.clock=new g.u,this.bloomLayer=new g.Z,this.bloomLayer.set(3)}return Object(b.a)(e,[{key:"setSize",value:function(){this.bloomComposer.setSize(window.innerWidth,window.innerHeight),this.finalComposer.setSize(window.innerWidth,window.innerHeight)}},{key:"darkenNonBloomed",value:function(e){e.isMesh&&!1===this.bloomLayer.test(e.layers)&&(Fe[e.uuid]=e.material,e.material=Ve)}},{key:"restoreMaterial",value:function(e){Fe[e.uuid]&&(e.material=Fe[e.uuid],delete Fe[e.uuid])}},{key:"composerRender",value:function(){var e=this.clock.getDelta();this.renderer.clear(),this.scene.traverse(this.darkenNonBloomed.bind(this)),this.bloomComposer.render(e),this.scene.traverse(this.restoreMaterial.bind(this)),this.finalComposer.render(e)}}]),e}(),We={INIT:{ANIMATIONANGLE:Math.PI/1.5,ZOOM:.7,POLARANGLE:Math.PI/4,AZIANGLE:Math.PI/10},CONSTARINT:{ROTATESPEED:.05*.8,PANSPEED:.05,DAMPING:.1,MAX_ZOOM:2,MIN_ZOOM:.8,TOPVIEW:{minPolarAngle:0,maxPolarAngle:Math.PI/2},FPVIEW:{minPolarAngle:0,maxPolarAngle:Math.PI},MAXPAN:.5}},Ge=function(){function e(){Object(m.a)(this,e),this.renderer=void 0,this.cssrenderer=void 0,this.controls=void 0,this.camera=void 0,this.blurController=null,this.bloomController=null,this.postProcessingController=null,this.isBlurEffecting=!1}return Object(b.a)(e,[{key:"OrbitControls",get:function(){return this.controls}},{key:"init",value:function(e){this.camera=new g.Kb(75,window.innerWidth/window.innerHeight,.1,3e4);var t=new H(this.camera,e);t.dollyOut(1.2),this.renderer=new g.Ic({canvas:e,alpha:!0,antialias:!0,powerPreference:"high-performance"}),this.renderer.setPixelRatio(window.devicePixelRatio*wn.inst.scaleDeviceRatio),this.renderer.setSize(window.innerWidth,window.innerHeight,!1),this.renderer.autoClear=!1,this.renderer.setClearColor(16777215,0),this.renderer.setScissorTest(!0),this.renderer.physicallyCorrectLights=!0,this.renderer.outputEncoding=g.Jc,this.renderer.toneMapping=g.a,this.renderer.toneMappingExposure=1;var n=window.innerWidth,i=window.innerHeight;return this.cssrenderer=new V.b,this.cssrenderer.setSize(n%2===0?n:n-1,i%2===0?i:i-1),this.cssrenderer.domElement.style.width=(n%2===0?n:n-1)+"px",this.cssrenderer.domElement.style.height=(i%2===0?i:i-1)+"px",this.cssrenderer.domElement.style.position="fixed",document.querySelector("#css3d").appendChild(this.cssrenderer.domElement),window.addEventListener("resize",this.windowResized.bind(this),!1),this.camera.position.set(0,10,0),this.controls=t,this.controls.target.set(0,0,0),this.controls.domElement=this.renderer.domElement,this.controls.enableDamping=!0,this.controls.dampingFactor=We.CONSTARINT.DAMPING,this.controls.panSpeed=We.CONSTARINT.PANSPEED,this.controls.rotateSpeed=We.CONSTARINT.ROTATESPEED,this.controls.maxPolarAngle=Math.PI/2,this.controls.minZoom=We.CONSTARINT.MIN_ZOOM,this.controls.maxZoom=We.CONSTARINT.MAX_ZOOM,this.polarAngle=We.INIT.POLARANGLE,this.azimuthAngle=We.INIT.AZIANGLE+We.INIT.ANIMATIONANGLE,this.controls.update(),this}},{key:"createPostProcessController",value:function(e,t){var n=new Le(e,this.camera,this.renderer,t);this.renderer.toneMappingExposure=1,this.postProcessingController=n}},{key:"createBloomController",value:function(e){var t=new _e(e,this.camera,this.renderer);this.renderer.toneMappingExposure=1,this.bloomController=t}},{key:"windowResized",value:function(){null!=this.camera&&(this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()),this.renderer.setSize(window.innerWidth,window.innerHeight,!1),this.cssrenderer.setSize(window.innerWidth,window.innerHeight),this.bloomController&&this.bloomController.setSize(),this.postProcessingController&&this.postProcessingController.setSize()}},{key:"setFocusBbox",value:function(e,t){var n=Math.max(t.x,t.y,t.z);this.setLookAt(e),this.camera.position.set(e.x,e.y+n,e.z)}},{key:"render",value:function(e){if(this.controls&&this.renderer){var t=window.innerWidth,n=window.innerHeight;this.controls.update(),this.renderer.setRenderTarget(null),this.cssrenderer.render(e,this.camera),this.renderer.setScissor(0,0,t,n),this.renderer.setViewport(0,0,t,n),this.isBlurEffecting&&this.blurController?this.blurController.composerRender():this.bloomController?this.bloomController.composerRender():this.postProcessingController?this.postProcessingController.composerRender():this.renderer.render(e,this.camera)}}},{key:"setOrthographicLimit",value:function(e){this.controls.target.set(e.x,e.y,e.z),this.controls.minPolarAngle=0,this.controls.maxPolarAngle=0,this.controls.rotateSpeed=We.CONSTARINT.ROTATESPEED,this.controls.enableDamping=!0,this.controls.enableRotate=!0,this.controls.update()}},{key:"setTopViewLimit",value:function(e){this.controls.target.set(e.x,e.y,e.z),this.controls.minPolarAngle=We.CONSTARINT.TOPVIEW.minPolarAngle,this.controls.maxPolarAngle=We.CONSTARINT.TOPVIEW.maxPolarAngle,this.controls.rotateSpeed=We.CONSTARINT.ROTATESPEED,this.controls.enableDamping=!0,this.controls.enableRotate=!0,this.controls.update()}},{key:"setFirstpersonViewLimit",value:function(){var e=new g.Bc(0,0,-1e-5);e.applyQuaternion(this.camera.quaternion),this.controls.target.set(this.camera.position.x+e.x,this.camera.position.y+e.y,this.camera.position.z+e.z),this.controls.minPolarAngle=We.CONSTARINT.FPVIEW.minPolarAngle,this.controls.maxPolarAngle=We.CONSTARINT.FPVIEW.maxPolarAngle,this.controls.rotateSpeed=-We.CONSTARINT.ROTATESPEED,this.controls.enableDamping=!0,this.controls.enableRotate=!0,this.controls.update()}},{key:"setGoinglimit",value:function(e){var t=new g.Bc(0,0,-.001);t.applyQuaternion(this.camera.quaternion),this.controls.target.set(this.camera.position.x+t.x,this.camera.position.y+t.y,this.camera.position.z+t.z),this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI,this.controls.rotateSpeed=(e?1:-1)*We.CONSTARINT.ROTATESPEED,this.controls.enableRotate=!e,this.controls.enableDamping=!e,this.controls.update()}},{key:"setCamerPos",value:function(e,t){var n=(new g.Bc).copy(this.camera.position),i=new g.Bc(e.x-n.x,e.y-n.y,e.z-n.z);this.camera.position.x+=i.x,this.camera.position.y+=i.y,this.camera.position.z+=i.z,!0===t&&(this.controls.target.x+=i.x,this.controls.target.y+=i.y,this.controls.target.z+=i.z)}},{key:"setLookAt",value:function(e){this.controls.target.set(e.x,e.y,e.z)}},{key:"polarAngle",get:function(){return this.controls.getPolarAngle()},set:function(e){var t=this.controls.minPolarAngle,n=this.controls.maxPolarAngle;this.controls.minPolarAngle=e,this.controls.maxPolarAngle=e,this.controls.update(),this.controls.minPolarAngle=t,this.controls.maxPolarAngle=n,this.controls.update()}},{key:"azimuthAngle",get:function(){return this.controls.getAzimuthalAngle()},set:function(e){var t=this.controls.minAzimuthAngle,n=this.controls.maxAzimuthAngle,i=e;i>Math.PI?i=e-Math.PI-Math.PI:i<-Math.PI&&(i=e+Math.PI+Math.PI),this.controls.minAzimuthAngle=i,this.controls.maxAzimuthAngle=i,this.controls.update(),this.controls.minAzimuthAngle=t,this.controls.maxAzimuthAngle=n,this.controls.update()}},{key:"setLookAtCenter",value:function(e){this.controls.target.set(e.x,e.y,e.z)}},{key:"getLookAtCenter",value:function(){return this.controls.target}},{key:"getCamerPosition",value:function(){var e=new g.Bc;return this.camera.getWorldPosition(e),e}},{key:"getCameraQuaternion",value:function(){return this.camera.quaternion.clone()}},{key:"getSrceenCoordinate",value:function(e){var t=e.clone().project(this.camera);return t.x=(t.x+1)/2,t.y=-(t.y-1)/2,t.x>0&&t.x<1&&t.y>0&&t.y<1&&t.z<1&&t.z>-1?t:void 0}},{key:"screenHeight",get:function(){return Math.tan(this.fov/2)*(new g.Bc).subVectors(this.getCamerPosition(),this.getLookAtCenter()).length()*2}},{key:"fov",get:function(){return this.camera.updateProjectionMatrix(),this.camera.fov/180*Math.PI},set:function(e){this.camera.fov=e/Math.PI*180,this.camera.updateProjectionMatrix()}}]),e}(),Ye=n(58),Ze=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this)).controlBackVecDistance=void 0,e.controlBackVecHeight=void 0,e.isCustomFocusBbox=void 0,e.isRotation=void 0,e.isHotspotAnimating=void 0,e.easingAnime="easeInOutSine",e.isTop=void 0,e.isTop=!0,e.controlBackVecDistance=10,e.controlBackVecHeight=10,e.isHotspotAnimating=!1,e.isRotation=!1,e.isCustomFocusBbox=!1,e}return Object(b.a)(n,[{key:"setCustomFocusBbox",value:function(e,t){this.isCustomFocusBbox=!0,this.controlBackVecDistance=e,this.controlBackVecHeight=t}},{key:"setFocusBbox",value:function(e,t){if(Object(D.a)(Object(B.a)(n.prototype),"setFocusBbox",this).call(this,e,t),!this.isCustomFocusBbox){var i=Math.max(t.x,t.y,t.z);this.controlBackVecDistance=i,this.controlBackVecHeight=t.y}}},{key:"walk",value:function(e){var t=this,n=this.getCamerPosition();return this.setGoinglimit(!1),{easing:this.easingAnime,progress:{update:function(i){t.isHotspotAnimating=!0;var a=(new g.Bc).lerpVectors(n,e,i);t.setCamerPos(a,!0)}},complete:function(){t.isTop=!1,t.isHotspotAnimating=!1,t.setFirstpersonViewLimit(),t.setCamerPos(e,!0)}}}},{key:"goDown",value:function(e){var t=this,n=this.getCamerPosition();function i(e){return e<.5?16*Math.pow(e,5):1+16*Math.pow(e-1,5)}this.setGoinglimit(!1);var a=this.polarAngle,o=Math.PI/2;return{targets:t,polarAngle:[a,o],easing:function(){return i},progress:{update:function(i){t.isHotspotAnimating=!0;var a,o=(new g.Bc).lerpVectors(n,e,(a=i)<.5?8*Math.pow(a,4):1-8*Math.pow(a-1,4));t.setCamerPos(o,!0)}},complete:function(){t.isTop=!1,t.isHotspotAnimating=!1,t.setFirstpersonViewLimit()}}}},{key:"goPosition",value:function(e){return this.isTop?this.goDown(e):this.walk(e)}},{key:"goTop",value:function(){this.isTop=!0,this.setGoinglimit(!0);var e=new g.Bc;(e=new g.Bc(0,0,this.controlBackVecDistance)).applyAxisAngle(this.camera.up,this.azimuthAngle);var t=this.getCamerPosition(),n=(new g.Bc).addVectors(t,e);n.y=t.y+this.controlBackVecHeight;var i,a=this.polarAngle;i=Math.atan2(new g.Ac(n.x-t.x,n.z-t.z).length(),n.y-t.y);var o=this;return{progress:{update:function(e){var r;o.setCamerPos((new g.Bc).lerpVectors(t,n,(r=e)<.5?8*Math.pow(r,4):1-8*Math.pow(r-1,4)),!0);var s=function(e){var t=e-1;return t*t*t+1}(e);o.polarAngle=(1-s)*a+s*i}},complete:function(){o.setTopViewLimit(t)}}}},{key:"setOrbitControlRotation",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((function(a,o){var r=Math.abs(e-n.azimuthAngle),s=Math.abs(t-n.polarAngle),c=n;if(r*r+s*s>=.01&&!n.isRotation&&!n.isHotspotAnimating){var u;if(n.azimuthAngle>=0&&e>=0||n.azimuthAngle<0&&e<0)u={x:e,y:t};else{var l=Math.abs(Math.abs(e)-Math.PI),h=Math.abs(Math.abs(e)-0);if(e<0)if(l<h)u={x:Math.PI+l,y:t};else u={x:-h,y:t};else if(l<h)u={x:-Math.PI-l,y:t};else u={x:h,y:t}}var d={x:n.azimuthAngle,y:n.polarAngle};new Ye.Tween(d).to(u,i).easing(Ye.Easing.Circular.Out).onUpdate((function(){c.isRotation=!0,c.azimuthAngle=d.x,c.polarAngle=d.y})).onComplete((function(){c.isRotation=!1,a()})).start()}else a()}))}}]),n}(Ge);function Je(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==e[0].index,i=(new Set(Object.keys(e[0].attributes)),new Set(Object.keys(e[0].morphAttributes))),a={},o={},r=e[0].morphTargetsRelative,s=new g.o,c=0,u=0;u<e.length;++u){var l=e[u];for(var h in l.attributes)void 0===a[h]&&(a[h]=[]),a[h].push(l.attributes[h]);if(r!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var d in l.morphAttributes){if(!i.has(d))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===o[d]&&(o[d]=[]),o[d].push(l.morphAttributes[d])}if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(l.userData),t){var p=void 0;if(n)p=l.index.count;else{if(void 0===l.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;p=l.attributes.position.count}s.addGroup(c,p,u),c+=p}}if(n){for(var f=0,v=[],m=0;m<e.length;++m){for(var b=e[m].index,y=0;y<b.count;++y)v.push(b.getX(y)+f);f+=e[m].attributes.position.count}s.setIndex(v)}for(var w in a){var x=Ke(a[w]);if(!x)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+w+" attribute."),null;s.setAttribute(w,x)}for(var O in o){var j=o[O][0].length;if(0===j)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[O]=[];for(var k=0;k<j;++k){for(var M=[],A=0;A<o[O].length;++A)M.push(o[O][A][k]);var E=Ke(M);if(!E)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+O+" morphAttribute."),null;s.morphAttributes[O].push(E)}}return s}function Ke(e){for(var t,n,i,a=0,o=0;o<e.length;++o){var r=e[o];if(r.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=r.array.constructor),t!==r.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=r.itemSize),n!==r.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=r.normalized),i!==r.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=r.array.length}for(var s=new t(a),c=0,u=0;u<e.length;++u)s.set(e[u].array,c),c+=e[u].array.length;return new g.n(s,n,i)}!function(e){e[e.ON=0]="ON",e[e.NOTON=1]="NOTON"}(Ie||(Ie={}));var qe=function(){function e(){Object(m.a)(this,e)}return Object(b.a)(e,null,[{key:"hasProperty",value:function(e,t){return(e&t)===t}}]),e}();qe.NONE=0,qe.SHOWMODAL=1,qe.EDIT=2,qe.MOVE=4,qe.REDIRECT=8,qe.OPENWINDOW=16,qe.AVATAR=32;var Xe,Qe,$e=function(){function e(){Object(m.a)(this,e),this.state=void 0,this.state=Ie.NOTON}return Object(b.a)(e,null,[{key:"mergeGroup",value:function(e){var t=e.parent;t&&t.remove(e),e.updateMatrixWorld(!0);var n=new g.N;e.traverse((function(e){e.isMesh&&"BufferGeometry"===e.geometry.type&&(e.updateMatrixWorld(!0),n.merge((new g.N).fromBufferGeometry(e.geometry),e.matrixWorld))})),t&&t.add(e);var i=new g.tb,a=new g.sb(n,i);return a.layers.disableAll(),a}},{key:"mergeMeshes",value:function(e){var t=[].concat(e||[]),n=new g.N;t.forEach((function(e){var t=e.parent;t&&t.remove(e),e.updateMatrixWorld(!0),n.merge((new g.N).fromBufferGeometry(e.geometry),e.matrixWorld),t&&t.add(e)}));var i=new g.sb(n,new g.tb);return i.layers.disableAll(),i}},{key:"mergeGeometries",value:function(e){var t=[].concat(e||[]),n=new g.sb(Je(t),new g.tb);return n.layers.disableAll(),n}},{key:"emptyRaycastMesh",value:function(){var e=new g.sb(new g.Mb(1,1,4),new g.tb);return e.layers.disableAll(),e}}]),e}(),et=function(){function e(t){Object(m.a)(this,e),this.layer=void 0,this.raycastobjects=void 0,this.eventobjects=void 0,this.layer=t,this.raycastobjects=[],this.eventobjects=[],this.onMouseUp=function(){}}return Object(b.a)(e,[{key:"addTarget",value:function(e){var t=this;if(e instanceof $e){var n=e.raycastTarget;n.userData={mouseEventAgent:e},n.layers.enable(this.layer),this.raycastobjects.push(n),this.eventobjects.push(e);var i=this;e.addCustumDestory((function(){function t(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}t(i.raycastobjects,n),t(i.eventobjects,e)}))}else e instanceof Array&&e.forEach((function(e){t.addTarget(e)}))}}]),e}(),tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(m.a)(this,e),this.layer=1,this.raycaster=void 0,this.camera=void 0,this.isMouseUpThreshold=10,this.mouseDownCoord=void 0,this.mouse=void 0,this.targets=void 0,this.layer=t,this.raycaster=new g.Zb,this.raycaster.layers.set(this.layer),this.mouseDownCoord=new g.Ac,this.mouse=new g.Ac,this.targets=[]}return Object(b.a)(e,[{key:"init",value:function(e,t){this.camera=t,e.addEventListener("mousemove",this.onMouseMove.bind(this),!1),e.addEventListener("mousedown",this.onMouseDown.bind(this),!1),e.addEventListener("mouseup",this.onMouseUp.bind(this),!1),e.addEventListener("touchend",this.onMouseUp.bind(this),!1),e.addEventListener("touchstart",this.onMouseDown.bind(this),!1)}},{key:"addEvent",value:function(e){var t=new et(this.layer);if(e){var n=e.testobject,i=e.onMouseUp,a=e.onMousemove;n.forEach((function(e){t.addTarget(e)})),t.onMouseUp=i,t.onMousemove=a}return this.targets.push(t),t}},{key:"updateMouse",value:function(e,t){e.type.includes("touch")?(t.x=e.changedTouches[0].clientX,t.y=e.changedTouches[0].clientY):(t.x=e.clientX,t.y=e.clientY)}},{key:"emitRaycaster",value:function(e,t,n){var i=this,a=new g.Ac;a.x=this.mouse.x/window.innerWidth*2-1,a.y=-this.mouse.y/window.innerHeight*2+1,this.raycaster.setFromCamera(a,this.camera),this.targets.forEach((function(e){var a=e.raycastobjects,o=e.onMouseUp,r=e.onMousemove,s=n?r:o,c=i.raycaster.intersectObjects(a);if(e.eventobjects.forEach((function(e){c.length>0&&e.raycastTarget===c[0].object.userData.mouseEventAgent.raycastTarget?t(Ie.ON,e,c[0]):t(Ie.NOTON,e)})),c.length>0){var u=c[0].object.userData.mouseEventAgent;s&&s({destroy:u.destroy.bind(u),target:u.targetInfo,rotation:i.intersect2rot4(c[0]),position:c[0].point})}else s&&n&&s(void 0)}))}},{key:"onMouseDown",value:function(e){this.updateMouse(e,this.mouseDownCoord)}},{key:"intersect2rot4",value:function(e){if(e){var t=e.face.normal.clone();return e.object.updateMatrixWorld(!0),t.transformDirection(e.object.matrixWorld),(new g.rb).lookAt(t,new g.Bc(0,0,0),this.camera.up)}}},{key:"onMouseMove",value:function(e){var t=this;0!==this.targets.length&&(this.updateMouse(e,this.mouse),this.emitRaycaster(e,(function(e,n,i){e===Ie.NOTON&&n.state===Ie.ON?n.onMouseLeave():e===Ie.ON&&(n.onMouseMove(t.intersect2rot4(i),i.point),n.state===Ie.NOTON&&n.onMouseEnter()),n.state=e}),!0))}},{key:"onMouseUp",value:function(e){var t=this;2!==e.button&&(this.updateMouse(e,this.mouse),this.mouseDownCoord.distanceTo(this.mouse)>this.isMouseUpThreshold||0!==this.targets.length&&this.emitRaycaster(e,(function(e,n,i){e===Ie.ON&&n.onMouseUp(t.intersect2rot4(i),i.point)}),!1))}}]),e}(),nt=n(125),it=function(){function e(){Object(m.a)(this,e),this.isPlaying=void 0,this.timelines=void 0,this.isPlaying=!1,this.timelines=[]}return Object(b.a)(e,[{key:"end",value:function(){this.isPlaying=!1,this.timelines=[]}},{key:"cancel",value:function(){var e=nt.a.running;this.timelines.forEach((function(t){var n=e.indexOf(t);e.splice(n,1)})),this.end()}},{key:"play",value:function(e){var t=this;if(this.isPlaying)return console.warn("animation is playing"),new Promise((function(e){e()}));this.isPlaying=!0;var n=this;return e.forEach((function(e){t.timelines.push(e.inst)})),new Promise((function(e,t){var i=0;function a(){n.timelines.length<=i&&t(),n.timelines[i].play(),n.timelines[i].finished.then(o)}function o(){i++,n.timelines.length<=i?e():a()}a()})).then(this.end.bind(this))}}]),e}(),at=function(){function e(t){Object(m.a)(this,e),this.duration=void 0,this.parallelActions=void 0,this.duration=t,this.parallelActions=[]}return Object(b.a)(e,[{key:"addAction",value:function(e){this.parallelActions.push(e)}},{key:"inst",get:function(){var e=nt.a.timeline({autoplay:!1,duration:this.duration});return this.parallelActions.forEach((function(t){var n=Object(x.a)({easing:"linear"},t),i=t.progress;if(n.targets)n.update=function(e){var t=e.progress/100;!0===i.inverse?i.update(1-t):i.update(t)};else if("progress"in t){var a={p:0},o=[a];n.targets=o,n.p=[0,100],n.update=function(e){var t=a.p/100;!0===i.inverse?i.update(1-t):i.update(t)}}e.add(n,0)})),e}}]),e}(),ot={FAST:500,GOHOTSPOT:2e3,GOTOP:1500,GODOWN:2200,BY_DISTANCE_DURATION_FACTOR:150,BYDISTANCE:function(e){return e*ot.BY_DISTANCE_DURATION_FACTOR}},rt=function(){function e(){Object(m.a)(this,e),this.latestHotspotId=void 0,this.currentFloor=void 0,this.currentMoveHotspotId=void 0,this.transitionMesh=void 0,this.camControls=void 0,this.hotspotdict=void 0,this.hotspotMeshList=void 0,this.animator=void 0,this.showPanoramaMesh=!0,this.animationDuration=void 0,this.enableCalcDurationByDistance=!0,this.enableBlurEffectAnimation=!1,this.preLoadHotspot={},this.objectNearHotspot={},this.hotspotdict={},this.hotspotMeshList=[],this.animator=new it,this.animationDuration=ot}return Object(b.a)(e,[{key:"enablePanoramaMesh",get:function(){return this.showPanoramaMesh},set:function(e){this.showPanoramaMesh=e,this.transitionMesh.transitionPercentage=e?0:1}},{key:"init",value:function(e,t){this.camControls=e,this.transitionMesh=t}},{key:"setAnimationDurationParameters",value:function(e,t,n,i){e&&(this.animationDuration.GOHOTSPOT=e),t&&(this.animationDuration.GODOWN=t),n&&(this.animationDuration.GOTOP=n),i&&(this.animationDuration.BY_DISTANCE_DURATION_FACTOR=i)}},{key:"displayHotspotNeighbors",value:function(e){if(this.hotspotMeshList.forEach((function(e){e.visible=!1})),this.hotspotdict[e]){var t=this.hotspotdict[e].neighbors;this.hotspotMeshList.forEach((function(e){var n=e.id;0===t.length||t.includes(n)?e.visible=!0:e.visible=!1}))}}},{key:"initHotspotInfos",value:function(e,t){var n=this;e.forEach((function(e){n.hotspotdict[e.id]=e})),this.hotspotMeshList=t}},{key:"godown",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.camControls.isTop){e.next=7;break}return e.next=3,this.goHotspot(this.latestHotspotId);case 3:if(null!==Be.getState().iframeReducer){e.next=5;break}return e.abrupt("return");case 5:(0,Be.getState().iframeReducer.sendMessage)(U.setdollhousemode,!1);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goTop",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.animator.isPlaying){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==this.transitionMesh.hotspotid){e.next=4;break}return e.abrupt("return");case 4:return this.latestHotspotId=this.transitionMesh.hotspotid,t=new at(this.animationDuration.GOTOP),this.displayHotspotNeighbors(void 0),t.addAction(this.camControls.goTop()),t.addAction(this.transitionMesh.goTop()),e.next=11,this.animator.play([t]);case 11:if(null!==Be.getState().iframeReducer){e.next=13;break}return e.abrupt("return");case 13:(0,Be.getState().iframeReducer.sendMessage)(U.setdollhousemode,!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"preloadHotspot",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,s,c,u=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.hotspotdict[t]){e.next=3;break}return e.abrupt("return");case 3:i=n.position,a=new g.Bc(i.x,0,i.z),o=[],n.neighbors.forEach((function(e){var t=u.hotspotdict[e];if(t){var n=new g.Bc(t.position.x,t.position.y,t.position.z);o.push({id:t.id,distance:a.distanceTo(n)})}})),o.sort((function(e,t){return e.distance-t.distance})),s=function(e){var t=u.hotspotdict[o[e].id];if(void 0!==u.preLoadHotspot[o[e].id]||wn.inst.resLoad.load(t.lowerSkybox,r.Cubemap).then((function(t){u.preLoadHotspot[o[e].id]=t})),15===e)return"break"},c=0;case 10:if(!(c<o.length)){e.next=17;break}if("break"!==s(c)){e.next=14;break}return e.abrupt("break",17);case 14:c++,e.next=10;break;case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"goFloorWithNumber",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.hotspotdict[this.latestHotspotId]).floor!==t){e.next=3;break}return e.abrupt("return");case 3:if(i=Object.keys(this.hotspotdict),a=1/0,o=this.latestHotspotId,r=new g.Bc(n.position.x,0,n.position.z),i.forEach((function(e){var n=s.hotspotdict[e];if(n.floor===t){var i=r.distanceTo(new g.Bc(n.position.x,0,n.position.z));i<a&&(a=i,o=n.id)}})),!o){e.next=13;break}return e.next=11,this.goHotspot(o);case 11:e.next=14;break;case 13:console.warn("nearest floor hotspot not found.");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"goNearHotspotWithAngle",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i,a){var o,r,s,c,u,l,h,d,p,v,m=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="",r=t.object.position,a&&this.objectNearHotspot[a])o=this.objectNearHotspot[a];else{for(l in s=[],c=new g.Sb,t.object.getWorldQuaternion(c),u=new g.Bc(0,0,-1).applyQuaternion(c),this.hotspotdict)h=this.hotspotdict[l],(d=r.distanceTo(h.position))>1&&d<=3.5&&s.push(l);s.forEach((function(e){var t=m.hotspotdict[e],n=new g.Bc(r.x-t.position.x,0,r.z-t.position.z),i=Math.abs(n.angleTo(u));(!p||p>i)&&(o=e,p=i)}))}if(""===o){e.next=12;break}if(!n){e.next=7;break}return e.next=7,this.goTop();case 7:return(v=[]).push(this.goHotspot(o)),v.push(this.faceObjectRotation(r,this.hotspotdict[o].position,i)),e.next=12,Promise.all(v);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,i,a){return e.apply(this,arguments)}}()},{key:"faceObjectRotation",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||(n=this.hotspotdict[this.latestHotspotId].position),a=Math.atan2(n.x-t.x,n.z-t.z),!i){e.next=7;break}return e.next=5,this.camControls.setOrbitControlRotation(a,i);case 5:e.next=9;break;case 7:return e.next=9,this.camControls.setOrbitControlRotation(a,this.camControls.polarAngle);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"goHotspotNoAnimation",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i,a,o,s,c,u,l,h,d,p,v,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=this.hotspotdict[t])){e.next=25;break}return a=i.position,o=i.cameraHeight,s=i.rotation,c=i.lowerSkybox,u=i.higherSkybox,l=i.id,i.previewUrl,h=wn.inst.resLoad.load(u,r.Cubemap),d=new g.Bc(a.x,a.y+o,a.z),e.next=7,wn.inst.resLoad.load(c,r.Cubemap);case 7:return p=e.sent,v={id:l,position:d,rotation:s,texture:p},this.transitionMesh.hotspotid=v.id,e.next=12,this.transitionMesh.cubemapMaterial.setTexture(v);case 12:return this.transitionMesh.transitionPercentage=0,this.camControls.camera.position.copy(d),this.camControls.isTop=!1,this.camControls.isHotspotAnimating=!1,this.camControls.setFirstpersonViewLimit(),n&&this.camControls.setOrbitControlRotation(this.camControls.azimuthAngle,n),e.next=20,h;case 20:m=e.sent,this.displayHotspotNeighbors(l),this.transitionMesh.setHighResTexture({id:l,position:d,rotation:s,texture:m}),this.latestHotspotId=t,this.preloadHotspot(this.latestHotspotId);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"goHotspot",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i,a){var o,s,c,u,l,h,d,p,v,m,b,y,w,x,O,j,k,M,A=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.camControls.isTop||!this.latestHotspotId||this.latestHotspotId!==t||!t){e.next=2;break}return e.abrupt("return");case 2:if(!this.camControls.isTop||!this.animator.isPlaying){e.next=4;break}return e.abrupt("return");case 4:if(this.animator.isPlaying&&(this.animator.cancel(),this.camControls.easingAnime="easeOutSine",this.transitionMesh.cubemapMaterial.transition=this.transitionMesh.cubemapMaterial.currentIndexIsZero?0:1),this.currentMoveHotspotId=t,!(o=this.hotspotdict[t])){e.next=30;break}return s=o.position,c=o.cameraHeight,u=o.rotation,l=o.lowerSkybox,h=o.higherSkybox,d=o.id,p=o.previewUrl,v=this.camControls.isTop,m=new g.Bc(s.x,s.y+c,s.z),b=this.animationDuration.GOHOTSPOT,b=this.camControls.isTop?this.animationDuration.GODOWN:this.enableCalcDurationByDistance?this.animationDuration.BYDISTANCE(this.camControls.getCamerPosition().distanceTo(m)):this.animationDuration.GOHOTSPOT,y=[],w=wn.inst.resLoad.load(h,r.Cubemap),x=function(e){!A.camControls.isTop&&A.enableBlurEffectAnimation&&(A.camControls.isBlurEffecting=!0);var n=new at(b);return n.addAction(A.camControls.goPosition(m)),n.addAction(A.transitionMesh.goHotspot({id:d,position:m,rotation:u,texture:e},A.showPanoramaMesh)),new Promise((function(e){A.animator.play([n]).then((function(){try{var n=wn.inst.avatarsMgr,i=n.avatarData;if(i&&i.camera){i.azimuthAngle=A.camControls.azimuthAngle;var a=n.getTargetPosition(i,t);n.getAvatar(i.id).move(a,t)}e()}catch(o){e()}}))}))},p?O=wn.inst.resLoad.load(p,r.Texture).then(x):void 0!==this.preLoadHotspot[d]?(j=this.preLoadHotspot[d],O=x(j)):O=void 0!==this.preLoadHotspot[t]?x(this.preLoadHotspot[t]):wn.inst.resLoad.load(l,r.Cubemap).then(x),y.push(O),y.push(w),i&&(k=this.camControls.setOrbitControlRotation(null!==a&&void 0!==a?a:this.camControls.azimuthAngle,i,this.animationDuration.GOHOTSPOT),y.push(k)),e.next=22,Promise.all(y).then((function(e){A.latestHotspotId||(console.log("scene is ready to view!"),null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.sceneready,{}));A.latestHotspotId=t,A.currentFloor=A.hotspotdict[d].floor,A.preloadHotspot(A.latestHotspotId),A.displayHotspotNeighbors(d),A.camControls.easingAnime="easeInOutSine",A.transitionMesh.setHighResTexture({id:d,position:m,rotation:u,texture:e[1]})}));case 22:if(null!==Be.getState().iframeReducer){e.next=24;break}return e.abrupt("return");case 24:if(M=Be.getState().iframeReducer.sendMessage,v){e.next=27;break}return e.abrupt("return");case 27:M(U.setdollhousemode,!1),e.next=32;break;case 30:this.goNearHotspot(t,n),console.warn("Hotspot '".concat(t,"' not found, search nearest hotspot instead."));case 32:case"end":return e.stop()}}),e,this)})));return function(t,n,i,a){return e.apply(this,arguments)}}()},{key:"goNearHotspot",value:function(e,t){var n=this;if(t){var i=Object.keys(this.hotspotdict);if(this.latestHotspotId&&!this.camControls.isTop&&""!=e){for(var a=this.hotspotdict[this.latestHotspotId].neighbors,o=this.hotspotdict[this.latestHotspotId].floor,r=0,s=Object.entries(this.hotspotdict);r<s.length;r++){var c=Object(h.a)(s[r],2),u=c[0];c[1];if(u!==this.latestHotspotId){var l=this.hotspotdict[u];(l.floor==o-1||Math.abs(t.y-l.position.y)<.3)&&a.push(l.id)}}i=a}var d=1/0,p=void 0;i.forEach((function(e){var i=n.hotspotdict[e];if(i){var a=i.position,o=(i.floor,t.distanceTo(new g.Bc(a.x,a.y,a.z)));o<d&&(d=o,p=e)}}));var f=Be.getState().modeReducer;if(p){if(this.camControls.isTop||f===re.Editor)return void this.goHotspot(p);this.goHotspot(p)}else console.warn("nearest hotspot not found.")}}}]),e}();!function(e){e[e.Freeform=0]="Freeform",e[e.Viewer=1]="Viewer"}(Qe||(Qe={}));var st,ct=function(){function e(){Object(m.a)(this,e),this.canvas=void 0,this.controls=void 0,this.camera=void 0,this.movingMode=void 0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.isWalking=!1,this._enabled=!0,this.speed=50,this.prevTime=performance.now(),this.velocity=new g.Bc,this.direction=new g.Bc,Xe=this}return Object(b.a)(e,[{key:"init",value:function(e,t,n){this.camera=e,this.controls=t,this.canvas=n,this.attachKeyboardEvent()}},{key:"enabled",get:function(){return this._enabled},set:function(e){e?this.attachKeyboardEvent():this.detachKeyboardEvent()}},{key:"walking",get:function(){return this.isWalking}},{key:"onKeyDown",value:function(e){var t=Xe.camera.getWorldDirection(new g.Bc);switch(e.code){case"KeyW":Xe.moveForward=!0,Xe.isWalking=!0;break;case"KeyA":t.applyAxisAngle(new g.Bc(0,1,0),Math.PI/2),Xe.moveLeft=!0,Xe.isWalking=!0;break;case"KeyS":t.applyAxisAngle(new g.Bc(0,1,0),Math.PI),Xe.moveBackward=!0,Xe.isWalking=!0;break;case"KeyD":t.applyAxisAngle(new g.Bc(0,1,0),-Math.PI/2),Xe.moveRight=!0,Xe.isWalking=!0;break;default:t=void 0}Xe.movingMode===Qe.Freeform?t=void 0:Xe.isWalking=!1,Xe.goHotspotWithKeyboard(t)}},{key:"goHotspotWithKeyboard",value:function(e){var t=this;if(e){var n=wn.inst.animationMgr,i=n.hotspotdict[n.latestHotspotId],a=wn.inst.animationMgr.hotspotdict,o=Object.keys(a),r=1/0,s=void 0;o.forEach((function(a){var o=n.hotspotdict[a],c=o.position,u=o.floor,l=o.id;if(u===i.floor&&l!==n.latestHotspotId&&i.neighbors.includes(l)){var h=new g.Bc(c.x-t.camera.position.x,0,c.z-t.camera.position.z);if(Math.abs(h.angleTo(e))<.6){var d=new g.Bc(i.position.x,i.position.y,i.position.z).distanceTo(new g.Bc(c.x,c.y,c.z));d<r&&(r=d,s=l)}}})),s&&n.goHotspot(s)}}},{key:"onKeyUp",value:function(e){switch(e.code){case"KeyW":Xe.moveForward=!1,Xe.isWalking=!1;break;case"KeyA":Xe.moveLeft=!1,Xe.isWalking=!1;break;case"KeyS":Xe.moveBackward=!1,Xe.isWalking=!1;break;case"KeyD":Xe.moveRight=!1,Xe.isWalking=!1}}},{key:"update",value:function(){var e=performance.now();if(this._enabled){var t=new g.Bc,n=new g.Bc,i=(e-this.prevTime)/1e3;this.velocity.x-=10*this.velocity.x*i,this.velocity.z-=10*this.velocity.z*i,this.direction.z=Number(this.moveForward)-Number(this.moveBackward),this.direction.x=Number(this.moveRight)-Number(this.moveLeft),this.direction.normalize(),0===this.direction.x&&0===this.direction.z||((this.moveForward||this.moveBackward)&&(this.velocity.z-=this.direction.z*this.speed*i),(this.moveLeft||this.moveRight)&&(this.velocity.x-=this.direction.x*this.speed*i),n.setFromMatrixColumn(this.camera.matrix,0),n.crossVectors(this.camera.up,n),t.addVectors(this.camera.position,n.multiplyScalar(-this.velocity.z*i)),n.setFromMatrixColumn(this.camera.matrix,0),t.add(n.multiplyScalar(-this.velocity.x*i)),this.setCameraPosition(t,!0)),this.prevTime=e}}},{key:"setCameraPosition",value:function(e,t){var n=(new g.Bc).copy(this.camera.position),i=new g.Bc(e.x-n.x,e.y-n.y,e.z-n.z);this.camera.position.x+=i.x,this.camera.position.y+=i.y,this.camera.position.z+=i.z,!0===t&&(this.controls.target.x+=i.x,this.controls.target.y+=i.y,this.controls.target.z+=i.z)}},{key:"attachKeyboardEvent",value:function(){this.canvas.addEventListener("keydown",this.onKeyDown),this.canvas.addEventListener("keyup",this.onKeyUp)}},{key:"detachKeyboardEvent",value:function(){this.canvas.removeEventListener("keydown",this.onKeyDown),this.canvas.removeEventListener("keyup",this.onKeyUp)}}]),e}(),ut=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,{fragmentShader:"\nvarying vec3 pos;\n\nvoid main() {\n    vec3 normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float z = gl_FragCoord.z;  // depth value [0,1]\n    \n    gl_FragColor = vec4(normal*0.5+0.5, z);\n}\n",vertexShader:"\nvarying vec3 pos;\n\nvoid main()\t\n{\n    gl_Position =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    pos =  (modelMatrix* vec4( position, 1.0 )).xyz;\n}\n"})).extensions.derivatives=!0,e}return n}(g.fc);!function(e){e.TEXT="TEXT",e.PHOTO="PHOTO",e.GIF="GIF",e.VIDEO="VIDEO",e.MODEL="GLB",e.SPRITE="SPRITE",e.TAG="TAG",e.HOTSPOT="HOTSPOT",e.WEB="WEB",e.MOUSEICON="MOUSEICON",e.SCENEMODEL="SCENEMODEL",e.PORTAL="PORTAL",e.BOOTH="BOOTH",e.AVATAR="AVATAR",e.POSITIONPLANE="POSITIONPLANE",e.POSITIONCUBE="POSITIONCUBE"}(st||(st={}));var lt,ht=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e){var i;return Object(m.a)(this,n),(i=t.call(this)).id=void 0,i.type=void 0,i._object=void 0,i.renderDepthAndNormalMat=new ut,i.oldMaterial=null,i.raycastMesh=void 0,i.custumDestoryFuncs=void 0,i._object=new g.Q,i.updateRaycastMesh(),i.type=e,i.custumDestoryFuncs=[],i}return Object(b.a)(n,[{key:"object",get:function(){return this._object}},{key:"renderIndexColor",value:function(e){}},{key:"renderNormalAndDepth",value:function(e){var t=this.raycastTarget;t&&(null===this.oldMaterial&&(this.oldMaterial=t.material),t.material=e?this.renderDepthAndNormalMat:this.oldMaterial)}},{key:"enableRaycasterLayer",value:function(e){var t=this.raycastTarget;t&&t.layers.enable(e)}},{key:"setRaycastIndex",value:function(e,t){var n=this.raycastTarget;if(n){n.layers.enable(e);var i=n.material;return n.material=function(e){return new g.fc({vertexShader:"\n                void main()\t\n                {\n                    gl_Position = projectionMatrix * modelViewMatrix  * vec4( position, 1.0 );\n                }",fragmentShader:"\n                uniform vec3 color;            \n                void main() {           \n                    gl_FragColor = vec4(color,1.0);\n                }\n                ",uniforms:{color:{value:(new g.v).setHex(e)}}})}(t),null===i||void 0===i||i.dispose(),!0}return!1}},{key:"json",get:function(){return{type:this.type,position:{x:this.object.position.x,y:this.object.position.y,z:this.object.position.z},rotation:{x:this.object.quaternion.x,y:this.object.quaternion.y,z:this.object.quaternion.z,w:this.object.quaternion.w},scale:{x:this.object.scale.x,y:this.object.scale.y,z:this.object.scale.z}}}},{key:"setJson",value:function(e){}},{key:"targetInfo",get:function(){return{setJson:this.setJson.bind(this),json:this.json,object:this.object,id:this.id,editable:!0}}},{key:"raycastTarget",get:function(){return this.raycastMesh}},{key:"updateRaycastMesh",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!t)return this.raycastMesh=$e.emptyRaycastMesh(),void this.object.add(this.raycastMesh);if(t instanceof g.Q?e=$e.mergeGroup:t instanceof g.o||t[0]instanceof g.o?e=$e.mergeGeometries:(t instanceof g.sb||t[0]instanceof g.sb)&&(e=$e.mergeMeshes),this.raycastMesh){var n=this.raycastMesh.geometry;this.raycastMesh.geometry=e(t).geometry,n&&n.dispose()}else this.raycastMesh=e(t),this.object.add(this.raycastMesh)}},{key:"addCustumDestory",value:function(e){this.custumDestoryFuncs.push(e)}},{key:"destroy",value:function(){var e;(this.custumDestoryFuncs.forEach((function(e){e()})),this.object.parent&&this.object.parent.remove(this.object),null!=Be.getState().iframeReducer)&&(null===(e=Be.getState().iframeReducer)||void 0===e?void 0:e.sendMessage)(U.deleteobject,{tagId:this.id})}}]),n}($e),dt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e){var i;return Object(m.a)(this,n),(i=t.call(this,e)).name="",i.fileUrl="",i.openLink="",i.thumbnail="",i.imageHash="",i.isFrame=!1,i.linkName="",i.openNewWindow=!1,i.detail="",i.unclickable=!1,i.openLinkDirectly=!1,i.thisCameraCanSee=!1,i.customData="",i.isVertical=!1,i.heightoffset=0,i.widthoffset=0,i.followCamera=!1,i.productId=void 0,i.title=void 0,i.showBox=void 0,i.showTitle=void 0,i.billboradControls=void 0,i.boundaryBox=void 0,i.underPositioningObject=void 0,i.targetHotspotId=void 0,i.hotspotAnimation=void 0,i.azimuthAngle=void 0,i.polarAngle=void 0,i.componentName=void 0,i.floorTargetId=void 0,i.componentData=void 0,i.moduleId=void 0,i.tokenId=void 0,i.nftSource=void 0,i.glbObjectUrl=void 0,i.usdzObjectUrl=void 0,i.purchaseInfo=void 0,i.maxWidth=void 0,i.originRotation=void 0,i.createBoundaryBox(),i}return Object(b.a)(n,[{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{id:this.id,type:this.openNewWindow?qe.OPENWINDOW:qe.SHOWMODAL,isVertical:this.isVertical,mediaClass:this})}},{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{id:this.id,name:this.name,title:this.title,fileUrl:this.fileUrl,openLink:this.openLink,thumbnail:this.thumbnail,imageHash:this.imageHash,linkName:this.linkName,openNewWindow:this.openNewWindow,detail:this.detail,unclickable:this.unclickable,openLinkDirectly:this.openLinkDirectly,thisCameraCanSee:this.thisCameraCanSee,customData:this.customData,isVertical:this.isVertical,followCamera:this.followCamera,productId:this.productId,glbObjectUrl:this.glbObjectUrl,usdzObjectUrl:this.usdzObjectUrl,purchaseInfo:this.purchaseInfo,floorTargetId:this.floorTargetId,componentName:this.componentName,componentData:this.componentData,moduleId:this.moduleId,targetHotspotId:this.targetHotspotId,azimuthAngle:this.azimuthAngle,polarAngle:this.polarAngle,hotspotAnimation:this.hotspotAnimation,showBox:this.showBox,showTitle:this.showTitle,maxWidth:this.maxWidth,tokenId:this.tokenId,nftSource:this.nftSource})}},{key:"setJson",value:function(e){var t;this.name=e.name,this.title=e.title?e.title:this.name,this.fileUrl=e.fileUrl,this.openLink=e.openLink,this.thumbnail=e.thumbnail,this.linkName=e.linkName,this.openNewWindow=e.openNewWindow,this.detail=e.detail,this.unclickable=e.unclickable,this.openLinkDirectly=e.openLinkDirectly,this.thisCameraCanSee=e.thisCameraCanSee,this.moduleId=e.moduleId,this.customData=e.customData,this.maxWidth=null!==(t=e.maxWidth)&&void 0!==t?t:1,this.showBox=e.showBox,this.showTitle=e.showTitle,e.hasOwnProperty("isVertical")&&this.isVertical!=e.isVertical&&(this.isVertical=e.isVertical,this.setObjVertical(e.isVertical)),this.followCamera!=e.followCamera&&(this.followCamera=e.followCamera,this.updateFollowCameraProperty()),this.handleCustomizedData(e)}},{key:"handleCustomizedData",value:function(e){this.productId=e.productId?e.productId:null,this.moduleId=e.moduleId,this.floorTargetId=e.floorTargetId,this.tokenId=e.tokenId,this.nftSource=e.nftSource,this.targetHotspotId=e.targetHotspotId?e.targetHotspotId:null,this.azimuthAngle=e.azimuthAngle?e.azimuthAngle:null,this.polarAngle=e.polarAngle?e.polarAngle:null,this.hotspotAnimation=void 0!==e.hotspotAnimation?e.hotspotAnimation:null,this.usdzObjectUrl=e.usdzObjectUrl?e.usdzObjectUrl:null,void 0!==e.glbObjectUrl&&""!==e.glbObjectUrl&&(this.glbObjectUrl=e.glbObjectUrl,this.purchaseInfo=e.purchaseInfo),void 0!==e.componentName&&(this.componentName=e.componentName,e.componentData&&(this.componentData=e.componentData))}},{key:"init",value:function(e){var t;this.id=e.id,this.name=e.name,this.title=e.title?e.title:this.name,this.fileUrl=e.fileUrl,this.openLink=e.openLink,this.thumbnail=e.thumbnail,this.imageHash=e.imageHash,this.linkName=e.linkName,this.openNewWindow=e.openNewWindow,this.detail=e.detail,this.unclickable=e.unclickable,this.openLinkDirectly=e.openLinkDirectly,this.thisCameraCanSee=e.thisCameraCanSee,this.customData=e.customData,this.isVertical=e.isVertical,this.followCamera=e.followCamera,this.showBox=e.showBox,this.showTitle=e.showTitle,this.maxWidth=null!==(t=e.maxWidth)&&void 0!==t?t:1,this.updateFollowCameraProperty(),this.handleCustomizedData(e)}},{key:"captureMedia",value:function(e){0!=this.followCamera&&(e?this.disableFollowCamera():this.enableFollowCamera())}},{key:"updateFollowCameraProperty",value:function(){1==this.followCamera?(this.enableFollowCamera(),this.getOriginRotation()):(this.disableFollowCamera(),this.setOriginRotation())}},{key:"enableFollowCamera",value:function(){if(!this.billboradControls){var e=new g.l(1e-5,1e-5,1e-5),t=new g.tb({color:65280});this.billboradControls=new g.sb(e,t),this.billboradControls.frustumCulled=!1,this.object.add(this.billboradControls)}var n=this.object;this.billboradControls.onAfterRender=function(e,t,i){var a=new g.Bc,o=new g.Bc;i.getWorldPosition(a),n.getWorldPosition(o);var r=(new g.Bc).subVectors(a,o).normalize();r.y=0;var s=(new g.rb).lookAt(r,new g.Bc(0,0,0),i.up);n.setRotationFromMatrix(s)}}},{key:"disableFollowCamera",value:function(){this.billboradControls&&(this.billboradControls.onAfterRender=function(){})}},{key:"getOriginRotation",value:function(){this.originRotation=this.object.quaternion.clone()}},{key:"setOriginRotation",value:function(){this.originRotation&&this.object.quaternion.set(this.originRotation.x,this.originRotation.y,this.originRotation.z,this.originRotation.w)}},{key:"onMouseMove",value:function(e,t){}},{key:"onMouseEnter",value:function(){}},{key:"onMouseLeave",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"setObjVertical",value:function(e){var t=this.heightoffset*this.object.scale.y,n=this.widthoffset*this.object.scale.z;e?this.type===st.MODEL?(this.object.rotateX(Math.PI/2),this.widthoffset>this.heightoffset?this.object.translateZ(-n):this.object.translateZ(n)):(this.object.rotateX(Math.PI/2),this.object.translateY(t)):this.type===st.MODEL?(this.object.rotateX(-Math.PI/2),this.widthoffset>this.heightoffset?this.object.translateY(-n):this.object.translateY(n)):(this.object.rotateX(-Math.PI/2),this.object.translateZ(-t))}},{key:"createBoundaryBox",value:function(){var e=new g.l(1,1,1),t=new g.tb({transparent:!0,opacity:0});this.boundaryBox=new g.sb(e,t),this.boundaryBox.visible=!1,this.object.add(this.boundaryBox)}},{key:"updateBoundaryBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=this.boundaryBox.geometry,a=new g.l(e,t,n);this.boundaryBox.geometry=a,i&&i.dispose(),this.heightoffset=Math.abs(t/2)}}]),n}(ht),pt=n(58),ft=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.MODEL)).animations=void 0,e.animationList=void 0,e.animationName=void 0,e.animation=void 0,e.size=void 0,e.center=void 0,e.glb=void 0,e.tween=void 0,e.size=new g.Bc,e.center=new g.Bc,e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{animation:this.animationName,animationList:this.animationList})}},{key:"setJson",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,t),this.type!==st.SCENEMODEL&&(this.animationName=t.animation,this.animationList=t.animationList),this.playAnimation();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),this.type!==st.SCENEMODEL&&(this.animationName=t.animation,this.animationList=t.animationList),e.next=4,this.updateModel();case 4:this.playAnimation();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"autoRotate",value:function(e){this.tween=new pt.Tween(e.rotation).to({y:"-"+Math.PI/2},2500).onComplete((function(){Math.abs(e.rotation.z)>=2*Math.PI&&(e.rotation.y=e.rotation.z%(2*Math.PI))})).start(),this.tween.repeat(1/0)}},{key:"playAnimation",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.type!==st.SCENEMODEL&&Be.getState().modeReducer===re.Viewer&&(null!=this.tween&&(this.tween.stop(),this.tween=null),this.animationName&&"autoRotate"===this.animationName?this.autoRotate(this.object):this.play(this.animationName));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateModel",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load(this.fileUrl);case 2:this.normalize(this.glb),this.normalize(this.raycastMesh),this.updateBoundaryBox();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"normalize",value:function(e){var t=new g.Bc;this.object.remove(e),(new g.j).setFromObject(e).getSize(t),this.object.add(e);var n=Math.max(t.x,t.y,t.z);e.scale.x=this.maxWidth/n,e.scale.y=this.maxWidth/n,e.scale.z=this.maxWidth/n}},{key:"setMesh",value:function(e){if(this.glb&&this.object.remove(this.glb),this.glb=e,this.type!==st.SCENEMODEL){var t=wn.inst.mediaManager.viewportControls.postProcessingController;this.glb.children.forEach((function(e){t.selectiveBloomEffect.selection.add(e),e.layers.enable(3)}))}this.object.add(this.glb),this.updateRaycastMesh(this.glb);var n=(new g.j).setFromObject(this.object);n.getSize(this.size),n.getCenter(this.center)}},{key:"setGLTF",value:function(e,t){this.setMesh(e.scene),t&&t(e.scene)}},{key:"load",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(t,r.Model);case 2:i=e.sent,this.animations=i.animations,this.setMesh(i.scene),n&&n(i.scene);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"play",value:function(e){clearTimeout(this.animation);var t=new g.f(this.object),n=this.animations;if(n&&n.length>0){var i=n[0];if(null!=e){var a=g.e.findByName(n,e);null!=a&&(i=a)}t.clipAction(i).play();var o=performance.now();this.animation=setInterval((function(){var e=performance.now(),n=e-o;o=e,t.update(n/1e3)}),30)}}},{key:"stop",value:function(){clearTimeout(this.animation)}},{key:"updateBoundaryBox",value:function(){var e=new g.Bc;this.object.remove(this.glb);var t=(new g.j).setFromObject(this.glb);t.getSize(e),this.object.add(this.glb);var n=Math.max(e.x,e.y,e.z),i=this.boundaryBox.geometry,a=new g.l(e.x/n,e.y/n,e.z/n);this.boundaryBox.geometry=a;var o=(t.max.y+t.min.y)/2;this.boundaryBox.position.y=o,this.heightoffset=Math.abs(t.min.y),this.widthoffset=Math.abs(t.max.z),i&&i.dispose()}}]),n}(dt),vt=n(58),mt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;if(Object(m.a)(this,n),(e=t.call(this,st.PHOTO)).imageMesh=void 0,e.imgMaterial=void 0,e.animation="",e.isThickness=!1,!e.isThickness){var i=new g.Mb(1,1,1,1);e.imgMaterial=new g.tb({map:null,side:g.E,transparent:!0,combine:0}),e.imageMesh=new g.sb(i,e.imgMaterial),e.object.add(e.imageMesh),e.updateRaycastMesh([i])}return e}return Object(b.a)(n,[{key:"FadeOut",value:function(){var e=this,t={fade:1};return new vt.Tween(t).to({fade:.3},1700).easing(vt.Easing.Cubic.Out).onUpdate((function(){e.imgMaterial.opacity=t.fade})).onComplete((function(){e.FadeIn().start()}))}},{key:"FadeIn",value:function(){var e=this,t={fade:.3};return new vt.Tween(t).to({fade:1},1700).easing(vt.Easing.Cubic.In).onUpdate((function(){e.imgMaterial.opacity=t.fade})).onComplete((function(){e.FadeOut().start()}))}},{key:"scaleUp",value:function(){var e=this,t=new g.Bc(1,1,1);return new vt.Tween(t).to(t.addScalar(.3),500).easing(vt.Easing.Cubic.In).onUpdate((function(){e.imageMesh.scale.copy(t)})).onComplete((function(){e.scaleDown().start()}))}},{key:"scaleDown",value:function(){var e=this,t=new g.Bc(1,1,1).addScalar(.3);return new vt.Tween(t).to(t.addScalar(-.3),500).easing(vt.Easing.Cubic.Out).onUpdate((function(){e.imageMesh.scale.copy(t)})).onComplete((function(){e.scaleUp().start()}))}},{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{isThickness:this.isThickness,animation:this.animation})}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),this.name=t.name?t.name:"",this.isThickness=null===(i=t.isThickness)||void 0===i||i,this.animation=t.animation?t.animation:"",e.next=6,this.updateImage();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playAnimation",value:function(){""!==this.animation&&("scale"===this.animation?this.scaleUp().start():"fade"===this.animation&&this.FadeOut().start())}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"setJson",value:function(e){var t;Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.maxWidth=e.maxWidth,this.animation=e.animation?e.animation:"",this.isThickness=null===(t=e.isThickness)||void 0===t||t,this.updateImage()}},{key:"updateImage",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a,o,s,c,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.imageMesh&&(t=this.imageMesh.geometry,(n=this.imageMesh.material)&&n.map&&n.map.dispose?n.dispose():(i=this.imageMesh.material)&&i.length>0&&i.forEach((function(e){return e.dispose()})),t&&t.dispose(),this.object.remove(this.imageMesh),this.imageMesh=null),e.next=3,wn.inst.resLoad.load(this.fileUrl,r.Texture);case 3:(a=e.sent).needsUpdate=!0,this.isThickness?(o=Be.getState().threeViewReducer,"cc37f020-a372-11ec-8de0-ab92a34d08f9"===this.id?this.imgMaterial=new g.tb({map:a,side:g.E,transparent:!0,combine:0,color:5329492}):null!=o.viewportControls.bloomController?this.imgMaterial=new g.tb({map:a,side:g.E,transparent:!0,combine:0,color:9672086}):this.imgMaterial=new g.tb({map:a,side:g.E,transparent:!0,combine:0}),s=[new g.tb({color:0}),new g.tb({color:0}),new g.tb({color:0}),new g.tb({color:0}),this.imgMaterial,new g.tb({color:0})],c=new g.k(1*this.maxWidth,a.image.height/a.image.width*this.maxWidth,.03,1),this.imageMesh=new g.sb(c,s),this.object.add(this.imageMesh),this.imageMesh.layers.enable(3),this.updateRaycastMesh([c]),this.updateBoundaryBox(1*this.maxWidth,a.image.height/a.image.width*this.maxWidth,.03)):(u=new g.tb({map:a,side:g.E,transparent:!0,combine:0}),l=new g.Mb(1*this.maxWidth,a.image.height/a.image.width*this.maxWidth,1,1),this.imageMesh=new g.sb(l,u),this.object.add(this.imageMesh),this.imageMesh.layers.enable(3),this.updateRaycastMesh([l]),this.updateBoundaryBox(1*this.maxWidth,a.image.height/a.image.width*this.maxWidth,.001));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dt),bt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e,i){var a;Object(m.a)(this,n);var o=document.createElement("canvas"),r=o.getContext("2d");return(a=t.call(this,o)).canvas=void 0,a.context=void 0,a.textConfig=void 0,a.backgroundConfig=void 0,a.padding=void 0,a.fontSize=void 0,a.aligment=void 0,a.font=void 0,a.maxWidth=void 0,a.lines=void 0,a.lineSpace=void 0,a.canvas=o,a.context=r,a.textConfig=e,a.backgroundConfig=i,a.maxWidth=1100,a.create(),a}return Object(b.a)(n,[{key:"ratio",get:function(){return this.canvas.width/this.canvas.height}},{key:"lineNumber",get:function(){return this.lines}},{key:"width",get:function(){return this.canvas.width/this.maxWidth}},{key:"height",get:function(){return this.canvas.height/this.maxWidth}},{key:"create",value:function(){var e=this,t=this.textConfig,n=t.labels,i=t.fontWeight,a=t.fontStyle,o=t.fontColor,r=t.padding,s=t.aligment,c=t.fontSize,u=t.lineSpace;this.fontSize=c,this.aligment=s,this.padding=r,this.lineSpace=u,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.font=a+" "+i+" "+c+"px Arial",this.context.font=this.font;var l=this.wrapText(n),h=l.textArray,d=l.canvasWidth,p=l.canvasHeight;if(this.lines=h.length,this.canvas.width=d,this.canvas.height=p,this.backgroundConfig){var f=this.backgroundConfig.fillStyle;this.context.fillStyle=f,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}var v=0,m=this.padding/2;"center"==this.aligment?v=this.canvas.width/2:"left"==this.aligment?v=this.padding/2:"right"==this.aligment&&(v=this.canvas.width-this.padding/2),h.forEach((function(t){e.context.textBaseline="top",e.context.font=e.font,e.context.fillStyle=o,e.context.textAlign=e.aligment,e.context.fillText(t,v,m),m+=c+u}))}},{key:"wrapText",value:function(e){var t,n=this,i=0,a=[];if("string"==typeof e||Array.isArray(e)){if(Array.isArray(e)){this.context.font=this.font,a=e;var o=0;e.forEach((function(e){var t=n.context.measureText(e);o<t.width&&(o=t.width)})),t=o+this.padding,i=this.fontSize*a.length+this.padding+20}else if("string"==typeof e){var r=e.split("");a=[];var s="",c=this.fontSize;this.context.font=this.font;var u=this.context.measureText(e);if(u.width<this.maxWidth)t=u.width+this.padding,i=this.fontSize+this.padding,a=[e];else{t=this.maxWidth+this.padding,i=this.fontSize+this.padding;for(var l=0;l<r.length;l++){var h=s+r[l];this.context.font=this.font,(u=this.context.measureText(h)).width>this.maxWidth&&l>0?(a.push(s),s=r[l],i+=c+this.lineSpace):s=h}a.push(s)}}return{textArray:a,canvasWidth:t,canvasHeight:i}}}}]),n}(g.pc),gt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n),(e=t.call(this,st.TAG)).label=void 0,e.lineMesh=void 0,e.iconSprite=void 0,e.textSprite=void 0,e.raycastCube=void 0,e.textHeight=void 0,e.textWidth=void 0,e.length=.5,e.iconWidth=.1,e.showLine=!0,e.iconTag=void 0,e.iconTag=new g.Q,e.iconTag.renderOrder=10,e.object.add(e.iconTag),e.createIconTag();var i=new g.k(1,1,1),a=new g.tb({color:16777215});return a.opacity=0,e.raycastCube=new g.sb(i,a),e.object.add(e.raycastCube),e}return Object(b.a)(n,[{key:"createIconTag",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new g.nc({map:null}),this.iconSprite=new g.mc(t),this.iconTag.add(this.iconSprite),n=new g.nc({transparent:!0}),this.textSprite=new g.mc(n),this.iconTag.add(this.textSprite),.01,i=new g.l(.01,1,.01),a=new g.tb({color:16777215}),this.lineMesh=new g.sb(i,a),this.iconTag.add(this.lineMesh);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{extData:{length:this.length,label:this.label},iconWidth:this.iconWidth,showLine:this.showLine})}},{key:"setJson",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,t),this.length=t.extData.length,this.showLine=t.showLine,this.label=t.extData.label,this.iconWidth=t.iconWidth,e.next=7,this.updateIcon();case 7:this.updateTag(),this.updateTagRaycast();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),this.length=t.extData.length,this.showLine=t.showLine,this.label=t.extData.label,this.iconWidth=t.iconWidth,e.next=7,this.updateIcon();case 7:this.updateTag(),this.updateTagRaycast();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateTagRaycast",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.raycastCube.geometry,n=Math.max(this.iconWidth,this.textWidth),i=this.length+this.iconWidth+this.textHeight,new g.tb({color:16777215}).opacity=0,a=new g.k(n,n,i),this.raycastCube.geometry=a,this.raycastCube.position.z=i/2,t&&t.dispose(),this.updateRaycastMesh([this.raycastCube]),this.updateBoundaryBox(n,n,i),this.boundaryBox.position.z=i/2;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateIcon",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(this.fileUrl,r.Texture);case 2:t=e.sent,n=this.iconSprite.material.map,this.iconSprite.material.map=t,n&&n.dispose();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateIconScale",value:function(){this.iconSprite.scale.set(this.iconWidth,this.iconWidth,this.iconWidth)}},{key:"updateLabel",value:function(){var e=new bt({labels:this.name,fontWeight:"Normal",fontStyle:"Normal",fontColor:"#ffffff",padding:15,fontSize:40,aligment:"center",lineSpace:0},{fillStyle:"rgba(0,0,0,0.5)"});e.needsUpdate=!0,e.encoding=g.M;var t=4*e.width,n=4*e.height,i=this.textSprite.material.map;this.textSprite.material.map=e,this.textSprite.scale.set(t,n,1),this.textWidth=t,this.textHeight=n,i&&i.dispose()}},{key:"updateTag",value:function(){if(this.iconTag.onBeforeRender=function(){},this.showTitle){var e=this;this.textSprite.onBeforeRender=function(){var t=new g.Bc,n=new g.Bc;e.iconSprite.getWorldPosition(t),n=t.clone().add(new g.Bc(0,e.iconWidth/2+e.textHeight/2,0));var i=e.iconTag.worldToLocal(n);e.textSprite.position.set(i.x,i.y,i.z)},this.textSprite.visible=!0}else this.textSprite.onBeforeRender=function(){},this.textSprite.visible=!1;this.showLine?this.lineMesh.visible=!0:this.lineMesh.visible=!1,this.updateLabel(),this.updateIconScale(),this.lineMesh.scale.setY(this.length),this.lineMesh.position.setY(this.length/2),this.iconSprite.position.setY(this.length+this.iconWidth/2),this.iconTag.rotation.set(Math.PI/2,0,0)}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}}]),n}(dt),yt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.GIF)).css3dObject=void 0,e.gifMesh=void 0,e.imgElement=void 0,e.imgElement=document.createElement("img"),e.css3dObject=new V.a(e.imgElement),e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this))}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),e.next=3,this.updateGif();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onload2promise",value:function(e){return new Promise((function(t,n){e.onload=function(){return t(e)},e.onerror=n}))}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e)}},{key:"updateGif",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.imgElement.src=this.fileUrl,t=this.onload2promise(this.imgElement),e.next=4,t;case 4:n=this.imgElement.naturalWidth,i=this.imgElement.naturalHeight,a=i/n,this.imgElement.style.width=n+"px",this.imgElement.style.height=i+"px",this.css3dObject.scale.set(1/n,1/i*a,1),o=new g.Mb(1,a,1,1),r=new g.tb({opacity:0,color:new g.v(0),blending:g.Db,side:g.E,transparent:!0}),this.gifMesh=new g.sb(o,r),this.gifMesh.add(this.css3dObject),this.object.add(this.gifMesh),this.object.up.copy(new g.Bc(0,0,1)),this.updateRaycastMesh([o]),this.updateBoundaryBox(1,a,.05);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){if(Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),this.gifMesh){var e=this.gifMesh.material;e&&e.length>0&&e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()}));var t=this.gifMesh.geometry;t&&t.dispose()}this.imgElement&&this.imgElement.parentNode.removeChild(this.imgElement)}}]),n}(dt),wt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n),(e=t.call(this,st.TEXT)).label="Text",e.fontWeight="normal",e.fontStyle="normal",e.fontColor="#000000",e.fontSize=60,e.lineSpace=.5,e.aligment="left",e.textMesh=void 0,e.angle=0;var i=new g.tb({map:null,side:g.E});return i.transparent=!0,e.textMesh=new g.sb(new g.Nb(1,1),i),e.object.add(e.textMesh),e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{extData:{label:this.label,fontWeight:this.fontWeight},fontStyle:this.fontStyle,fontColor:this.fontColor,fontSize:this.fontSize,lineSpace:this.lineSpace,aligment:this.aligment,angle:this.angle})}},{key:"setJson",value:function(e){var t;Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.label=e.extData.label,this.fontWeight=e.extData.fontWeight,this.fontStyle=e.fontStyle,this.fontColor=e.fontColor,this.fontSize=e.fontSize,this.lineSpace=e.lineSpace,this.aligment=e.aligment,this.angle=null!==(t=e.angle)&&void 0!==t?t:0,this.rotateText(),this.updateLabel()}},{key:"init",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,e),this.label=e.extData.label,this.fontWeight=e.extData.fontWeight,this.updateLabel()}},{key:"targetInfo",get:function(){return Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this))}},{key:"updateLabel",value:function(){var e=new bt({labels:this.label,fontWeight:this.fontWeight,fontStyle:this.fontStyle,fontColor:this.fontColor,padding:20,fontSize:this.fontSize,aligment:this.aligment,lineSpace:this.lineSpace},{fillStyle:"rgba(0,0,0,0.0)"});e.needsUpdate=!0,e.encoding=g.M;var t=this.textMesh.material.map,n=this.textMesh.geometry;this.textMesh.material.map=e;var i=2*e.width,a=2*e.height;this.textMesh.geometry=new g.Mb(i,a),t&&t.dispose(),n&&n.dispose(),this.updateRaycastMesh(this.textMesh.geometry),this.updateBoundaryBox(i,a,.001)}},{key:"rotateText",value:function(){var e=this.object.rotation.z,t=this.angle/180*Math.PI;this.object.rotateZ(t-e)}}]),n}(dt),xt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(m.a)(this,e),this.videoID=void 0,this.videoElement=void 0,this.timer=void 0,this.isPlaying=void 0,this.isMuted=void 0,this.player=void 0,this.width=640,this.height=360,this.autoAudio=void 0,this.autoPlay=void 0,this.maxWidth=1,this.videoID=t,this.autoPlay=n,this.autoAudio=i,this.isMuted=!this.autoAudio}return Object(b.a)(e,[{key:"init",value:function(e){e&&(this.maxWidth=e.maxWidth),this.autoPlay&&this.playVideo()}},{key:"play",value:function(){this.isPlaying?this.pauseVideo():this.playVideo(),this.isPlaying=!this.isPlaying}},{key:"playVideo",value:function(){}},{key:"pauseVideo",value:function(){}},{key:"getVolume",value:function(){}},{key:"muted",value:function(e){this.isMuted=e}},{key:"setVolume",value:function(e){}},{key:"destroy",value:function(){this.videoElement&&this.videoElement.parentNode.removeChild(this.videoElement),this.timer&&clearInterval(this.timer)}},{key:"ratio",get:function(){return this.height/this.width}}]),e}(),Ot=n(190),jt=n.n(Ot),kt=n(104),Mt=n.n(kt),At=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).play=void 0,e.videoObj=void 0,e}return Object(b.a)(n,[{key:"init",value:function(){return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,{maxWidth:2}),this.createObject()}},{key:"playVideo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.timer||(this.timer=setInterval(function(){var t=this;this.player.getPlayerState().then(function(){var n=Object(v.a)(f.a.mark((function n(i){var a;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i===Mt.a.PLAYING){n.next=9;break}return n.next=3,t.player.getVolume();case 3:return a=n.sent,t.muted(!0),t.player.setVolume(0),n.next=8,t.player.playVideo();case 8:(t.autoAudio||e)&&(t.muted(!1),t.player.setVolume(null!==a&&void 0!==a?a:100));case 9:i===Mt.a.PLAYING&&(clearInterval(t.timer),t.timer=null,t.isPlaying=!0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}.bind(this),500))}},{key:"pauseVideo",value:function(){this.player.pauseVideo(),clearInterval(this.timer),this.timer=null,this.isPlaying=!1}},{key:"setVolume",value:function(e){this.player.setVolume(e)}},{key:"getVolume",value:function(){return this.player.getVolume()}},{key:"muted",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"muted",this).call(this,e),e?this.player.mute():this.player.unMute()}},{key:"destroy",value:function(){if(Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),this.videoObj){var e=this.videoObj.geometry,t=this.videoObj.material;t&&t.length>0&&t.forEach((function(e){return e.dispose()})),e&&e.dispose()}}},{key:"createObject",value:function(){var e=this,t=document.createElement("div");t.style.width=this.width+"px",t.style.height=this.height+"px";var n=document.createElement("div");t.appendChild(n),n.style.width="100%",n.style.height="100%",this.player=new jt.a(n),this.player.loadVideoById(this.videoID),this.isPlaying=!1,this.player.on("ready",(function(e){})),this.player.on("stateChange",(function(t){t.data===Mt.a.ENDED&&e.playVideo(!e.isMuted)})),this.videoElement=t;var i=new V.a(t),a=this.maxWidth,o=this.ratio*this.maxWidth;i.scale.set(1/this.width*a,1/this.height*o,1);var r=new g.tb({opacity:0,color:new g.v(0),blending:g.Db,side:g.E,transparent:!0}),s=new g.Mb(a,o),c=new g.sb(s,r);return c.add(i),this.videoObj=c,c}}]),n}(xt),Et=n(191),Tt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).player=void 0,e.videoObj=void 0,e}return Object(b.a)(n,[{key:"init",value:function(){return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,{maxWidth:2}),this.createObject()}},{key:"playVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.timer=setInterval(function(){this.player.getPaused().then(function(e){!0===e?(this.player.play(),this.player.setVolume(0),this.player.setMuted(!0),this.isPlaying=!0):clearInterval(this.timer)}.bind(this))}.bind(this),500);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pauseVideo",value:function(){this.player.pause(),clearInterval(this.timer),this.isPlaying=!1}},{key:"setVolume",value:function(e){this.player.setVolume(e/100)}},{key:"getVolume",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.player.getVolume();case 2:return t=e.sent,e.abrupt("return",100*t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){if(this.videoObj){var e=this.videoObj.geometry,t=this.videoObj.material;t&&t.length>0&&t.forEach((function(e){return e.dispose()})),e&&e.dispose()}}},{key:"createObject",value:function(){var e=this,t=document.createElement("div");t.style.width=this.width+"px",t.style.height=this.height+"px";var n={id:this.videoID,autoplay:!1,autopause:!1,loop:!0,muted:!0,width:this.width,height:this.height};this.player=new Et.a(t,n),this.isPlaying=!1,this.player.ready().then((function(){e.pauseVideo()})),this.player.on("ended",(function(){e.playVideo()})),this.videoElement=t;var i=new V.a(t),a=this.maxWidth,o=this.ratio*this.maxWidth;i.scale.set(1/this.width*a,1/this.height*o,1);var r=new g.tb({opacity:0,color:new g.v(0),blending:g.Db,side:g.E,transparent:!0}),s=new g.k(a,o,.05,1),c=[new g.tb({color:5987163}),new g.tb({color:5987163}),new g.tb({color:5987163}),new g.tb({color:5987163}),r,new g.tb({color:5987163})],u=new g.sb(s,c);return this.videoObj=u,u.add(i),u}}]),n}(xt),Ct=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){return Object(m.a)(this,n),t.call(this,{fragmentShader:"\nuniform mediump sampler2D tex;\nuniform mediump vec3 color;\nuniform float similarity;\nuniform float smoothness;\nvarying mediump vec2 vUv;\n\nvoid main() {\n  mediump vec4 tColor = texture2D( tex, vUv );\n\n  float Y1 = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n  float Cr1 = color.r - Y1;\n  float Cb1 = color.b - Y1;\n\n  float Y2 = 0.299 * tColor.r + 0.587 * tColor.g + 0.114 * tColor.b;\n  float Cr2 = tColor.r - Y2;\n  float Cb2 = tColor.b - Y2;\n\n  float blend = smoothstep(similarity, similarity + smoothness, distance(vec2(Cr2, Cb2), vec2(Cr1, Cb1)));\n  gl_FragColor = vec4(tColor.rgb, tColor.a * blend);\n}\n",vertexShader:"\nvarying mediump vec2 vUv;\nvoid main() {\nvUv = uv;\nmediump vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}\n",uniforms:{similarity:{value:.5},smoothness:{value:.1},tex:{value:null},color:{value:null}}})}return n}(g.fc),St=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).player=void 0,e.GreenVideoObj=void 0,e.videoTexture=void 0,e.url=void 0,e}return Object(b.a)(n,[{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.url=t,e.next=3,wn.inst.resLoad.load(t,r.Video);case 3:return i=e.sent,this.width=i.width,this.height=i.height,this.player=i.video,this.GreenVideoObj=this.createGreenVideo(),Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this),e.next=11,this.playVideo();case 11:return e.abrupt("return",this.GreenVideoObj);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.player.load();case 2:return e.next=4,this.player.play();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pauseVideo",value:function(){wn.inst.resLoad.removeVideo(this.player)}},{key:"destroy",value:function(){var e=this.GreenVideoObj.material.map,t=this.GreenVideoObj.geometry;e&&e.dispose(),t&&t.dispose()}},{key:"createGreenVideo",value:function(){var e=new g.Mb(this.maxWidth*this.width/this.height,this.maxWidth,1,1),t=new g.Ec(this.player);t.generateMipmaps=!0,t.minFilter=g.hb,t.magFilter=g.hb,t.format=g.Xb;var n=new Ct;n.uniforms.tex.value=t,n.uniforms.color.value=[0,212/255,50/255];var i=new g.fc({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:n.uniforms,transparent:!0});return new g.sb(e,i)}}]),n}(xt),It=n(109),Pt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){return Object(m.a)(this,n),t.call(this,{fragmentShader:"\nuniform mediump sampler2D tex;\nuniform mediump vec3 color;\nvarying mediump vec2 vUv;\nvoid main() {\n  mediump vec3 tColor = texture2D( tex, vUv ).rgb;\n  gl_FragColor = vec4(tColor, 1.0);\n}\n",vertexShader:"\nvarying mediump vec2 vUv;\nvoid main() {\nvUv = uv;\nmediump vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}\n",uniforms:{tex:{value:null},color:{value:null}}})}return n}(g.fc),Rt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).player=void 0,e.videoTexture=void 0,e.videoObj=void 0,e}return Object(b.a)(n,[{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t,i){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.includes("https://storage.opensea.io/files")&&(t=t.replace("https://storage.opensea.io/files","https://openseauserdata.com/files")),e.next=3,wn.inst.resLoad.load(t,r.Video);case 3:return a=e.sent,this.width=a.width,this.height=a.height,this.player=a.video,Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,{maxWidth:i}),this.videoObj=this.createVideo(),e.abrupt("return",this.videoObj);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"playVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.player&&(this.autoAudio&&e?this.muted(!1):this.muted(!0),this.isPlaying=!0,this.player.volume=1,this.player.play())}},{key:"pauseVideo",value:function(){this.isPlaying=!1,this.player.pause()}},{key:"muted",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"muted",this).call(this,e),this.player&&(this.player.muted=e)}},{key:"setVolume",value:function(e){e>0&&(this.player.muted=!1),this.player.volume=e/100}},{key:"getVolume",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.player){e.next=3;break}return t=this.player.volume,e.abrupt("return",100*t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){if(this.player&&(this.player.pause(),this.player.removeAttribute("src"),this.player.remove(),this.videoObj)){var e=this.videoObj.geometry,t=this.videoObj.material;t&&t.length>0&&t.forEach((function(e){return e.dispose()})),e&&e.dispose()}}},{key:"createVideo",value:function(){var e=new g.Bc(1,1,1);e.x=1*this.maxWidth,e.y=this.maxWidth*this.height/this.width;var t=new g.k(e.x,e.y,.03,1),n=new g.Ec(this.player);n.format=g.Wb;var i=new Pt;i.uniforms.tex.value=n;var a=new g.fc({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:i.uniforms,transparent:!0}),o=[new g.tb({color:0}),new g.tb({color:0}),new g.tb({color:0}),new g.tb({color:0}),a,new g.tb({color:0})];return new g.sb(t,o)}}]),n}(xt),Dt=n.p+"static/media/play-btn.def29526.svg",Bt=n.p+"static/media/loader.54ebfe05.png",Lt=n(363),Nt=function(){function e(t,n,i,a,o){Object(m.a)(this,e),this.texture=t,this.tilesAmountHorizontally=n,this.tilesAmountVertically=i,this.tilesTotalAmount=a,this.currentFrameDisplayTime=0,this.currentFrame=0,this.clock=new g.u,this.end$=new Lt.a,this.frameDisplayDuration=void 0,this.tilesTotalAmount-=1,this.frameDisplayDuration=1e3/o,this.texture.wrapS=g.bc,this.texture.wrapT=g.bc,this.texture.repeat.set(1/n,1/i)}return Object(b.a)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.currentFrame=e,this.currentFrameDisplayTime=0,this.clock=new g.u,this.updateFrame(),this.texture}},{key:"animate",value:function(){for(this.currentFrameDisplayTime+=1e3*this.clock.getDelta();this.currentFrameDisplayTime>this.frameDisplayDuration;)this.currentFrameDisplayTime-=this.frameDisplayDuration,this.currentFrame===this.tilesTotalAmount&&this.end$.next(),this.currentFrame=this.currentFrame<this.tilesTotalAmount?this.currentFrame+1:0,this.updateFrame()}},{key:"end",get:function(){return this.end$.asObservable()}},{key:"updateFrame",value:function(){var e=1/this.tilesAmountVertically,t=this.currentFrame%this.tilesAmountHorizontally,n=Math.floor(this.currentFrame/this.tilesAmountHorizontally);this.texture.offset.x=t/this.tilesAmountHorizontally,this.texture.offset.y=1-n/this.tilesAmountVertically-e}}]),e}(),zt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e,i,a){var o;return Object(m.a)(this,n),(o=t.call(this)).thumbnail=void 0,o.playButton=void 0,o.loaderMesh=void 0,o.thumbnailURL=void 0,o.thumbnailGeo=void 0,o.thumbnailMat=void 0,o.playBtnGeo=void 0,o.playBtnMat=void 0,o.loaderGeo=void 0,o.loaderMat=void 0,o.maxWidth=void 0,o.isH5Video=void 0,o.loader=void 0,o.animation=void 0,o.boxScale=void 0,o.thumbnailURL=e,o.maxWidth=null!==i&&void 0!==i?i:1,o.isH5Video=null===a||void 0===a||a,o}return Object(b.a)(n,[{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateThumbnail();case 2:return e.next=4,this.updatePlayBtn();case 4:return e.next=6,this.updateLoaderIcon();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enablePlayButton",value:function(e){this.getObjectByName("thumbnail").visible=!1,this.getObjectByName("play").visible=!!e}},{key:"enableLoader",value:function(e){var t=this;e?(this.animation=setInterval((function(){t.loader.animate()}),30),this.getObjectByName("loader").visible=!0,this.getObjectByName("play").visible=!1):(clearTimeout(this.animation),this.getObjectByName("loader").visible=!1,this.getObjectByName("play").visible=!0)}},{key:"updateThumbnail",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(this.thumbnailURL,r.Texture);case 2:t=e.sent,this.thumbnailMat=new g.tb({map:t,side:g.E,transparent:!0,combine:0}),n=[new g.tb({color:5987163}),new g.tb({color:5987163}),new g.tb({color:5987163}),new g.tb({color:5987163}),this.thumbnailMat,new g.tb({color:5987163})],this.thumbnailGeo=new g.k(1*this.maxWidth,t.image.height/t.image.width*this.maxWidth,.03,1),this.boxScale=new g.Bc(1*this.maxWidth,t.image.height/t.image.width*this.maxWidth,.032),this.thumbnail=new g.sb(this.thumbnailGeo,n),this.thumbnail.name="thumbnail",this.isH5Video||(1.25,i=this.thumbnail.scale.clone(),a=t.image.height/t.image.width,i.x=2,i.y=1.125/a,this.thumbnail.scale.copy(i)),this.add(this.thumbnail);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateLoaderIcon",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(Bt,r.Texture);case 2:(t=e.sent).needsUpdate=!0,this.loader=new Nt(t,5,2,15,10),n=this.loader.init(),this.loaderMat=new g.tb({map:n,side:g.E,transparent:!0,combine:0}),this.loaderMat.needsUpdate=!0,this.loaderGeo=new g.Mb(1*this.maxWidth,t.image.height/t.image.width*this.maxWidth,1,1),this.loaderMesh=new g.sb(this.loaderGeo,this.loaderMat),this.loaderMesh.name="loader",this.loaderMesh.scale.copy(new g.Bc(.25,.6,1)),this.loaderMesh.translateZ(.032),this.loaderMesh.visible=!1,this.add(this.loaderMesh);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updatePlayBtn",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(Dt,r.Texture);case 2:t=e.sent,this.playBtnMat=new g.tb({map:t,side:g.E,transparent:!0,combine:0}),this.playBtnGeo=new g.Mb(1*this.maxWidth,t.image.height/t.image.width*this.maxWidth,1,1),this.playButton=new g.sb(this.playBtnGeo,this.playBtnMat),this.playButton.name="play",this.playButton.scale.copy(new g.Bc(.2,.2,1)),this.playButton.translateZ(.032),this.add(this.playButton);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e,t,n,i,a,o;this.parent&&this.parent.remove(this);var r=this.thumbnail.material;r&&r.length>0&&r.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),null===(e=this.playBtnGeo)||void 0===e||e.dispose(),null===(t=this.playBtnMat)||void 0===t||t.dispose(),null===(n=this.loaderGeo)||void 0===n||n.dispose(),null===(i=this.loaderMat)||void 0===i||i.dispose(),null===(a=this.thumbnailGeo)||void 0===a||a.dispose(),null===(o=this.thumbnailMat)||void 0===o||o.dispose(),this.playBtnGeo=null,this.playBtnMat=null,this.thumbnailGeo=null,this.thumbnailMat=null}}]),n}(g.Q);!function(e){e.youtube="youtube",e.vimeo="vimeo",e.greenVideo="greenVideo",e.h5Video="h5Video"}(lt||(lt={}));var Ut,Ht=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.VIDEO)).videoType=void 0,e.videoId=void 0,e.videoPlayer=void 0,e.autoPlay=void 0,e.autoAudio=void 0,e.thumbnailTexture=void 0,e.updateRaycastMesh(),e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{videoType:this.videoType.toString(),videoId:this.videoId,autoPlay:this.autoPlay,autoAudio:this.autoAudio})}},{key:"targetInfo",get:function(){return Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this))}},{key:"videoStatus",get:function(){return this.videoPlayer.isPlaying}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i,a,o,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),i=t.videoType,a=t.videoId,o=t.fileUrl,r=t.autoPlay,s=t.autoAudio,this.autoPlay=null!==r&&void 0!==r&&r,this.autoAudio=null!==s&&void 0!==s&&s,this.videoId=a,this.videoType=lt[i],this.fileUrl=o,this.thumbnail=this.thumbnail.replace("256","1024"),!this.videoType){e.next=22;break}e.t0=this.videoType,e.next=e.t0===lt.vimeo||e.t0===lt.youtube?13:e.t0===lt.h5Video?16:e.t0===lt.greenVideo?20:22;break;case 13:return e.next=15,this.loadThumbnail(!1);case 15:return e.abrupt("break",22);case 16:return e.next=18,this.loadThumbnail(!0);case 18:return Be.getState().modeReducer==re.Viewer&&this.autoPlay&&!this.autoAudio&&(y.isMobile||G()(navigator.userAgent)||this.toggle()),e.abrupt("break",22);case 20:return this.toggle(),e.abrupt("break",22);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.videoId=e.videoId,this.videoType=lt[e.videoType],this.autoPlay=e.autoPlay,this.autoAudio=e.autoAudio,this.updateVideo()}},{key:"loadThumbnail",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.thumbnailTexture=t?new zt(this.thumbnail,this.maxWidth):new zt(this.thumbnail,this.maxWidth,!1),e.next=3,this.thumbnailTexture.init();case 3:this.thumbnailTexture.position.copy(this.object.position),this.thumbnailTexture.rotation.copy(this.object.rotation),this.object.attach(this.thumbnailTexture),this.updateBoundaryBox(this.thumbnailTexture.boxScale.x,this.thumbnailTexture.boxScale.y,this.thumbnailTexture.boxScale.z),this.updateRaycastMesh([this.thumbnailTexture.thumbnail]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadVideoUrl",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoType){e.next=32;break}e.t0=this.videoType,e.next=e.t0===lt.vimeo||e.t0===lt.youtube?4:e.t0===lt.h5Video?8:e.t0===lt.greenVideo?15:23;break;case 4:if(!this.videoId){e.next=7;break}return e.next=7,this.loadVideo(this.videoType,this.videoId);case 7:return e.abrupt("break",29);case 8:if(!this.fileUrl){e.next=13;break}return e.next=11,this.loadH5Video(this.fileUrl);case 11:e.next=14;break;case 13:It.error("Video url not found: ".concat(this.id));case 14:return e.abrupt("break",29);case 15:if(!this.fileUrl){e.next=21;break}return e.next=18,this.loadGreenVideo(this.fileUrl);case 18:this.isVertical=!0,e.next=22;break;case 21:It.error("Video url not found: ".concat(this.id));case 22:return e.abrupt("break",29);case 23:if(!this.fileUrl){e.next=28;break}return e.next=26,this.loadH5Video(this.fileUrl);case 26:e.next=29;break;case 28:It.error("videoSource undefined");case 29:this.updateVideo(),e.next=33;break;case 32:It.error("Video data not found: ".concat(this.id));case 33:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggle",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!this.videoPlayer||!this.videoPlayer.isPlaying){e.next=6;break}this.videoPlayer.pauseVideo(),this.thumbnailTexture.enablePlayButton(!0),e.next=13;break;case 6:if(this.videoPlayer){e.next=11;break}return this.thumbnailTexture.enableLoader(!0),e.next=10,this.loadVideoUrl();case 10:this.thumbnailTexture.enableLoader(!1);case 11:this.videoPlayer.playVideo(t),this.thumbnailTexture.enablePlayButton(!1);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pauseVideo",value:function(){this.videoPlayer.pauseVideo()}},{key:"playVideo",value:function(){this.videoPlayer.playVideo()}},{key:"updateVideo",value:function(){}},{key:"destroy",value:function(){Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),this.thumbnailTexture.destroy(),this.videoPlayer&&this.videoPlayer.destroy()}},{key:"loadVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i,a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t===lt.youtube?(this.videoPlayer=new At(n,this.autoPlay,this.autoAudio),this.videoType=lt.youtube,(a=this.videoPlayer.init()).name="youtube",this.object.add(a),this.updateRaycastMesh(a.geometry),i=this.videoPlayer.ratio):t===lt.vimeo&&(this.videoPlayer=new Tt(n),this.videoType=lt.vimeo,o=this.videoPlayer.init(),this.object.add(o),this.updateRaycastMesh(o.geometry),this.autoPlay&&this.videoPlayer.play(),i=this.videoPlayer.ratio),this.updateBoundaryBox(2,2*i,.05);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadGreenVideo",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoPlayer=new St("",this.autoPlay,this.autoAudio),this.videoType=lt.greenVideo,e.t0=this.object,e.next=5,this.videoPlayer.init(t);case 5:e.t1=e.sent,e.t0.add.call(e.t0,e.t1),this.updateBoundaryBox(1*this.maxWidth,this.videoPlayer.height/this.videoPlayer.width*this.maxWidth,.05);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadH5Video",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.videoPlayer=new Rt("",this.autoPlay,this.autoAudio),this.videoType=lt.h5Video,e.t0=this.object,e.next=5,this.videoPlayer.init(t,this.maxWidth);case 5:e.t1=e.sent,e.t0.add.call(e.t0,e.t1),this.updateBoundaryBox(1*this.maxWidth,this.videoPlayer.height/this.videoPlayer.width*this.maxWidth,.05);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),Vt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n),(e=t.call(this,st.WEB)).width=void 0,e.height=void 0,e.webMesh=void 0,e.webpage=void 0,e.iframeElement=void 0,e.css3dObject=void 0,e.width=2e3,e.height=1e3,e.iframeElement=document.createElement("iframe"),e.iframeElement.style.width=e.width+"px",e.iframeElement.style.height=e.height+"px",e.iframeElement.style.border="0px",e.iframeElement.style.opacity="0.999",e.css3dObject=new V.a(e.iframeElement);var i=e.height/e.width;e.css3dObject.scale.set(1/e.width,1/e.height*i,1);var a=new g.Mb(1,i),o=new g.tb({opacity:0,color:new g.v(0),blending:g.Db,side:g.E,transparent:!0});return e.webMesh=new g.sb(a,o),e.webMesh.add(e.css3dObject),e.object.add(e.webMesh),e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{extData:{webPage:this.webpage}})}},{key:"init",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,e),this.webpage=e.extData.webPage,this.iframeElement.src=this.webpage,this.updateRaycastMesh([this.webMesh.geometry]),this.updateBoundaryBox(1,this.height/this.width,.001)}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.openLink=e.openLink,this.updateRaycastMesh([this.webMesh.geometry])}},{key:"destroy",value:function(){Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),this.iframeElement&&this.iframeElement.parentNode.removeChild(this.iframeElement)}}]),n}(dt),Ft=n(58),_t=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.HOTSPOT)).lowerSkybox=void 0,e.cameraHeight=void 0,e.spaceId=void 0,e.higherSkybox=void 0,e.neighbors=void 0,e.uvRotation=void 0,e.hide=void 0,e.hotspotColor=void 0,e.hotspotScale=void 0,e.mouseIsEnter=!1,e.outterRing=void 0,e.innerRing=void 0,e.outterMesh=void 0,e.tween=void 0,e.innerMesh=void 0,e.material=void 0,e}return Object(b.a)(n,[{key:"targetInfo",get:function(){return Object(x.a)({type:qe.MOVE},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this))}},{key:"info",set:function(e){this.id=e.id,this.lowerSkybox=e.lowerSkybox,this.cameraHeight=e.cameraHeight,this.spaceId=e.spaceId,this.higherSkybox=e.higherSkybox,this.neighbors=e.neighbors,this.uvRotation=e.rotation,this.hide=!!e.hide,this.outterMesh=new g.Q,this.hotspotScale=e.hotspotScale,this.hotspotColor=e.hotspotColor,this.createHotspot(e)}},{key:"visible",set:function(e){this.outterMesh.visible=e,this.innerMesh.visible=e}},{key:"createOutterMesh",value:function(){var e=new g.cc(.17,.2,36,1,1,1.7),t=new g.sb(e,this.material);t.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2);var n=new g.cc(.17,.2,36,1,3,1.7),i=new g.sb(n,this.material);i.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2);var a=new g.cc(.17,.2,36,1,5,1.7),o=new g.sb(a,this.material);o.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2),this.outterMesh.add(t),this.outterMesh.add(i),this.outterMesh.add(o)}},{key:"createHotspot",value:function(e){var t=e.position;this.material=new g.tb({map:null,side:g.E,transparent:!0,opacity:.3,depthTest:!0,color:new g.v(this.hotspotColor)}),this.createOutterMesh(),this.tween=new Ft.Tween(this.outterMesh.rotation).to({y:"-"+Math.PI/2},1e3).delay(100).onComplete((function(){Math.abs(this.outterMesh.rotation.rotation.y)>=2*Math.PI&&(this.outterMesh.rotation.y=this.outterMesh.rotation.y%(2*Math.PI))})),y.isMobile&&(this.tween.start(),this.tween.repeat(1/0)),this.innerRing=new g.cc(.11,.13,36,1,32),this.innerMesh=new g.sb(this.innerRing,this.material),this.innerMesh.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2),this.object.add(this.outterMesh),this.object.add(this.innerMesh),this.object.position.set(t.x,t.y,t.z),this.object.scale.addScalar(this.hotspotScale);var n=new g.jc(.5,32,32);this.updateRaycastMesh(n)}},{key:"onMouseEnter",value:function(){!1!==this.mouseIsEnter&&null!=this.mouseIsEnter||(this.mouseIsEnter=!0,this.material.opacity=1,this.tween.start(),this.tween.repeat(1/0))}},{key:"onMouseLeave",value:function(){!0===this.mouseIsEnter&&(this.mouseIsEnter=!1,this.material.opacity=.3,this.tween.stop())}},{key:"onMouseMove",value:function(){}},{key:"onMouseUp",value:function(){}},{key:"destroy",value:function(){this.tween.stop(),this.outterMesh.traverse((function(e){return e.remove()})),this.innerRing.dispose(),this.material.dispose()}}]),n}(ht),Wt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){return Object(m.a)(this,n),t.call(this,st.PORTAL)}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{openLink:this.openLink})}},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e)}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),e.next=3,this.load(this.fileUrl,this.maxWidth);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i,a,o,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(t,r.Texture);case 2:(i=e.sent).needsUpdate=!0,a=new g.Mb(1*n,i.image.height/i.image.width*n,1,1),o=new g.tb({map:i,side:g.E,transparent:!0,combine:0}),s=new g.sb(a,o),this.object.add(s),this.updateRaycastMesh(a),this.updateBoundaryBox(1*n,i.image.height/i.image.width*n,.001);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{type:qe.REDIRECT,url:this.openLink})}}]),n}(dt),Gt=n(58),Yt=.22,Zt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.AVATAR)).videoContainer=void 0,e.videoTexture=void 0,e.isAnimating=void 0,e.avatarPlayer=void 0,e.avatarData=void 0,e.hideBody=void 0,e.streamGeo=void 0,e.playerHeight=void 0,e.photoMesh=void 0,e.textMesh=void 0,e.profileGroup=void 0,e.volumeRingMesh=void 0,e.tween=void 0,e.isPlaying=void 0,e.avatarImageBody=void 0,e.avatarAnimationBody=void 0,e.timer=void 0,e}return Object(b.a)(n,[{key:"json",get:function(){return this.avatarData}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i,a,o,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),i=t.id,a=t.name,this.id=i,this.avatarData=t,this.isAnimating=!1,this.playerHeight=1.8,this.name=a,this.profileGroup=new g.Q,this.hideBody=!1,this.profileGroup.position.y=this.hideBody?.35:this.playerHeight+.25,this.profileGroup.position.z=.05,o=new g.Mb(1,1,1,1),r=new g.tb({transparent:!0}),this.textMesh=new g.sb(o,r),this.updateLabelText(),this.addVolumeRing(),e.next=18,this.loadAvatarInfo();case 18:if(this.hideBody){e.next=21;break}return e.next=21,this.loadAvatarImageBody(this.avatarData.bodyImageUrl);case 21:this.isVertical=!0,this.object.add(this.profileGroup),(s=new g.sb(new g.Mb(.5,4,1,1),new g.tb({transparent:!0}))).visible=!1,this.object.add(s),this.updateBoundaryBox(1,1,.001),this.updateRaycastMesh([s.geometry]);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{type:qe.AVATAR,id:this.id})}},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.avatarData=e}},{key:"stopStreamVideo",value:function(){var e=document.getElementById("avatar-video-"+this.id);if(e&&e.remove(),this.streamGeo){var t=this.streamGeo.geometry,n=this.streamGeo.material;null===t||void 0===t||t.dispose(),null===n||void 0===n||n.dispose(),this.profileGroup.remove(this.streamGeo)}this.photoMesh.visible=!0}},{key:"move",value:function(e,t){var n=this,i=this.object.position.clone(),a=new Gt.Tween(i);e&&(wn.inst.avatarsMgr.hotspotAvatarCountList[t]+=1,a.to(e,1500).easing(Gt.Easing.Circular.Out).onUpdate((function(){n.isAnimating=!0,n.object.position.copy(i)})).onComplete((function(){n.isAnimating=!1,n.avatarData.hotspotId=t})).start())}},{key:"playStreamVideo",value:function(e){if(e){var t=document.getElementById("avatar-video-"+this.id);if(!t){this.videoContainer=document.createElement("div"),this.videoContainer.id="avatar-video-".concat(this.id),document.querySelector(".viewerContainer").appendChild(this.videoContainer),t=document.getElementById("avatar-video-"+this.id),e.play(t),this.photoMesh.visible=!1;var n=t.getElementsByClassName("agora_video_player");if(n&&n.length>0){var i=new g.Ec(n[0]);i.format=g.Wb,i.minFilter=g.hb,i.magFilter=g.hb,i.flipY=!0;var a=new Pt;a.uniforms.tex.value=i;var o=new g.fc({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,transparent:!0}),r=new g.s(.3,32);this.streamGeo=new g.sb(r,o),this.profileGroup.add(this.streamGeo)}}}}},{key:"scaleUp",value:function(){var e=this,t=new g.Bc(1,1,1);return new Gt.Tween(t).to(t.addScalar(Yt),1e3).easing(Gt.Easing.Cubic.In).onUpdate((function(){e.profileGroup.scale.copy(t)})).onComplete((function(){e.tween=e.scaleDown(),e.tween.start()}))}},{key:"scaleDown",value:function(){var e=this,t=new g.Bc(1,1,1).addScalar(Yt);return new Gt.Tween(t).to(t.addScalar(-.22),1e3).easing(Gt.Easing.Cubic.Out).onUpdate((function(){e.profileGroup.scale.copy(t)})).onComplete((function(){e.tween=e.scaleUp(),e.tween.start()}))}},{key:"playVolumeAnimation",value:function(){this.isPlaying||(this.volumeRingMesh.visible=!0,this.scaleUp().start(),this.isPlaying=!0)}},{key:"stopVolumeAnimation",value:function(){this.tween&&(this.volumeRingMesh.visible=!1,this.tween.stop(),this.profileGroup.scale.copy(new g.Bc(1,1,1)),this.isPlaying=!1)}},{key:"addVolumeRing",value:function(){var e=new g.cc(.31,.34,36,1,0,2*Math.PI),t=new g.tb({color:2697861});this.volumeRingMesh=new g.sb(e,t),this.profileGroup.add(this.volumeRingMesh),this.volumeRingMesh.visible=!1}},{key:"loadAvatarInfo",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.s(.3,32),e.next=3,wn.inst.resLoad.load(this.avatarData.photoUrl,r.Texture);case 3:n=e.sent,i=new g.tb({map:n,side:g.E,transparent:!0,combine:0}),this.photoMesh=new g.sb(t,i),this.profileGroup.add(this.photoMesh);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateLabelText",value:function(){if(this.name){var e=new bt({labels:this.name,fontWeight:"Bold",fontStyle:"Normal",fontColor:"#ffffff",padding:15,fontSize:30,aligment:"center",lineSpace:25},{fillStyle:"rgba(0,0,0,0.5)"});e.needsUpdate=!0,e.encoding=g.M;var t=1.5*e.width,n=1.5*e.height,i=this.textMesh.material.map;this.textMesh.material.map=e,this.textMesh.scale.set(t,n,1),this.textMesh.position.y=.15,this.textMesh.position.z=.05,this.profileGroup.add(this.textMesh),i&&i.dispose()}else this.textMesh.visible=!1}},{key:"randomPlayAvatarAnimation",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Math.floor(8*Math.random()),this.avatarPlayer||1!=t){e.next=10;break}if(!this.avatarData.animations){e.next=8;break}return n=Object.keys(this.avatarData.animations),i=Math.floor(Math.random()*n.length),e.next=7,this.playAvatarAnimation(n[i]);case 7:return e.abrupt("return",!0);case 8:e.next=11;break;case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playAvatarAnimation",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.avatarImageBody){e.next=2;break}return e.abrupt("return");case 2:if(!this.avatarPlayer&&t&&this.avatarData.animations){e.next=4;break}return e.abrupt("return");case 4:return this.avatarData.animationName=t,n=this.avatarData.animations,this.avatarPlayer=new St(""),this.avatarPlayer.maxWidth=this.playerHeight,e.next=10,this.avatarPlayer.init(n[t]);case 10:this.avatarAnimationBody=e.sent,this.avatarAnimationBody.position.y=.5*this.playerHeight,this.object.add(this.avatarAnimationBody),i=this,this.avatarImageBody.visible=!1,this.avatarAnimationBody.visible=!0,this.timer=setTimeout(function(){i.stopAvatarAnimation()}.bind(this),5e3);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopAvatarAnimationImmedicate",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stopAvatarAnimation(),this.timer&&(clearTimeout(this.timer),this.timer=null);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopAvatarAnimation",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.avatarAnimationBody&&this.avatarPlayer&&(this.avatarPlayer.pauseVideo(),this.destroyMesh(this.avatarAnimationBody),this.avatarPlayer=null,this.avatarImageBody.visible=!0,(t=wn.inst.avatarsMgr).myAvatarData&&this.avatarData.id===t.myAvatarData.id?wn.inst.avatarsMgr.animation=null:this.avatarData.animationName=null);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadAvatarImageBody",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=wn.inst.resLoad).mediaResources[t]){e.next=5;break}this.avatarImageBody=n.mediaResources[t].clone(),e.next=16;break;case 5:return e.next=7,wn.inst.resLoad.load(t,r.Texture);case 7:(s=e.sent).needsUpdate=!0,a=s.image.width,o=s.image.height,i=new g.tb({map:s,side:g.E,transparent:!0,combine:0}),c=new g.Mb(1*this.playerHeight,o/a*this.playerHeight,1,1),u=new g.sb(c,i),this.avatarImageBody=u.clone(),n.mediaResources[t]=u;case 16:this.avatarImageBody.position.y=.5*this.playerHeight,this.avatarImageBody.scale.set(.75,.75,.75),this.object.add(this.avatarImageBody);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setVisible",value:function(e){this.object.visible=e}},{key:"destroyMesh",value:function(e){var t=e.material;if(t)t.dispose();else{var n=e.material.map;n&&n.dispose()}var i=e.geometry;i&&i.dispose(),this.object.remove(e),e=null}},{key:"destroy",value:function(){this.stopStreamVideo(),this.stopAvatarAnimation(),this.destroyMesh(this.photoMesh),this.destroyMesh(this.textMesh),Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this)}}]),n}(dt),Jt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n),(e=t.call(this,st.SPRITE)).imageMesh=void 0,e.imgMaterial=void 0,e.verticalNumber=void 0,e.horizontalNumber=void 0,e.frameNumber=void 0,e.speed=void 0,e.textMesh=void 0,e.fontSize=void 0,e.text=void 0,e.texts=void 0,e.loader=void 0;var i=new g.Mb(1,1,1,1);e.imgMaterial=new g.tb({map:null,side:g.E,transparent:!0,combine:0}),e.imageMesh=new g.sb(i,e.imgMaterial),e.object.add(e.imageMesh);var a=new g.Mb(1,1,1,1),o=new g.tb({transparent:!0});return e.textMesh=new g.sb(a,o),e.textMesh.position.y=.6,e.textMesh.position.z=.1,e.textMesh.visible=!1,e.object.add(e.textMesh),e.updateRaycastMesh([i,a]),e}return Object(b.a)(n,[{key:"json",get:function(){return Object(x.a)({verticalNumber:this.verticalNumber,horizontalNumber:this.horizontalNumber,frameNumber:this.frameNumber,speed:this.speed,text:this.text,texts:this.texts,fontSize:this.fontSize},Object(D.a)(Object(B.a)(n.prototype),"json",this))}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verticalNumber=t.verticalNumber,this.horizontalNumber=t.horizontalNumber,this.frameNumber=t.frameNumber?t.frameNumber:15,this.speed=t.speed?t.speed:10,this.text=t.text?t.text:null,this.texts=t.texts?t.texts:null,this.fontSize=t.fontSize?t.fontSize:58,Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),e.next=10,this.updateSpriteImage();case 10:this.updateLabelText();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableLabels",value:function(e){null===this.text&&null===this.texts||(this.textMesh.visible=e)}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"setJson",value:function(e){this.verticalNumber=e.verticalNumber,this.horizontalNumber=e.horizontalNumber,this.frameNumber=e.frameNumber?e.frameNumber:15,this.speed=e.speed?e.speed:10,this.text=e.text?e.text:null,this.texts=e.texts?e.texts:null,this.fontSize=e.fontSize?e.fontSize:70,Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e)}},{key:"updateSpriteImage",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wn.inst.resLoad.load(this.fileUrl,r.Texture);case 2:(t=e.sent).needsUpdate=!0,this.loader=new Nt(t,this.horizontalNumber,this.verticalNumber,this.frameNumber,this.speed),n=this.loader.init(),i=this.imageMesh.material.map,this.imageMesh.material.map=n,this.imageMesh.material.needsUpdate=!0,i&&i.dispose();case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateLabelText",value:function(){if(null!==this.text||null!==this.texts){var e=new bt({labels:this.texts?this.texts:this.text,fontWeight:"Bold",fontStyle:"Normal",fontColor:"#ffffff",padding:15,fontSize:this.fontSize,aligment:"center",lineSpace:20},{fillStyle:"rgba(0,0,0,0.5)"});e.needsUpdate=!0,e.encoding=g.M;var t=4*e.width,n=4*e.height,i=this.textMesh.material.map;this.textMesh.material.map=e,this.textMesh.scale.set(t,n,1),i&&i.dispose()}else this.textMesh.visible=!1}}]),n}(dt),Kt=n(58);!function(e){e.PHOTO="photo",e.SPRITE="sprite"}(Ut||(Ut={}));var qt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;Object(m.a)(this,n),(e=t.call(this,st.TAG)).imageMesh=void 0,e.imgMaterial=void 0,e.verticalNumber=void 0,e.horizontalNumber=void 0,e.frameNumber=void 0,e.speed=void 0,e.loader=void 0,e.textMesh=void 0,e.fontSize=void 0,e.animation="",e.text=void 0,e.texts=void 0,e.iconType=void 0,e.tweens=[],e.timeouts=[];var i=new g.Mb(1,1,1,1);e.imgMaterial=new g.tb({map:null,side:g.E,transparent:!0,combine:0}),e.imageMesh=new g.sb(i,e.imgMaterial),e.object.add(e.imageMesh);var a=new g.Mb(1,1,1,1),o=new g.tb({transparent:!0});return e.textMesh=new g.sb(a,o),e.textMesh.position.y=.6,e.textMesh.position.z=.1,e.textMesh.visible=!1,e.object.add(e.textMesh),e.updateRaycastMesh([i]),e}return Object(b.a)(n,[{key:"fadeOut",value:function(){var e=this,t={fade:1};return new Kt.Tween(t).to({fade:.3},1700).easing(Kt.Easing.Cubic.Out).onUpdate((function(){e.imgMaterial.opacity=t.fade})).onComplete((function(){var t=e.fadeIn();t.start(),e.tweens.push(t)}))}},{key:"fadeIn",value:function(){var e=this,t={fade:.3};return new Kt.Tween(t).to({fade:1},2e3).easing(Kt.Easing.Cubic.In).onUpdate((function(){e.imgMaterial.opacity=t.fade})).onComplete((function(){e.timeouts.push(window.setTimeout((function(){var t=e.fadeOut();t.start(),e.tweens.push(t)}),3500))}))}},{key:"scaleUp",value:function(){var e=this,t=new g.Bc(1,1,1);return new Kt.Tween(t).to(t.addScalar(.3),500).easing(Kt.Easing.Cubic.In).onUpdate((function(){e.imageMesh.scale.copy(t)})).onComplete((function(){var t=e.scaleDown();t.start(),e.tweens.push(t)}))}},{key:"scaleDown",value:function(){var e=this,t=new g.Bc(1,1,1).addScalar(.3);return new Kt.Tween(t).to(t.addScalar(-.3),500).easing(Kt.Easing.Cubic.Out).onUpdate((function(){e.imageMesh.scale.copy(t)})).onComplete((function(){var t=e.scaleUp();t.start(),e.tweens.push(t)}))}},{key:"json",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{animation:this.animation,verticalNumber:this.verticalNumber,horizontalNumber:this.horizontalNumber,frameNumber:this.frameNumber,speed:this.speed,text:this.text,texts:this.texts,fontSize:this.fontSize,iconType:this.iconType})}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),this.name=t.name?t.name:"",this.verticalNumber=t.verticalNumber,this.horizontalNumber=t.horizontalNumber,this.frameNumber=t.frameNumber?t.frameNumber:15,this.speed=t.speed?t.speed:10,this.text=t.text?t.text:null,this.texts=t.texts?t.texts:null,this.iconType=t.iconType?t.iconType:"PHOTO",this.fontSize=t.fontSize?t.fontSize:58,this.animation=t.animation?t.animation:"",e.next=13,this.updateImage();case 13:this.updateLabelText(),this.playAnimation();case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playAnimation",value:function(){if(this.stopAnimation(),""!==this.animation&&this.iconType!==Ut.SPRITE)if("scale"===this.animation){var e=this.scaleUp();e.start(),this.tweens.push(e)}else if("fade"===this.animation){var t=this.fadeOut();t.start(),this.tweens.push(t)}}},{key:"stopAnimation",value:function(){if(this.tweens.length>0){this.tweens.forEach((function(e){e.stop()}));for(var e=0;e<this.timeouts.length;e++)clearTimeout(this.timeouts[e]);this.tweens=[],this.timeouts=[]}}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{url:this.openLink})}},{key:"setJson",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e),this.name=e.name?e.name:"",this.verticalNumber=e.verticalNumber,this.horizontalNumber=e.horizontalNumber,this.frameNumber=e.frameNumber?e.frameNumber:15,this.speed=e.speed?e.speed:10,this.text=e.text?e.text:null,this.texts=e.texts?e.texts:null,this.iconType=e.iconType?e.iconType:"PHOTO",this.fontSize=e.fontSize?e.fontSize:58,this.animation=e.animation?e.animation:"",this.updateLabelText(),this.playAnimation()}},{key:"updateImage",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=wn.inst.resLoad,(n=this.imageMesh.material.map)&&n.dispose(),void 0===t.mediaResources[this.fileUrl]){e.next=7;break}return this.imageMesh.material.map=t.mediaResources[this.fileUrl],this.imageMesh.material.needsUpdate=!0,e.abrupt("return");case 7:return e.next=9,wn.inst.resLoad.load(this.fileUrl,r.Texture);case 9:(i=e.sent).needsUpdate=!0,this.iconType==Ut.SPRITE?(this.loader=new Nt(i,this.horizontalNumber,this.verticalNumber,this.frameNumber,this.speed),a=this.loader.init(),this.imageMesh.material.map=a,this.imageMesh.material.needsUpdate=!0,t.mediaResources[this.fileUrl]=a):(this.imageMesh.material.map=i,this.imageMesh.material.needsUpdate=!0,t.mediaResources[this.fileUrl]=i);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enableLabels",value:function(e){null===this.text&&null===this.texts||(this.textMesh.visible=e)}},{key:"updateLabelText",value:function(){if(null!==this.text||null!==this.texts){var e=new bt({labels:this.texts?this.texts:this.text,fontWeight:"Bold",fontStyle:"Normal",fontColor:"#ffffff",padding:15,fontSize:this.fontSize,aligment:"center",lineSpace:20},{fillStyle:"rgba(0,0,0,0.5)"});e.needsUpdate=!0,e.encoding=g.M;var t=4*e.width,n=4*e.height,i=this.textMesh.material.map;this.textMesh.material.map=e,this.textMesh.scale.set(t,n,1),i&&i.dispose()}else this.textMesh.visible=!1}}]),n}(dt),Xt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.POSITIONPLANE))._swappedType=void 0,e._swappedMedia=void 0,e.swappedObject=void 0,e.mesh=void 0,e.fit=void 0,e}return Object(b.a)(n,[{key:"json",get:function(){var e=this.mesh.clone();e.position.set(0,0,0),e.rotation.set(0,0,0),e.updateMatrix();var t=new g.Bc;return(new g.j).setFromObject(e).getSize(t),Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{size:{x:t.x,y:t.y},swappedType:this._swappedType,swappedProps:this.swappedProps})}},{key:"swappedMedia",get:function(){return this._swappedMedia},set:function(e){void 0!==this._swappedMedia&&this._swappedMedia.destroy(),this._swappedMedia=e,this._swappedType=e.type,this.fit2Plane(e.object),this.swappedObject=e.object,this.swappedObject.position.set(0,0,0),this.swappedObject.rotation.set(0,0,0),this.swappedObject.updateMatrix(),this.object.add(this.swappedObject),this.mesh.visible=!1,this.name=e.name,this.updateRaycastMesh(e.object)}},{key:"swappedProps",get:function(){if(this._swappedMedia){var e=this._swappedMedia.json;return e.position&&delete e.position,e.rotation&&delete e.rotation,e.scale&&delete e.scale,void 0!==e.isVertical&&delete e.isVertical,void 0!==e.followCamera&&delete e.followCamera,e}}},{key:"swappedType",get:function(){return this._swappedType}},{key:"fit2Plane",value:function(e){var t=new g.j,n=this.mesh.clone(),i=e.clone();n.rotation.set(0,0,0),i.rotation.set(0,0,0),t.setFromObject(n);var a=t.max.sub(t.min),o=new g.j;o.setFromObject(i);var r=o.max.sub(o.min);if("cover"===this.fit)e.scale.copy(new g.Bc(a.x/r.x,a.y/r.y,1));else{var s=new g.Bc(a.x/r.x,a.y/r.y,a.z/r.z),c=s.x,u=s.y,l=s.z,h=[c,u,l],d=Math.min.apply(Math,h),p=Math.max.apply(Math,h),f=0;for(f=0;f<h.length&&!(h[f]>d&&h[f]<p);f++);var v=e.scale.clone();switch(f){case 0:e.scale.copy(v.multiplyScalar(c));break;case 1:e.scale.copy(v.multiplyScalar(u));break;case 2:e.scale.copy(v.multiplyScalar(l))}}}},{key:"clearSwappedMedia",value:function(){void 0!==this._swappedType&&(this._swappedMedia.destroy(),this._swappedMedia=void 0,this._swappedType=void 0,this.mesh.visible=!0,this.name="Plane",this.updateRaycastMesh(this.mesh))}},{key:"setJson",value:function(e){this.name=e.name,e.type===st.POSITIONPLANE?Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e):this.swappedMedia.setJson(e)}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i,a,o,r,s,c,u,l,h,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),h=new g.Mb(null!==(i=null===(a=t.size)||void 0===a?void 0:a.x)&&void 0!==i?i:1,null!==(o=null===(r=t.size)||void 0===r?void 0:r.y)&&void 0!==o?o:1),d=new g.tb({color:11365372,transparent:!0,opacity:.7,side:g.E}),this.mesh=new g.sb(h,d),Be.getState().modeReducer===re.Editor&&this.object.add(this.mesh),this.fit=t.fit?t.fit:"cover",this.name="position-".concat(t.positionObjectsCount),this.updateRaycastMesh(this.mesh),this.updateBoundaryBox(null!==(s=null===(c=t.size)||void 0===c?void 0:c.x)&&void 0!==s?s:1,null!==(u=null===(l=t.size)||void 0===l?void 0:l.y)&&void 0!==u?u:1,1e-4),this._swappedType=t.swappedType;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e,t;Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),null===(e=this.mesh.geometry)||void 0===e||e.dispose(),null===(t=this._swappedMedia)||void 0===t||t.destroy()}}]),n}(dt),Qt=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,st.POSITIONCUBE))._swappedType=void 0,e._swappedMedia=void 0,e.swappedObject=void 0,e.mesh=void 0,e}return Object(b.a)(n,[{key:"json",get:function(){var e=this.mesh.clone();e.position.set(0,0,0),e.rotation.set(0,0,0),e.updateMatrix();var t=new g.Bc;return(new g.j).setFromObject(e).getSize(t),Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"json",this)),{},{size:t,swappedType:this._swappedType,swappedProps:this.swappedProps})}},{key:"swappedMedia",get:function(){return this._swappedMedia},set:function(e){void 0!==this._swappedMedia&&this._swappedMedia.destroy(),this._swappedMedia=e,this._swappedType=e.type,e.object.remove(e.boundaryBox),this.swappedObject=e.object,this.swappedObject.position.set(0,2,0),this.swappedObject.rotation.set(0,0,0),this.swappedObject.updateMatrix(),this.fit2Box(this.swappedObject),this.object.add(this.swappedObject),this.mesh.visible=!1,this.name=e.name}},{key:"swappedProps",get:function(){if(this._swappedMedia){var e=this._swappedMedia.json;return e.position&&delete e.position,e.rotation&&delete e.rotation,e.scale&&delete e.scale,void 0!==e.isVertical&&delete e.isVertical,void 0!==e.followCamera&&delete e.followCamera,e}}},{key:"swappedType",get:function(){return this._swappedType}},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var i,a,o,r,s,c,u,l,h,d,p,v,m,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(D.a)(Object(B.a)(n.prototype),"init",this).call(this,t),m=new g.k(null!==(i=null===(a=t.size)||void 0===a?void 0:a.x)&&void 0!==i?i:1,null!==(o=null===(r=t.size)||void 0===r?void 0:r.y)&&void 0!==o?o:1,null!==(s=null===(c=t.size)||void 0===c?void 0:c.z)&&void 0!==s?s:1),b=new g.tb({color:11365372,transparent:!0,opacity:.7,side:g.E}),this.mesh=new g.sb(m,b),this.object.add(this.mesh),this.object.name="Positioning Cube",this.updateBoundaryBox(null!==(u=null===(l=t.size)||void 0===l?void 0:l.x)&&void 0!==u?u:1,null!==(h=null===(d=t.size)||void 0===d?void 0:d.y)&&void 0!==h?h:1,null!==(p=null===(v=t.size)||void 0===v?void 0:v.z)&&void 0!==p?p:1),this.updateRaycastMesh(this.mesh);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearSwappedMedia",value:function(){void 0!==this._swappedType&&(this._swappedMedia.destroy(),this._swappedMedia=void 0,this._swappedType=void 0,this.mesh.visible=!0,this.name="Positioning Cube")}},{key:"setJson",value:function(e){e.type===st.POSITIONCUBE?Object(D.a)(Object(B.a)(n.prototype),"setJson",this).call(this,e):e.type===st.MODEL?this.swappedMedia.setJson(e):console.error("Position Cube assign type error: ".concat(e.type))}},{key:"destroy",value:function(){var e,t;Object(D.a)(Object(B.a)(n.prototype),"destroy",this).call(this),null===(e=this.mesh.geometry)||void 0===e||e.dispose(),null===(t=this._swappedMedia)||void 0===t||t.destroy()}},{key:"fit2Box",value:function(e){var t=new g.j;t.setFromObject(this.mesh);var n=t.max.sub(t.min),i=new g.j;i.setFromObject(e);var a=i.max.sub(i.min),o=new g.Bc(n.x/a.x,n.y/a.y,n.z/a.z),r=[o.x,o.y,o.z],s=Math.min.apply(Math,r),c=e.scale.clone();e.scale.copy(c.multiplyScalar(s)),e.position.set(0,-n.y/2,0),e.updateMatrix()}}]),n}(dt),$t={PositioningPlane:Xt,PositioningCube:Qt,Model:ft,Image:mt,Tag:gt,Gif:yt,Sprite:Jt,NewTag:qt,Text:wt,Video:Ht,Webpage:Vt,Hotspot:_t,Portal:Wt,Avatar:Zt},en=function(){function e(t,n,i,a,o){Object(m.a)(this,e),this.layer=void 0,this.depthMapNear=.8,this.depthMapFar=50,this.normalDepthMapRenderTarget=void 0,this.normalDepthMapMaterial=void 0,this.scene=void 0,this._camera=void 0,this._renderer=void 0,this.height=void 0,this.canvas=void 0,this.registedobjects=[],this._renderer=new g.Ic,this._camera=a,this.scene=t,this.canvas=n,this.onResize(),this.layer=o,window.addEventListener("resize",this.onResize.bind(this),!1)}return Object(b.a)(e,[{key:"texture",get:function(){return this.normalDepthMapRenderTarget.texture}},{key:"setcam",value:function(e,t){this._camera.near=e,this._camera.far=t,this._camera.updateProjectionMatrix()}},{key:"onResize",value:function(){var e=this.canvas.getBoundingClientRect(),t=e.width,n=e.height,i=t*window.devicePixelRatio,a=n*window.devicePixelRatio;this.height=a,this.normalDepthMapRenderTarget?this.normalDepthMapRenderTarget.setSize(i,a):this.normalDepthMapRenderTarget=new g.Hc(i,a)}},{key:"registObject",value:function(e){for(var t=[].concat(e||[]),n=0;n<t.length;n++){t[n].raycastTarget&&(this.registedobjects.push(t[n]),t[n].enableRaycasterLayer(this.layer))}}},{key:"unRegistObject",value:function(e){for(var t=[].concat(e||[]),n=0;n<t.length;n++){if(t[n].raycastTarget){var i=this.registedobjects.indexOf(t[n]);this.registedobjects.splice(i,1)}}}},{key:"getNormalAndPosition",value:function(e){this.update(this.scene);var t=e.x*window.devicePixelRatio,n=this.height-e.y*window.devicePixelRatio,i=new Uint8Array(4);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}this._renderer.readRenderTargetPixels(this.normalDepthMapRenderTarget,t,n,1,1,i);var o=a(i[0]/255-.5),r=a(i[1]/255-.5),s=a(i[2]/255-.5),c=new g.Bc(o,r,s).normalize(),u=(new g.rb).lookAt(c,new g.Bc(0,0,0),this._camera.up),l=i[3]/255;if(0!==l){var h=this.canvas.getBoundingClientRect(),d=(e.x-h.left)/this.canvas.clientWidth*2-1,p=-(e.y-h.top)/this.canvas.clientHeight*2+1,f=this._camera.near,v=this._camera.far;this.setcam(this.depthMapNear,this.depthMapFar);var m=new g.Bc(d,p,2*l-1).unproject(this._camera);return this.setcam(f,v),{rotationMat4:u,worldPosition:m}}}},{key:"update",value:function(e){if(this.normalDepthMapRenderTarget){this.registedobjects.forEach((function(e){e.renderNormalAndDepth(!0)}));var t=this._camera.near,n=this._camera.far;this.setcam(this.depthMapNear,this.depthMapFar),this._camera.layers.set(this.layer),this._renderer.setRenderTarget(this.normalDepthMapRenderTarget),this._renderer.clear(),this._renderer.render(e,this._camera),this.registedobjects.forEach((function(e){e.renderNormalAndDepth(!1)})),this.setcam(t,n),this._camera.layers.set(0),this._renderer.setRenderTarget(null),e.overrideMaterial=null}}}]),e}(),tn=function(){function e(t,n,i,a){Object(m.a)(this,e),this.layer=void 0,this.colorRenderTarget=void 0,this.canvas=void 0,this._camera=void 0,this._renderer=void 0,this.height=void 0,this._colorIndex=1,this.colorOjbectDict={},this._renderer=new g.Ic,this._camera=i,this.canvas=t,this.layer=a,this.onResize(),window.addEventListener("resize",this.onResize.bind(this),!1)}return Object(b.a)(e,[{key:"texture",get:function(){return this.colorRenderTarget.texture}},{key:"registObject",value:function(e){for(var t=[].concat(e||[]),n=0;n<t.length;n++){var i=t[n].setRaycastIndex(this.layer,this._colorIndex);t[n].renderIndexColor(!0),i&&(this.colorOjbectDict[this._colorIndex]=t[n],this._colorIndex++)}}},{key:"onResize",value:function(){var e=this.canvas,t=e.width,n=e.height;this.height=n,this.colorRenderTarget?this.colorRenderTarget.setSize(t,n):this.colorRenderTarget=new g.Hc(t,n)}},{key:"getObject",value:function(e){var t=e.x*window.devicePixelRatio*wn.inst.scaleDeviceRatio,n=this.height-e.y*window.devicePixelRatio*wn.inst.scaleDeviceRatio,i=new Uint8Array(4);this._renderer.readRenderTargetPixels(this.colorRenderTarget,t,n,1,1,i);var a=i[0]<<16|i[1]<<8|i[2];return this.colorOjbectDict[a]}},{key:"update",value:function(e){var t=this;this.colorRenderTarget&&(Object.keys(this.colorOjbectDict).forEach((function(e){t.colorOjbectDict[e].renderIndexColor(!0)})),this._camera.layers.set(this.layer),this._renderer.setRenderTarget(this.colorRenderTarget),this._renderer.clear(),this._renderer.render(e,this._camera),Object.keys(this.colorOjbectDict).forEach((function(e){t.colorOjbectDict[e].renderIndexColor(!1)})),this._camera.layers.set(0),this._renderer.setRenderTarget(null),e.overrideMaterial=null)}}]),e}(),nn=function(){function e(t,n,i,a,o,r){Object(m.a)(this,e),this.latestHoverObject=void 0,this.screenRaycaster=void 0,this.objectPicker=void 0,this.isMouseUpThreshold=10,this.mouseDownCoord=void 0,this.mouse=void 0,this.camera=void 0,this._perfromance_counter=0,this._perfromance_loop=7,this.screenRaycaster=new en(t,n,i,a,r),this.objectPicker=new tn(n,i,a,o),this.mouseDownCoord=new g.Ac,this.mouse=new g.Ac,n.addEventListener("touchmove",this.onMouseMove.bind(this),!1),n.addEventListener("mousemove",this.onMouseMove.bind(this),!1),n.addEventListener("mousedown",this.onMouseDown.bind(this),!1),n.addEventListener("mouseup",this.onMouseUp.bind(this),!1),n.addEventListener("touchend",this.onMouseUp.bind(this),!1),n.addEventListener("touchstart",this.onMouseDown.bind(this),!1),document.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.camera=a}return Object(b.a)(e,[{key:"mouseEnter",value:function(e){}},{key:"mouseLeave",value:function(e){}},{key:"onKeyDown",value:function(e){var t=this;if(Be.getState().modeReducer===re.Viewer){var n=wn.inst.animationMgr,i=n.hotspotdict[n.latestHotspotId],a=this.camera.getWorldDirection(new g.Bc);switch(e.code){case"KeyW":break;case"KeyA":a.applyAxisAngle(new g.Bc(0,1,0),Math.PI/2);break;case"KeyS":a.applyAxisAngle(new g.Bc(0,1,0),Math.PI);break;case"KeyD":a.applyAxisAngle(new g.Bc(0,1,0),-Math.PI/2);break;default:a=void 0}if(a){var o=wn.inst.animationMgr.hotspotdict,r=Object.keys(o),s=1/0,c=void 0;r.forEach((function(e){var o=n.hotspotdict[e],r=o.position,u=o.floor,l=o.id;if(u===i.floor&&l!==n.latestHotspotId&&i.neighbors.includes(l)){var h=new g.Bc(r.x-t.camera.position.x,0,r.z-t.camera.position.z);if(Math.abs(h.angleTo(a))<.6){var d=new g.Bc(i.position.x,i.position.y,i.position.z).distanceTo(new g.Bc(r.x,r.y,r.z));d<s&&(s=d,c=l)}}})),c&&n.goHotspot(c)}}}},{key:"updateMouse",value:function(e,t){e.type.includes("touch")?(t.x=e.changedTouches[0].clientX,t.y=e.changedTouches[0].clientY):(t.x=e.clientX,t.y=e.clientY)}},{key:"onMouseDown",value:function(e){void 0!==this.mouseDown&&this.mouseDown(void 0),this.updateMouse(e,this.mouseDownCoord)}},{key:"onMouseUp",value:function(e){if(this.updateMouse(e,this.mouse),!(this.mouseDownCoord.distanceTo(this.mouse)>this.isMouseUpThreshold)){var t=this.objectPicker.getObject(this.mouse),n=this.screenRaycaster.getNormalAndPosition(this.mouse);t?this.mouseUp({destroy:t.destroy.bind(t),target:t.targetInfo,rotation:n.rotationMat4,position:n.worldPosition}):this.mouseUp(void 0)}}},{key:"onMouseMove",value:function(e){this.updateMouse(e,this.mouse);var t,n=this.screenRaycaster.getNormalAndPosition(this.mouse),i=this.objectPicker.getObject(this.mouse);i!==this.latestHoverObject&&(null===i||void 0===i||i.onMouseEnter(),i&&this.mouseEnter(i),null===(t=this.latestHoverObject)||void 0===t||t.onMouseLeave(),this.latestHoverObject&&this.mouseLeave(this.latestHoverObject),this.latestHoverObject=i);n?this.mouseMove({destroy:void 0,target:i?i.targetInfo:void 0,rotation:n.rotationMat4,position:n.worldPosition}):this.mouseMove(void 0)}},{key:"normalMap",get:function(){return this.screenRaycaster.texture}},{key:"indexMap",get:function(){return this.objectPicker.texture}},{key:"addTarget",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.RAYCASTTYPE.GETOBJECT;e.RAYCASTTYPE.hasProperty(n,e.RAYCASTTYPE.GETPOSITION)&&this.screenRaycaster.registObject(t),e.RAYCASTTYPE.hasProperty(n,e.RAYCASTTYPE.GETOBJECT)&&this.objectPicker.registObject(t)}},{key:"update",value:function(e){0===this._perfromance_counter%this._perfromance_loop&&(this.screenRaycaster.update(e),this.objectPicker.update(e)),this._perfromance_counter++}}]),e}();nn.RAYCASTTYPE={GETBOTH:3,GETPOSITION:1,GETOBJECT:2,hasProperty:function(e,t){return(e&t)===t}};n(58);var an,on=n(173).setIntervalAsync,rn=function(){function e(){Object(m.a)(this,e),this.avatarList=void 0,this._hotspots=void 0,this._scene=void 0,this._gpuRaycaster=void 0,this._myAvatarData=void 0,this._followerAvatarData=void 0,this._createAvatarList=void 0,this._moveAvatarList=void 0,this.hotspotAvatarCountList=void 0,this.avatarList=[],this.hotspotAvatarCountList={},this._hotspots={},this._createAvatarList={},this._moveAvatarList={}}return Object(b.a)(e,[{key:"avatarData",get:function(){return this._followerAvatarData&&this._followerAvatarData.id?this._followerAvatarData:this._myAvatarData}},{key:"myAvatarData",set:function(e){this._myAvatarData=e}},{key:"animation",get:function(){return this._myAvatarData.animationName},set:function(e){if(e&&""!==e){var t=this.getAvatar(this._myAvatarData.id);this._myAvatarData.animationName=e,t?(t.stopAvatarAnimationImmedicate(),t.playAvatarAnimation(e)):setTimeout(function(){this._myAvatarData.animationName=null}.bind(this),5e3)}}},{key:"followerAvatarData",set:function(e){this._followerAvatarData=e}},{key:"avatars",get:function(){return this.avatarList}},{key:"hotspots",get:function(){return this._hotspots}},{key:"setSceneRaycast",value:function(e,t){this._scene=e,this._gpuRaycaster=t}},{key:"scene",get:function(){return this._scene}},{key:"gpuRaycaster",get:function(){return this._gpuRaycaster}},{key:"avatarQueueCreation",value:function(){var e=this;on(Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createAvatarsInQueue();case 2:case"end":return t.stop()}}),t)}))),1e3,this._createAvatarList),on(Object(v.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.moveAvatarsInQueue();case 2:case"end":return t.stop()}}),t)}))),1e3,this._createAvatarList)}},{key:"setHotspots",value:function(e){var t=this;e.forEach((function(e){t._hotspots[e.id]={x:e.position.x,y:e.position.y,z:e.position.z},t.hotspotAvatarCountList[e.id]=0}))}},{key:"enableFollowerAvatar",value:function(e,t){if(this.removeAvatar(this.avatarData.id),t){var n=Be.getState().usersReducer.filter((function(t){return t.id===e}))[0];this._followerAvatarData=Object.assign({},n),this._followerAvatarData.id=this._myAvatarData.id,this.enableScreenAvatar(!0)}}},{key:"enableScreenAvatar",value:function(e){this.removeAvatar(this.avatarData.id),this.avatarData.camera=null;var t=this.avatarData;e&&(t.hotspotId=wn.inst.animationMgr.latestHotspotId,t.azimuthAngle=wn.inst.viewportController.azimuthAngle,t.camera=wn.inst.viewportController.camera,this.updateAvatar(t,t.hotspotId,!0))}},{key:"updateAvatar",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isVertical=!0,t.followCamera=!0,a=t.hotspotId,void 0!==this.getAvatar(t.id)){e.next=14;break}if(!i){e.next=12;break}if(!(o=this.getTargetPosition(t,t.hotspotId))){e.next=10;break}return e.next=10,this.createAvatarObject(t,o);case 10:e.next=13;break;case 12:this._createAvatarList[t.id]=t;case 13:return e.abrupt("return");case 14:return n&&(a=n),this._moveAvatarList[t.id]={hotspotId:a},e.abrupt("return");case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"getAvatarfromHotspot",value:function(e){return this.avatarList.filter((function(t){return t.avatarData.hotspotId===e}))[0]}},{key:"getAvatar",value:function(e){return this.avatarList.filter((function(t){return t.id===e}))[0]}},{key:"getRemainAvatar",value:function(e){return this.avatarList.filter((function(t){return e.indexOf(t)<0}))}},{key:"setAvatarVisible",value:function(e,t){var n=this.avatarList.filter((function(t){return t.id===e}));n.length>0&&n[0].setVisible(t)}},{key:"enableAvatar",value:function(e,t){var n=this.avatarList.filter((function(t){return t.id===e}));n.length>0&&(" "!==t.follow?n[0].setVisible(!1):n[0].setVisible(!0))}},{key:"setAvatarsVisible",value:function(e){for(var t=0;t<this.avatarList.length;t++)this.avatarList[t].setVisible(e)}},{key:"removeAvatars",value:function(){for(var e=0;e<this.avatarList.length;e++)this.avatarList[e].destroy();this.avatarList=[],this.hotspotAvatarCountList={},Be.dispatch(le([]))}},{key:"removeAvatar",value:function(e){var t=this.avatarList.filter((function(t){return t.id===e}))[0];if(t){this.hotspotAvatarCountList[t.avatarData.hotspotId]-=1,t.destroy();var n=this.avatarList.indexOf(t);n>-1&&(this.avatarList.splice(n,1),Be.dispatch(le(this.avatarList)))}Be.dispatch(le(this.avatarList))}},{key:"createRandomAvatarObject",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i){var a,o,r,s,c,u,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(Math.random()+1).toString(36).substring(6),o=Math.floor(10*Math.random()),t){e.next=10;break}return e.next=5,this.getAvatarSystemData();case 5:r=e.sent,s=r.avatarAnimationList,c=r.avatarBodyImageList,n=s,t=c;case 10:return i||(i=Object.keys(this._hotspots)),u=Math.floor(Math.random()*i.length)+1,l={id:a,photoUrl:"https://avatars.dicebear.com/api/avataaars/".concat(a,".jpg"),animations:n[o],type:ae.participant,bodyImageUrl:t[o],hotspotId:i[u],name:a,video:!1,audio:!1},e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"createFakeAvatarObjects",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r,s,c,u,l,h=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,this.getAvatarSystemData();case 3:i=e.sent,a=i.avatarAnimationList,o=i.avatarBodyImageList,r=Object.keys(this._hotspots),s=0;case 8:if(!(s<t)){e.next=16;break}return e.next=11,this.createRandomAvatarObject(o,a,r);case 11:c=e.sent,n.push(c);case 13:s++,e.next=8;break;case 16:on(Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=0;case 2:if(!(n<h.avatars.length)){e.next=16;break}if(!(t>15)){e.next=5;break}return e.abrupt("break",16);case 5:if(i=Math.floor(Math.random()*h.avatars.length),!h.avatars[i].avatarPlayer){e.next=9;break}return e.abrupt("continue",13);case 9:return e.next=11,h.avatars[i].randomPlayAvatarAnimation();case 11:e.sent&&t++;case 13:n++,e.next=2;break;case 16:case"end":return e.stop()}}),e)}))),25e3,this.avatars),u=0;case 18:if(!(u<t)){e.next=26;break}return e.next=21,this.updateAvatar(n[u]);case 21:l=n[u],null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.memberjoin,{id:l.id,name:l.name,type:ae[l.type],photoUrl:l.photoUrl});case 23:u++,e.next=18;break;case 26:on(Object(v.a)(f.a.mark((function e(){var t,n,i,a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=0;case 2:if(!(n<h.avatars.length)){e.next=13;break}if(!(t>20)){e.next=5;break}return e.abrupt("break",13);case 5:i=Math.floor(Math.random()*h.avatars.length),a=h.avatars[i],o=Math.floor(Math.random()*r.length),h.updateAvatar(a.avatarData,r[o]),t++;case 10:n++,e.next=2;break;case 13:case"end":return e.stop()}}),e)}))),5e3,this.avatars);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvatarSystemData",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.metaspace.place/api/avatar");case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent.avatars,i=n.map((function(e){return e.animations})),a=n.map((function(e){return e.bodyImageUrl})),e.abrupt("return",{avatarAnimationList:i,avatarBodyImageList:a});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"createAvatarsInQueue",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=Object.entries(this._createAvatarList);case 1:if(!(t<n.length)){e.next=11;break}if(i=Object(h.a)(n[t],2),a=i[0],o=i[1],!(r=this.getTargetPosition(o,o.hotspotId))){e.next=8;break}return e.next=7,this.createAvatarObject(o,r);case 7:delete this._createAvatarList[a];case 8:t++,e.next=1;break;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"moveAvatarsInQueue",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a,o,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=Object.entries(this._moveAvatarList);case 1:if(!(t<n.length)){e.next=17;break}if(i=Object(h.a)(n[t],2),a=i[0],o=i[1],e.prev=3,(r=this.getAvatar(a)).avatarData.hotspotId!==o.hotspotId){e.next=8;break}return delete this._moveAvatarList[a],e.abrupt("continue",14);case 8:r.isAnimating||(s=this.getTargetPosition(r.avatarData,o.hotspotId),r.move(s,o.hotspotId),delete this._moveAvatarList[a]),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),delete this._moveAvatarList[a];case 14:t++,e.next=1;break;case 17:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"getTargetPosition",value:function(e,t){var n=void 0;if(e.camera&&e.camera.position){var i=e.camera;n=(n=new g.Bc(0,0,0)).copy(i.position);var a=i.getWorldDirection(new g.Bc);a.multiplyScalar(1.3),n.add(a)}if(this._hotspots[t]){var o=this._hotspots[t],r=this.hotspotAvatarCountList[t];if(r>2)return;n?n.y=o.y:(n=new g.Bc(o.x,o.y,o.z),1===r?n=new g.Bc(o.x+.4,o.y,o.z+.4):2===r&&(n=new g.Bc(o.x-.4,o.y,o.z-.4)))}return n}},{key:"createAvatarObject",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.hotspotId,!this._hotspots[i]){e.next=7;break}return this.hotspotAvatarCountList[i]+=1,a=new $t.Avatar,e.next=6,a.init(t);case 6:a&&(a.object.position.copy(n),this.scene.add(a),this.gpuRaycaster.addTarget(a,nn.RAYCASTTYPE.GETBOTH),this.avatarList.push(a));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),sn=n(95),cn=function(){function e(){Object(m.a)(this,e),this.me=void 0,this.chatElement=void 0,this.chatBox=void 0,this.setTalker=void 0,this.talker=void 0}return Object(b.a)(e,[{key:"destroyChatBox",value:function(){this.chatBox&&(this.chatBox.destroy(),this.chatBox=null,this.talker=null)}},{key:"init",value:function(e,t){window.talkSession?window.talkSession&&(this.me=window.talkSession.me):(this.me=new sn.a.User({id:e.id,name:e.name,email:e.name,photoUrl:e.photoUrl,welcomeMessage:"Hello, I am ".concat(e.name),role:"avatar"}),window.talkSession=new sn.a.Session({appId:"tjOYvejc",me:this.me}),y.isMobile||window.talkSession.setDesktopNotificationEnabled(!0),window.talkSession.unreads.onChange((function(e){e.forEach((function(e){console.log(e.lastMessage)}))}))),this.setTalker=t}},{key:"getMe",value:function(){return this.me}},{key:"createConversation",value:function(e){this.setTalker&&(this.setTalker(e),this.talker=e)}},{key:"clearConversation",value:function(){this.setTalker(null),this.talker=null}},{key:"createSingleChatbox",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:sn.a.ready.then((function(){var e=n.createTalker(n.talker),i=sn.a.oneOnOneId(n.me,e),a=window.talkSession.getOrCreateConversation(i);a.setAttributes({custom:{talkerId:n.talker.id}}),a.setParticipant(n.me),a.setParticipant(e),n.chatBox?n.chatBox.select(a):(n.chatBox=window.talkSession.createChatbox(a,{showChatHeader:!1}),n.chatBox.onSendMessage((function(e){})),n.chatBox.mount(t))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTalker",value:function(e){return new sn.a.User({id:e.id,name:e.name,email:e.name,photoUrl:e.photoUrl,welcomeMessage:"Hello, I am ".concat(e.name),role:"avatar"})}}]),e}(),un=n(24),ln=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this,{fragmentShader:"\nvarying vec3 modelPositionEquirect;\nvarying mediump vec3 modelPositionAltas;\n\n\nuniform vec3 offestRotate;\nuniform samplerCube tEquirect0;\nuniform samplerCube tEquirect1;\n\nuniform sampler2D tAltas0;\nuniform sampler2D tAltas1;\nuniform float shrink;\n\nuniform int texture0isAltas;\nuniform int texture1isAltas;\n\nuniform vec3 position0;\nuniform vec4 rotation0;\nuniform vec3 position1;\nuniform vec4 rotation1;\n\nuniform lowp float blackFactor;\nuniform lowp float time;\nuniform mediump sampler2D tex;\nuniform mediump vec3 color;\nuniform lowp float alpha;\n\nvec3 qtransform(vec4 q, vec3 v){ \n\treturn v + 2.0*cross(cross(v, q.xyz ) + q.w*v, q.xyz);\n}\n\nvoid cubemap(vec3 r, out float texId, out vec2 st) {\n    mediump vec3 uvw;\n    lowp vec3 absr = abs(r);\n\n    if (absr.x > absr.y && absr.x > absr.z) {\n        // x major\n        lowp float negx = step(r.x, 0.0);\n        uvw = vec3(r.zy, absr.x) * vec3(mix(-1.0, 1.0, negx), -1, 1);\n        texId = negx;\n    } else if (absr.y > absr.z) {\n        // y major\n        lowp float negy = step(r.y, 0.0);\n        uvw = vec3(r.xz, absr.y) * vec3(1.0, mix(1.0, -1.0, negy), 1.0);\n        texId = 2.0 + negy;\n    } else {\n        // z major\n        lowp float negz = step(r.z, 0.0);\n        uvw = vec3(r.xy, absr.z) * vec3(mix(1.0, -1.0, negz), -1, 1);\n        texId = 4.0 + negz;\n    }\n    st = vec2(uvw.xy / uvw.z + 1.) * .5;\n}\n \nmediump vec4 texCubemap(vec3 uvw,sampler2D tEquirect) {\n    lowp float texId;\n    mediump vec2 st;\n\n    // calc textureId depends on direction and get the UV coordinate\n    cubemap(uvw, texId, st);\n\n    //return color\n    lowp float order;\n    if (texId > 4.0) order = 2.0;\n    else if (texId > 3.0) order = 4.0;\n    else if (texId > 2.0) order = 1.0;\n    else if (texId > 1.0) order = 0.0;\n    else if (texId > 0.0) order = 5.0;\n    else order = 3.0;\n\n    return texture2D(tEquirect, vec2(st.x*shrink, (st.y*shrink + order) / 6.0));\n}\n \nmediump vec4 getColorAltas(vec3 point,sampler2D texture, vec3 position,vec4 quaternion,mat3 rotateOffset){\n\n    point.x = point.x - position.x;\n    point.y = point.y + position.y;\n    point.z = point.z + position.z;\n\n    vec3 modelVertex = qtransform(quaternion,point)*rotateOffset;\n\n    return texCubemap(normalize(modelVertex),texture);\n}\n\nmediump vec4 getColorEquirect(vec3 point,samplerCube tex, vec3 position,vec4 quaternion,mat3 rotateOffset){\n\n    point.x = point.x - position.x;\n    point.y = point.y - position.y;\n    point.z = point.z + position.z;\n\n    vec3 modelVertex = qtransform(quaternion,point)*rotateOffset;\n\n    return vec4(textureCube(tex, modelVertex).xyz, 1.0);\n}\n\nvoid main()\t{\t    \n\n    mat3 rotationMatX = mat3(1.0, 0.0, 0.0,\n        0.0, cos(offestRotate.x), -sin(offestRotate.x),\n        0.0, sin(offestRotate.x),cos(offestRotate.x));\n\n    mat3 rotationMatY = mat3(cos(offestRotate.y), 0.0, sin(offestRotate.y), \n            0.0, 1.0, 0.0,\n            -sin(offestRotate.y), 0.0, cos(offestRotate.y));\n\n    mat3 rotationMatZ = mat3(cos(offestRotate.z), -sin(offestRotate.z),0.0,\n            sin(offestRotate.z), cos(offestRotate.z), 0.0,\n            0.0,0.0,1.0);\n    mat3 rotateOffset = rotationMatX*rotationMatY*rotationMatZ;\n\n    lowp vec4 color0 = vec4(0.0,0.0,0.0,0.0);\n    lowp vec4 color1 = vec4(0.0,0.0,0.0,0.0);\n    \n    if(texture0isAltas==0){\n        color0 = getColorEquirect(modelPositionEquirect,tEquirect0,position0,rotation0,rotateOffset);\n    }else{\n        color0 = getColorAltas(modelPositionAltas,tAltas0,position0,rotation0,rotateOffset);\n    }\n\n    if(texture1isAltas==0){\n        color1 = getColorEquirect(modelPositionEquirect,tEquirect1,position1,rotation1,rotateOffset);\n    }else{\n        color1 = getColorAltas(modelPositionAltas,tAltas1,position1,rotation1,rotateOffset);\n    }\n\n    vec3 mixColor = mix(color0.xyz,color1.xyz,time);\n\n    gl_FragColor = vec4(mixColor.x*blackFactor,mixColor.y*blackFactor,mixColor.z*blackFactor, alpha);\n}\n",vertexShader:"\nvarying vec3 modelPositionEquirect;\nvarying mediump vec3 modelPositionAltas;\n\nvoid main()\t\n{\n    vec4 worldpos = modelMatrix * vec4( position, 1.0 ) ;\n\n    modelPositionEquirect = vec3(worldpos.x,worldpos.y,-worldpos.z);\n    modelPositionAltas = vec3(position.x, -position.y, -position.z);\n\n    gl_Position =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",uniforms:{tEquirect0:{value:null},tEquirect1:{value:null},tAltas0:{value:null},tAltas1:{value:null},texture0isAltas:{value:null},texture1isAltas:{value:null},shrink:{value:.999},position0:{value:new g.Bc},position1:{value:new g.Bc},rotation0:{value:new g.Cc},rotation1:{value:new g.Cc},blackFactor:{value:1},tex:{value:null},color:{value:null},time:{value:0},alpha:{value:1},offestRotate:{value:new g.Bc}},transparent:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:4})).currentIndexIsZero=void 0,e.currentIndexIsZero=!0,e}return Object(b.a)(n,[{key:"axisIsZ",set:function(e){this.uniforms.offestRotate.value=new g.Bc(0,0,0)}},{key:"alpha",set:function(e){this.uniforms.alpha.value=e}},{key:"transition",set:function(e){this.uniforms.time.value=e}},{key:"cleanAndSetTexture",value:function(e,t){var n=e.value;e.value=t,null!=n&&n.dispose()}},{key:"setTexture",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.position,i=t.rotation,(a=t.texture).generateMipmaps=!1,a.minFilter=g.hb,a.magFilter=g.hb,a.wrapS=g.t,a.wrapT=g.t,this.uniforms.tex.value=a,this.currentIndexIsZero?(a instanceof g.x?(this.cleanAndSetTexture(this.uniforms.tEquirect0,a),this.uniforms.texture0isAltas.value=0):a instanceof g.pc&&(this.cleanAndSetTexture(this.uniforms.tAltas0,a),this.uniforms.texture0isAltas.value=1),this.uniforms.position0.value=new g.Bc(n.x,n.y,n.z),this.uniforms.rotation0.value=new g.Cc(i.x,i.y,i.z,i.w)):(a instanceof g.x?(this.cleanAndSetTexture(this.uniforms.tEquirect1,a),this.uniforms.texture1isAltas.value=0):a instanceof g.pc&&(this.cleanAndSetTexture(this.uniforms.tAltas1,a),this.uniforms.texture1isAltas.value=1),this.uniforms.position1.value=new g.Bc(n.x,n.y,n.z),this.uniforms.rotation1.value=new g.Cc(i.x,i.y,i.z,i.w));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(g.fc),hn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e){var i;Object(m.a)(this,n);var a=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,n=new g.l(t,t,t),i=0;i<n.faces.length;i++){var a=n.faces[i].a;n.faces[i].a=n.faces[i].c,n.faces[i].c=a}var o=[];try{e.traverse((function(e){if(e.isMesh&&"BufferGeometry"===e.geometry.type&&e){e.updateMatrixWorld(!0);var t=e.geometry.clone();t.applyMatrix4(e.matrixWorld),o.push(t)}}));var r=Je(o,!0);if(r)return n.merge((new g.N).fromBufferGeometry(r)),n}catch(s){}return e.traverse((function(e){e.isMesh&&"BufferGeometry"===e.geometry.type&&e&&n.merge((new g.N).fromBufferGeometry(e.geometry),e.matrixWorld)})),n}(e),o=new ln;return(i=t.call(this,a,o)).cubemapMaterial=void 0,i.cubemapMaterial=o,i}return n}(g.sb),dn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this)).origionMesh=void 0,e.integratedMesh=void 0,e._transitionPercentage=void 0,e.type=st.SCENEMODEL,e.object.remove(e.boundaryBox),e}return Object(b.a)(n,[{key:"traverse",value:function(e,t,n){e.traverse((function(e){if(e.isMesh){var i=Array.isArray(e.material)?e.material:[e.material];t&&i.forEach(t),n&&n(e)}}))}},{key:"overwriteGLTFmat",value:function(e){this.traverse(e,(function(e){e.map&&(e.map.encoding=g.Jc),e.emissiveMap&&(e.emissiveMap.encoding=g.Jc),(e.map||e.emissiveMap)&&(e.needsUpdate=!0),e.transparent=!0}),(function(e){e.renderOrder=-1})),this.origionMesh=e,this.integratedMesh=new hn(e),this.integratedMesh.renderOrder=-2}},{key:"setGLTF",value:function(e){Object(D.a)(Object(B.a)(n.prototype),"setGLTF",this).call(this,e,this.overwriteGLTFmat.bind(this))}},{key:"setMesh",value:function(e){this.overwriteGLTFmat(e),Object(D.a)(Object(B.a)(n.prototype),"setMesh",this).call(this,e)}},{key:"load",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(D.a)(Object(B.a)(n.prototype),"load",this).call(this,t,this.overwriteGLTFmat.bind(this)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cubemapMaterial",get:function(){return this.integratedMesh.cubemapMaterial}},{key:"transitionPercentage",get:function(){return this._transitionPercentage},set:function(e){this._transitionPercentage=e,0===this._transitionPercentage?(this.object.remove(this.glb),this.object.add(this.integratedMesh)):1===this._transitionPercentage?(this.object.add(this.glb),this.object.remove(this.integratedMesh)):(this.object.add(this.glb),this.object.add(this.integratedMesh)),this.traverse(this.origionMesh,(function(t){t.opacity=e}))}},{key:"sceneBoundary",get:function(){var e=new g.j;return e.setFromObject(this.origionMesh),e}},{key:"targetInfo",get:function(){return Object(x.a)(Object(x.a)({},Object(D.a)(Object(B.a)(n.prototype),"targetInfo",this)),{},{type:qe.MOVE,id:"sceneModel",url:"",editable:!1})}}]),n}(ft),pn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e;return Object(m.a)(this,n),(e=t.call(this)).hotspotid=void 0,e.hotspotid=void 0,e}return Object(b.a)(n,[{key:"setHighResTexture",value:function(e){this.hotspotid===e.id&&this.cubemapMaterial.setTexture(e)}},{key:"fromTop",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];function n(e){return 1+Math.pow(e-1,5)}this.hotspotid=e.id,this.cubemapMaterial.setTexture(e);var i=this;return{progress:{inverse:!0,update:function(e){var a=n(e);i.transitionPercentage=t?a:1,i.cubemapMaterial.alpha=1-a}}}}},{key:"fromHotspot",value:function(e){this.hotspotid=e.id,this.cubemapMaterial.currentIndexIsZero=!this.cubemapMaterial.currentIndexIsZero,this.cubemapMaterial.setTexture(e);var t=this;return{easing:"easeInOutSine",progress:{inverse:t.cubemapMaterial.currentIndexIsZero,update:function(e){t.cubemapMaterial.transition=e}},complete:function(){t.cubemapMaterial.transition=t.cubemapMaterial.currentIndexIsZero?0:1}}}},{key:"goHotspot",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.hotspotid?this.fromHotspot(e):this.fromTop(e,t)}},{key:"goTop",value:function(){return this.hotspotid=void 0,this.transitionPercentage=1,{progress:{inverse:!0,update:function(e){}}}}}]),n}(dn),fn=function(){function e(){Object(m.a)(this,e),this.scene=void 0,this.viewportControls=void 0,this.Objects=void 0,this.mediaList=void 0,this.positionObjectlist=void 0,this.raycastTargets=[],this.sceneModel=new pn,this.hotspotMeshes=void 0,this.autoplay=void 0,this.hideHotspots=void 0,this.positionObjectsCount=void 0,this.mediaList=[],this.positionObjectlist=[],this.autoplay=!1,this.hideHotspots=!0,this.positionObjectsCount=0}return Object(b.a)(e,[{key:"init",value:function(e,t){this.viewportControls=t,this.scene=e,this.mediaList=[],this.positionObjectlist=[],this.autoplay=!1,this.hideHotspots=!0}},{key:"toJson",value:function(){var e=[];this.mediaList.forEach((function(t){var n=Object.entries(t.json).filter((function(e){return void 0!==e[1]&&null!==e[1]}));e.push(Object.fromEntries(n))}));var t=[];return this.positionObjectlist.forEach((function(e){t.push(e.json)})),{mediaObjects:e,positioningObjects:t}}},{key:"hideAllHotspots",value:function(e){this.hideHotspots=e,this.hotspotMeshes.forEach((function(t){t.object.visible=e}))}},{key:"createHotspots",value:function(e){var t=this,n=[];return e.forEach((function(e){var i=new $t.Hotspot;i.info=e,i.object.visible=!t.hideHotspots,t.scene.add(i),n.push(i)})),this.hotspotMeshes=n,{hotspotMeshes:n}}},{key:"createSceneModel",value:function(e){return this.sceneModel.setGLTF(e.space.glb),this.sceneModel.cubemapMaterial.axisIsZ=e.space.isMp,this.scene.add(this.sceneModel),this.sceneModel}},{key:"createMediaObjects",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r,s=this,c=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c.length>1&&void 0!==c[1]&&c[1],i=[],a=Object(un.a)(t),e.prev=3,r=f.a.mark((function e(){var t,a,r,c,u,l,h,d,p,v,m,b,g;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.value,a=void 0,e.t0=t.type,e.next=e.t0===st.MODEL?5:e.t0===st.PHOTO?9:e.t0===st.TAG?13:e.t0===st.GIF?17:e.t0===st.WEB?21:e.t0===st.VIDEO?24:e.t0===st.SPRITE?28:e.t0===st.TEXT?32:e.t0===st.PORTAL?35:e.t0===st.POSITIONPLANE?39:e.t0===st.POSITIONCUBE?54:67;break;case 5:return a=new $t.Model,e.next=8,a.init(t);case 8:return e.abrupt("break",67);case 9:return a=new $t.Image,e.next=12,a.init(t);case 12:return e.abrupt("break",67);case 13:return a=new $t.NewTag,e.next=16,a.init(t);case 16:return e.abrupt("break",67);case 17:return a=new $t.Gif,e.next=20,a.init(t);case 20:return e.abrupt("break",67);case 21:return(a=new $t.Webpage).init(t),e.abrupt("break",67);case 24:return a=new $t.Video,e.next=27,a.init(t);case 27:return e.abrupt("break",67);case 28:return a=new $t.Sprite,e.next=31,a.init(t);case 31:return e.abrupt("break",67);case 32:return(a=new $t.Text).init(t),e.abrupt("break",67);case 35:return a=new $t.Portal,e.next=38,a.init(t);case 38:return e.abrupt("break",67);case 39:return a=new $t.PositioningPlane,(r=t).positionObjectsCount=s.positionObjectsCount,s.positionObjectsCount++,e.next=45,a.init(r);case 45:if(!r.swappedProps){e.next=53;break}return e.next=48,s.createMediaObjects([r.swappedProps],!0);case 48:c=e.sent,u=c.newMedias,(l=u[0]).underPositioningObject=!0,a.swappedMedia=l;case 53:return e.abrupt("break",67);case 54:return a=new $t.PositioningCube,h=t,e.next=58,a.init(h);case 58:if(!h.swappedProps){e.next=66;break}return e.next=61,s.createMediaObjects([h.swappedProps],!0);case 61:d=e.sent,p=d.newMedias,(v=p[0]).underPositioningObject=!0,a.swappedMedia=v;case 66:return e.abrupt("break",67);case 67:a&&(n?i.push(a):(a.object.position.set(t.position.x,t.position.y,t.position.z),a.object.quaternion.set(t.rotation.x,t.rotation.y,t.rotation.z,t.rotation.w),a.object.scale.set(t.scale.x,t.scale.y,t.scale.z),s.raycastTargets.push(a),s.scene.add(a),(m=a).productId&&(b={id:m.productId,name:m.name,title:m.title,thumbnail:m.thumbnail},Be.dispatch(me(b))),g=s,a.addCustumDestory((function(){!function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}(g.mediaList,a)})),a.swappedMedia?(s.mediaList.push(a.swappedMedia),i.push(a.swappedMedia)):(s.mediaList.push(a),i.push(a))));case 68:case"end":return e.stop()}}),e)})),a.s();case 6:if((o=a.n()).done){e.next=10;break}return e.delegateYield(r(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),a.e(e.t1);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",{raycastTargets:this.raycastTargets,newMedias:i});case 20:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setAutoplay",value:function(e){this.autoplay=e}},{key:"setCaptureMedia",value:function(e){var t,n=Object(un.a)(this.mediaList);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.captureMedia(!e),(i instanceof $t.Video||i instanceof $t.Webpage||i instanceof $t.Gif)&&(i.object.visible=e)}}catch(a){n.e(a)}finally{n.f()}}}]),e}(),vn=n(72),mn=n.n(vn),bn=n(152),gn=n.n(bn);!function(e){e[e.SCENESYNC=0]="SCENESYNC",e[e.FLOORSYNC=1]="FLOORSYNC",e[e.DISABLESYNC=2]="DISABLESYNC",e[e.INVITEFOLLOW=3]="INVITEFOLLOW",e[e.ENABLESYNC=4]="ENABLESYNC",e[e.AVATARSTATUS=5]="AVATARSTATUS",e[e.AUDIENCESTATUS=6]="AUDIENCESTATUS",e[e.TAGINSCENESYNC=7]="TAGINSCENESYNC",e[e.TAGSYNC=8]="TAGSYNC",e[e.TALKER=9]="TALKER"}(an||(an={}));var yn=function(){function e(){var t=this;Object(m.a)(this,e),this.rtcClient=void 0,this.rtmClient=void 0,this.channel=void 0,this.sceneId=void 0,this.user=void 0,this.follower=void 0,this.viewportControls=void 0,this.avatarsManager=void 0,this.animationMgr=void 0,this.conversationMgr=void 0,this.allUsersList=void 0,this.handleMemberCountUpdated=function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("member count: ".concat(t)),null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.membercount,{memberCount:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleChannelMessage=function(){var e=Object(v.a)(f.a.mark((function e(n,i){var a,o,r,s,c,u,l,h,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.animationMgr){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.addMemberInList(i);case 4:if(a=e.sent,"TEXT"!==n.messageType){e.next=90;break}if(e.prev=6,o=JSON.parse(n.text),(r=an[o.command])!==an.AUDIENCESTATUS){e.next=11;break}return e.abrupt("return");case 11:if(a){e.next=15;break}return e.next=14,t.rtmClient.getUserAttributes(i);case 14:a=e.sent;case 15:return s=o.data,e.next=18,t.isFollower(i);case 18:c=e.sent,e.t0=r,e.next=e.t0===an.SCENESYNC?22:e.t0===an.FLOORSYNC?39:e.t0===an.TAGSYNC?41:e.t0===an.INVITEFOLLOW?58:e.t0===an.ENABLESYNC?66:e.t0===an.DISABLESYNC?70:e.t0===an.AVATARSTATUS?72:e.t0===an.TALKER?84:85;break;case 22:if(c){e.next=24;break}return e.abrupt("return");case 24:if(t.avatarsManager.setAvatarVisible(a.id,!1),s&&s.azimuthAngle&&t.viewportControls.setOrbitControlRotation(s.azimuthAngle,s.polarAngle),!s.isTop||t.viewportControls.isTop){e.next=30;break}t.animationMgr.goTop(),e.next=38;break;case 30:if(s.isTop||!t.viewportControls.isTop){e.next=35;break}t.animationMgr.latestHotspotId=s.hotspotId,t.animationMgr.godown(),e.next=38;break;case 35:if(!s.isTop){e.next=37;break}return e.abrupt("return");case 37:t.animationMgr.goHotspot(s.hotspotId);case 38:return e.abrupt("break",85);case 39:return null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.floortransition,{enabled:!0,data:s}),e.abrupt("break",85);case 41:if(u=s){e.next=44;break}return e.abrupt("return");case 44:if(c){e.next=46;break}return e.abrupt("return");case 46:if(!(l=Be.getState().tagReducer)||!l.tag||u.tag){e.next=55;break}if(null!==Be.getState().iframeReducer){e.next=50;break}return e.abrupt("return");case 50:(0,Be.getState().iframeReducer.sendMessage)(U.closecomponent,{tagId:l.tag.id}),console.log("SDK send close component message"),e.next=57;break;case 55:Be.getState().threeViewReducer.handleTagAction(null,u);case 57:return e.abrupt("break",85);case 58:if(console.log(a.name+" ask channel to follow him \ud83e\udd1f!!"),!c){e.next=61;break}return e.abrupt("return");case 61:if(null!==Be.getState().iframeReducer){e.next=63;break}return e.abrupt("return");case 63:return(0,Be.getState().iframeReducer.sendMessage)(U.memberfollow,{userId:i}),e.abrupt("break",85);case 66:return t.follow(i),t.avatarsManager.enableFollowerAvatar(i,!0),Be.dispatch(pe(!1)),e.abrupt("break",85);case 70:return c&&(t.unfollow(),t.avatarsManager.enableFollowerAvatar(i,!1)),e.abrupt("break",85);case 72:if(h=s,t.avatarsManager.enableAvatar(i,a),!c){e.next=78;break}t.avatarsManager.setAvatarVisible(i,!1),e.next=83;break;case 78:if((d=t.avatarsManager.getAvatar(h.id))&&!d.object.visible){e.next=83;break}return e.next=82,t.avatarsManager.updateAvatar(h);case 82:d&&d.object.visible&&d&&(d.avatarData.animationName!==h.animationName&&d.stopAvatarAnimationImmedicate(),d.playAvatarAnimation(h.animationName));case 83:case 84:return e.abrupt("break",85);case 85:e.next=90;break;case 87:e.prev=87,e.t1=e.catch(6),console.log(e.t1);case 90:case"end":return e.stop()}}),e,null,[[6,87]])})));return function(t,n){return e.apply(this,arguments)}}(),this.handleMemberLeft=function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("member is leave: ".concat(n)),delete t.allUsersList[n],t.avatarsManager){e.next=4;break}return e.abrupt("return");case 4:t.avatarsManager.removeAvatar(n),null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.memberleave,{memberId:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.handleMemberJoined=function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("member is join: ".concat(n)),t.avatarsManager.removeAvatar(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendChannelMessage=function(){var e=Object(v.a)(f.a.mark((function e(n,i){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.channel){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.rtmClient.getChannelMemberCount([t.channel.channelId]);case 4:e.sent[t.channel.channelId]>1&&t.channel.sendMessage({text:JSON.stringify({command:an[n],data:i})}).then((function(){})).catch((function(e){console.log(e)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var n=gn.a.LOG_FILTER_OFF;mn.a.setLogLevel(4),this.rtcClient=mn.a.createClient({codec:"vp8",mode:"live"}),y.isIOS&&(console.log("SET REMOTE_AUDIO_TRACK_USES_WEB_AUDIO"),mn.a.setParameter("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO",!0)),this.rtmClient=gn.a.createInstance(e.agoraAppId,{enableLogUpload:!1,logFilter:n}),this.viewportControls=wn.inst.viewportController,setTimeout(function(){this.animationMgr=wn.inst.animationMgr,this.avatarsManager=wn.inst.avatarsMgr,this.conversationMgr=wn.inst.conversationMgr}.bind(this),500),this.follower="",this.allUsersList={}}return Object(b.a)(e,[{key:"RtcClient",get:function(){return this.rtcClient}},{key:"RtmClient",get:function(){return this.rtmClient}},{key:"isFollowing",get:function(){var e=this;return Object(v.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.rtmClient.getUserAttributes(e.user.id);case 3:if(!(n=t.sent)||" "==n.follow){t.next=6;break}return t.abrupt("return",!0);case 6:return t.abrupt("return",!1);case 9:return t.prev=9,t.t0=t.catch(0),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()}},{key:"getChannelUser",value:function(e){return Be.getState().usersReducer.filter((function(t){return t.id===e}))[0]}},{key:"follow",value:function(e){var t=this;return Object(v.a)(f.a.mark((function n(){var i;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.rtmClient.getUserAttributes(t.user.id);case 2:if(!(i=n.sent)){n.next=9;break}return i.follow=e,n.next=7,t.rtmClient.setLocalUserAttributes(i);case 7:return t.follower=e,n.abrupt("return");case 9:return n.abrupt("return");case 10:case"end":return n.stop()}}),n)})))()}},{key:"unfollow",value:function(){var e=this;return Object(v.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.rtmClient.getUserAttributes(e.user.id);case 2:if(!(n=t.sent)){t.next=9;break}return n.follow=" ",t.next=7,e.rtmClient.setLocalUserAttributes(n);case 7:return e.follower="",t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)})))()}},{key:"isFollower",value:function(e){var t=this;return Object(v.a)(f.a.mark((function n(){var i;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.rtmClient.getUserAttributes(t.user.id);case 2:if(!(i=n.sent)||i.follow!==e){n.next=6;break}return t.follower=e,n.abrupt("return",!0);case 6:return n.abrupt("return",!1);case 7:case"end":return n.stop()}}),n)})))()}},{key:"addMemberInList",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.allUsersList[t]){e.next=10;break}return this.allUsersList[t]="",e.next=4,this.rtmClient.getUserAttributes(t);case 4:return n=e.sent,(i=n).id=t,Be.dispatch(se(i)),null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.memberjoin,{id:t,name:n.name,type:ae[n.type],photoUrl:n.photoUrl}),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();yn.agoraAppId="2e3a4751cc05489083db0316f44e47f5";var wn=function(){function e(){Object(m.a)(this,e),this.network=null,this.viewportController=null,this.raycaster=null,this.animationMgr=null,this.agoraMgr=null,this.conversationMgr=null,this.resLoad=null,this.avatarsMgr=null,this.firstPersonControls=null,this.objectController=null,this.mediaManager=null,this.scaleDeviceRatio=null,this.sdkKey=null}return Object(b.a)(e,null,[{key:"inst",get:function(){if(null==e.instance){e.instance=new e,e.instance.network=new C,e.instance.mediaManager=new fn,e.instance.viewportController=new Ze,e.instance.raycaster=new tt,e.instance.avatarsMgr=new rn,e.instance.firstPersonControls=new ct,e.instance.resLoad=new R,e.instance.agoraMgr=new yn,e.instance.conversationMgr=new cn,e.instance.animationMgr=new rt,window.devicePixelRatio>=1.5?e.inst.scaleDeviceRatio=1.5/window.devicePixelRatio:e.instance.scaleDeviceRatio=1}return e.instance}}]),e}();wn.instance=null;var xn,On,jn=n(31),kn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(){var e,i,a,o,r;Object(m.a)(this,n),(r=t.call(this)).background=new g.v(0);var s=new g.S;s.name="hemi_light",Object(D.a)((e=Object(jn.a)(r),Object(B.a)(n.prototype)),"add",e).call(e,s);var c=new g.d(16777215,.3);c.name="ambient_light",Object(D.a)((i=Object(jn.a)(r),Object(B.a)(n.prototype)),"add",i).call(i,c);var u=new g.D(16777215,.2);u.position.set(.5,0,.866),u.name="main_light",Object(D.a)((a=Object(jn.a)(r),Object(B.a)(n.prototype)),"add",a).call(a,u);var l=new g.D(16777215,2.5);return u.position.set(-.5,0,-.866),u.name="main_light",Object(D.a)((o=Object(jn.a)(r),Object(B.a)(n.prototype)),"add",o).call(o,l),r}return Object(b.a)(n,[{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(arguments.length>1){for(var a=0;a<arguments.length;a++)this.add(arguments[a]);return this}if(t[0]instanceof ht)this.postprocess(t[0].object,t[0].type),Object(D.a)(Object(B.a)(n.prototype),"add",this).call(this,t[0].object);else if(t){var o;(o=Object(D.a)(Object(B.a)(n.prototype),"add",this)).call.apply(o,[this].concat(t))}return this}},{key:"postprocess",value:function(e,t){var n=function(e){var t,n,i,a=e.fragmentShader.lastIndexOf("}"),o=["if(gl_FragColor.a < 0.1){","   discard;","}",""].join("\n");e.fragmentShader=(t=e.fragmentShader,n=a,i=o,t.substr(0,n)+i+t.substr(n))};switch(t){case st.TEXT:case st.PHOTO:case st.PORTAL:case st.TAG:e.traverse((function(e){e instanceof g.sb&&(e.material.onBeforeCompile=n)}))}if(t===st.MOUSEICON)e.renderOrder=100;else e.renderOrder=0}}]),n}(g.ec),Mn=n(192),An=n.n(Mn),En=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e){var i;Object(m.a)(this,n);var a=new g.dc(.1,.2,36,1,32),o=new g.tb({color:new g.v(e),side:g.E,transparent:!0,opacity:0,depthTest:!1});return(i=t.call(this,a,o)).renderOrder=2,i}return Object(b.a)(n,[{key:"opacity",set:function(e){this.material.opacity=e}},{key:"set",value:function(e,t){this.position.set(t.x,t.y,t.z),this.setRotationFromMatrix(e),this.opacity=1}}]),n}(g.sb);n(292);(On=xn||(xn={}))[On.nx=0]="nx",On[On.px=1]="px",On[On.py=2]="py",On[On.ny=3]="ny",On[On.pz=4]="pz",On[On.nz=5]="nz";var Tn,Cn="png",Sn={low:512,high:1024},In=function(){function e(t,n){var i=this;Object(m.a)(this,e),this.size=void 0,this.renderer=void 0,this.targetScene=void 0,this.canvas=void 0,this.ctx=void 0,this.highTextureCamera=void 0,this.lowTextureCamera=void 0,this.getFile=function(){var e=Object(v.a)(f.a.mark((function e(t){var n,a,o,r,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.image,a=void 0===n?null:n,o=t.filename,r=void 0===o?"":o,e.next=3,i.getImageBlob(a);case 3:return s=e.sent,c=new File([s],r),e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getImageBlob=function(e){return i.ctx.putImageData(e,0,0),new Promise((function(e){i.canvas.toBlob((function(t){e(t)}),"image/png")}))},this.size=1024,this.renderer=t,this.targetScene=n,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var a=new g.Fc(Sn.low,{format:g.Wb,generateMipmaps:!0,minFilter:g.ib});a.texture.encoding=g.Jc,this.lowTextureCamera=new g.w(.1,3e4,a);var o=new g.Fc(Sn.high,{format:g.Wb,generateMipmaps:!0,minFilter:g.ib});o.texture.encoding=g.Jc,this.highTextureCamera=new g.w(.1,3e4,o)}return Object(b.a)(e,[{key:"update",value:function(e,t){var n=this.renderer.autoClear;this.renderer.autoClear=!0,this.lowTextureCamera.position.copy(e),this.lowTextureCamera.update(this.renderer,this.targetScene),this.highTextureCamera.position.copy(e),this.highTextureCamera.update(this.renderer,this.targetScene),this.renderer.autoClear=n}},{key:"convert",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i,a,o,r,s,c,u,l,d,p,m,b,g,y,w,x,O,j,k,M,A,E,T=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],this.canvas.width=n,this.canvas.height=n,a=0;a<6;a++){if(o=new Uint8Array(4*n*n),n==Sn.low?this.renderer.readRenderTargetPixels(this.lowTextureCamera.renderTarget,0,0,n,n,o,a):this.renderer.readRenderTargetPixels(this.highTextureCamera.renderTarget,0,0,n,n,o,a),r=new ImageData(new Uint8ClampedArray(o),n,n),a===xn.py||a===xn.ny)for(s=0;s<r.width;s++)for(c=0;c<r.height/2;c++)for(u=4*c*r.width+4*s,l=4*(r.height-1-c)*r.width+4*s,d=0;d<4;d++)p=r.data[u+d],r.data[u+d]=r.data[l+d],r.data[l+d]=p;else for(m=0;m<r.height;m++)for(b=0;b<r.width/2;b++)for(u=4*m*r.width+4*b,l=4*(m+1)*r.width-4*(b+1),g=0;g<4;g++)p=r.data[u+g],r.data[u+g]=r.data[l+g],r.data[l+g]=p;y={image:r,filename:t+xn[a].toString()+"."+Cn},i.push(y)}return e.next=6,Promise.all(i.map(function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.download(t.image,t.filename);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.next=8,Promise.all(i.map((function(e){return T.getFile(e)})));case 8:w=e.sent;try{x=Object(h.a)(w,6),O=x[0],j=x[1],k=x[2],M=x[3],A=x[4],E=x[5],[k,A,j,E,O,M]}catch(C){console.log(C)}case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"download",value:function(e,t){var n=this;return this.ctx.putImageData(e,0,0),new Promise((function(e){n.canvas.toBlob((function(n){var i=URL.createObjectURL(n),a=t,o=document.createElement("a");o.href=i,o.setAttribute("download",a),o.className="download-js-link",o.innerHTML="downloading...",o.style.display="none",document.body.appendChild(o),setTimeout((function(){o.click(),document.body.removeChild(o),e()}),1)}),"image/jpg")}))}},{key:"captureScene",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.update(t,n),e.next=3,this.convert(i,Sn.low);case 3:return e.sent,e.next=6,this.convert(i,Sn.high);case 6:e.sent;case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()}]),e}(),Pn=n(193),Rn=n(194),Dn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e){var i;Object(m.a)(this,n),(i=t.call(this,st.MODEL)).water=void 0,i.scene=void 0;var a=new g.Nb(1e4,1e4),o=new g.D(16777215,1);return o.position.set(1,1,1),e.add(o),i.water=new Pn.a(a,{textureWidth:512,textureHeight:512,waterNormals:(new g.qc).load("https://room.osensetech.com/medias/waternormals.jpeg",(function(e){e.wrapS=e.wrapT=g.bc})),sunDirection:o.position.clone().normalize(),sunColor:16777215,waterColor:1873594,distortionScale:3.7,fog:void 0!==e.fog}),i.water.position.y=-1,i.scene=e,i}return Object(b.a)(n,[{key:"onMouseEnter",value:function(){throw new Error("Method not implemented.")}},{key:"onMouseLeave",value:function(){throw new Error("Method not implemented.")}},{key:"onMouseMove",value:function(e,t){throw new Error("Method not implemented.")}},{key:"onMouseUp",value:function(e,t){throw new Error("Method not implemented.")}},{key:"updateOcean",value:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.water&&(this.water.material.uniforms.time.value+=1/60);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a,o,r,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new g.Bc,this.water.rotation.x=-Math.PI/2,this.scene.add(this.water),(n=new Rn.a).scale.setScalar(1e4),this.scene.add(n),(i=n.material.uniforms).turbidity.value=10,i.rayleigh.value=2,i.mieCoefficient.value=.005,i.mieDirectionalG.value=.8,a={elevation:15,azimuth:180},o=g.qb.degToRad(90-a.elevation),r=g.qb.degToRad(a.azimuth),t.setFromSphericalCoords(1,o,r),n.material.uniforms.sunPosition.value.copy(t),this.water.material.uniforms.sunDirection.value.copy(t).normalize(),s=wn.inst.viewportController,y.isSafari||G()(navigator.userAgent)?(c=new g.Jb(s.renderer),this.scene.environment=c.fromScene(this.scene).texture):(s.renderer.outputEncoding=g.gb,s.renderer.toneMapping=g.Eb);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ht),Bn=function(){function e(e,n,i){this.renderer=e,this.width=512,this.height=512,this.delta=new g.Ac(1/this.width,1/this.height),this.hMap=new g.Hc(this.width,this.height,{type:g.K,depthBuffer:!1,stencilBuffer:!1}),this.hMap1=new g.Hc(this.width,this.height,{type:g.K,depthBuffer:!1,stencilBuffer:!1}),this.fsQuad=new t,this.initShaders()}e.prototype.initShaders=function(){var e="\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ";this.copyMat=new g.fc({uniforms:{tDiffuse:{value:null}},vertexShader:e,fragmentShader:"\n          uniform sampler2D tDiffuse;\n          varying vec2 vUv;\n          void main() {\n            gl_FragColor = texture2D(tDiffuse, vUv);\n          }\n        "}),this.updateMat=new g.fc({uniforms:{tDiffuse:{value:null},delta:new g.uc(this.delta)},vertexShader:e,fragmentShader:"\n          uniform sampler2D tDiffuse;\n          uniform vec2 delta;\n          varying vec2 vUv;\n          void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n  \n            vec2 dx = vec2(delta.x, 0.0);\n            vec2 dy = vec2(0.0, delta.y);\n            float average = (\n              texture2D(tDiffuse, vUv - dx).r +\n              texture2D(tDiffuse, vUv - dy).r +\n              texture2D(tDiffuse, vUv + dx).r +\n              texture2D(tDiffuse, vUv + dy).r\n            ) * 0.25;\n            texel.g += (average - texel.r) * 2.0;\n            texel.g *= 0.995;\n            texel.r += texel.g;\n  \n            gl_FragColor = texel;\n          }\n        "}),this.normalsMat=new g.fc({uniforms:{tDiffuse:{value:null},delta:new g.uc(this.delta)},vertexShader:e,fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 delta;\n        varying vec2 vUv;\n        void main() {\n          vec4 texel = texture2D(tDiffuse, vUv);\n          vec3 dx = vec3(delta.x, texture2D(tDiffuse, vec2(vUv.x + delta.x, vUv.y)).r - texel.r, 0.0);\n          vec3 dy = vec3(0.0, texture2D(tDiffuse, vec2(vUv.x, vUv.y + delta.y)).r - texel.r, delta.y);\n          texel.ba = normalize(cross(dy, dx)).xz;\n          gl_FragColor = texel;\n        }\n      "}),this.dropMat=new g.fc({uniforms:{tDiffuse:{value:null},center:new g.uc(new g.Ac),radius:{value:.05},strength:{value:.5}},vertexShader:e,fragmentShader:"\n          const float PI = 3.1415926535897932384626433832795;\n          uniform sampler2D tDiffuse;\n          uniform vec2 center;\n          uniform float radius;\n          uniform float strength;\n          varying vec2 vUv;\n          void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n            float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - vUv) / radius);\n            drop = 0.5 - cos(drop * PI) * 0.5;\n            texel.r += drop * strength;\n            // texel.r = clamp(texel.r, -2.0, 2.0);\n            gl_FragColor = texel;\n          }\n        "})},e.prototype.update=function(){this.updateHMap(),this.updateHMapNormals()},e.prototype.updateHMap=function(){this.updateMat.uniforms.tDiffuse.value=this.hMap.texture,this.renderShaderMat(this.updateMat,this.hMap1),this.swapBuffers()},e.prototype.updateHMapNormals=function(){this.normalsMat.uniforms.tDiffuse.value=this.hMap.texture,this.renderShaderMat(this.normalsMat,this.hMap1),this.swapBuffers()},e.prototype.addDrop=function(e,t,n,i){this.dropMat.uniforms.tDiffuse.value=this.hMap.texture,this.dropMat.uniforms.center.value.set(e,t),this.dropMat.uniforms.radius.value=n,this.dropMat.uniforms.strength.value=i,this.renderShaderMat(this.dropMat,this.hMap1),this.swapBuffers()},e.prototype.renderBuffer=function(e,t){t=t||null,this.copyMat.uniforms.tDiffuse.value=e.texture,this.renderShaderMat(this.copyMat,t)},e.prototype.renderShaderMat=function(e,t){this.fsQuad.material=e;var n=this.renderer.getRenderTarget();this.renderer.setRenderTarget(t),this.fsQuad.render(this.renderer),this.renderer.setRenderTarget(n)},e.prototype.swapBuffers=function(){var e=this.hMap;this.hMap=this.hMap1,this.hMap1=e};var t=function(){var e=new g.Ib(-1,1,1,-1,0,1),t=new g.Mb(2,2),n=function(e){this._mesh=new g.sb(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{render:function(t){t.render(this._mesh,e)}}),n}();return e}(),Ln=n(110),Nn=n.n(Ln),zn=function(e){Object(L.a)(n,e);var t=Object(N.a)(n);function n(e,i){var a;Object(m.a)(this,n),(a=t.call(this,st.MODEL)).scene=void 0,a.ripple=void 0,a.line1=void 0,a.line2=void 0,a.pointLight1=void 0,a.pointLight2=void 0,a.pointLight3=void 0,a.pointLight4=void 0,a.count=void 0,a.ripple=new Bn(i,window.innerWidth,window.innerHeight),a.scene=e,a.count=0;var o=Object(jn.a)(a),r=new g.xb({color:16777215,side:g.E,metalness:.5,roughness:.5});r.onBeforeCompile=function(e){e.uniforms.hmap={value:o.ripple.hMap.texture},e.vertexShader="uniform sampler2D hmap;\n"+e.vertexShader;e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n                    vec3 transformed = vec3(position);\n                    vec4 info = texture2D(hmap, uv);\n                    vNormal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a).xzy;\n                    transformed.z = 20. * info.r;\n                ")};for(var s=Math.round(200),c=Math.round(200),u=10/s,l=10/c,h=0;h<=c;h++){for(var d=new g.o,p=[],f=[],v=h*l-5,b=0;b<=s;b++)p.push(b*u-5,v,0),f.push(b/s,h/c);d.setAttribute("position",new g.J(p,3)),d.setAttribute("uv",new g.J(f,2)),d.computeBoundingSphere(),a.line1=new g.cb(d,r),a.line1.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2),a.line1.position.y=-.01,a.line1.position.z=-5,a.scene.add(a.line1)}u=10/(s=Math.round(25)),l=10/(c=Math.round(200));for(var y=0;y<=s;y++){for(var w=new g.o,x=[],O=[],j=y*u-5,k=0;k<=c;k++)x.push(j,k*l-5,0),O.push(y/s,k/c);w.setAttribute("position",new g.J(x,3)),w.setAttribute("uv",new g.J(O,2)),w.computeBoundingSphere(),a.line2=new g.cb(w,r),a.line2.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2),a.line2.position.y=-.01,a.line2.position.z=-5,a.scene.add(a.line2)}return a.scene.children.forEach((function(t){"main_light"!=t.name&&"hemi_light"!=t.name||e.remove(t)})),a.pointLight1=new g.Ob(15402960),a.pointLight1.position.set(-2,0,-5),a.scene.add(a.pointLight1),a.pointLight2=new g.Ob(1064908),a.pointLight2.position.set(2,0,-5),a.scene.add(a.pointLight2),a.pointLight3=new g.Ob(16728128),a.pointLight3.position.set(-2,0,0),e.add(a.pointLight3),a.pointLight4=new g.Ob(2221314),a.pointLight4.position.set(2,0,0),e.add(a.pointLight4),a}return Object(b.a)(n,[{key:"onMouseEnter",value:function(){throw new Error("Method not implemented.")}},{key:"onMouseLeave",value:function(){throw new Error("Method not implemented.")}},{key:"onMouseMove",value:function(e,t){throw new Error("Method not implemented.")}},{key:"onMouseUp",value:function(e,t){throw new Error("Method not implemented.")}},{key:"updateWave",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Math.random()<.5,n=.001*Date.now(),i=.2*Math.cos(n),a=.2*Math.sin(n),this.ripple.addDrop(i,a,.02,t?.01:-.005),this.ripple.update(),this.count++,this.count>2e3&&(this.pointLight1.color=new g.v(Nn.a.random().hex()),this.pointLight2.color=new g.v(Nn.a.random().hex()),this.pointLight3.color=new g.v(Nn.a.random().hex()),this.pointLight4.color=new g.v(Nn.a.random().hex()),this.count=0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ht),Un=n(58),Hn="https://viewer.vexspace.co/arview/index.html",Vn=n(173);Vn.setIntervalAsync,Vn.clearIntervalAsync;!function(e){e.raycastMouseUp="raycast-mouse-up",e.raycastMouseEnter="raycast-mouse-enter",e.raycastMouseLeave="raycast-mouse-leave"}(Tn||(Tn={}));var Fn=0,_n=function(){function e(t,n){Object(m.a)(this,e),this.stats=void 0,this.animationMgr=wn.inst.animationMgr,this.viewportControls=wn.inst.viewportController,this.agoraManager=wn.inst.agoraMgr,this.avatarsMgr=wn.inst.avatarsMgr,this.conversationMgr=wn.inst.conversationMgr,this.mousecursor=void 0,this.mediaManager=void 0,this.captureManager=void 0,this.scene=null,this.arLink=null,this.showModalBox=void 0,this.showPropertyMenu=void 0,this.gpuRaycaster=void 0,this.hoverBbox=void 0,this.hoverObject=void 0,this.checkAutoPlay=!1,this.sdkDebug=!1,this.tickIntervalId=void 0,this.events=void 0,this.skybox=void 0,this.clock=void 0,this.ocean=void 0,this.foggy=void 0,this.gridWave=void 0;var i=document.getElementById("three-root");this.scene=new kn,this.events=new An.a,this.sdkDebug=null!==n&&void 0!==n&&n,this.viewportControls.init(i),this.godown=this.godown.bind(this),this.goup=this.goup.bind(this),this.mediaManager=wn.inst.mediaManager,this.mediaManager.init(this.scene,this.viewportControls),this.mediaManager.setAutoplay(!0),this.gpuRaycaster=new nn(this.scene,i,this.viewportControls.renderer,this.viewportControls.camera,1,2),this.gpuRaycaster.mouseUp=this.raycastMouseUp.bind(this),this.gpuRaycaster.mouseMove=this.raycastMousemove.bind(this),this.gpuRaycaster.mouseDown=this.raycastMouseDown.bind(this),this.gpuRaycaster.mouseEnter=this.raycastMouseEnter.bind(this),this.gpuRaycaster.mouseLeave=this.raycastMouseLeave.bind(this),this.avatarsMgr.setSceneRaycast(this.scene,this.gpuRaycaster),this.captureManager=new In(this.viewportControls.renderer,this.scene)}return Object(b.a)(e,[{key:"parseInput",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n){var i=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(v.a)(f.a.mark((function e(a){var o,s,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t,s=t.scene,e.next=4,wn.inst.resLoad.load(o.space.glbUrl,r.Model,n);case 4:c=e.sent,o.space.glb=c,o.postProcessing=void 0!=s?s.postProcessing:void 0,i.viewportControls.createPostProcessController(i.scene,o.postProcessing),"JspMv04BQSHAjBmzgTVK"===o.space.id&&(i.viewportControls.createBloomController(i.scene),i.gridWave=new zn(i.scene,i.viewportControls.renderer)),o.space.ocean&&(i.ocean=new Dn(i.scene),i.ocean.init()),o.space.isMp&&(o.space.glb.scene.quaternion.setFromAxisAngle(new g.Bc(1,0,0),-Math.PI/2),o.hotspots.forEach((function(e){var t=new g.Bc(e.position.x,e.position.y,e.position.z);t.applyAxisAngle(new g.Bc(1,0,0),-Math.PI/2),e.position.x=t.x,e.position.y=t.y,e.position.z=t.z}))),o.hotspots.forEach((function(e){var t=e.rotation,n=new g.rb;n.compose(new g.Bc(0,0,0),new g.Sb(t.x,t.y,t.z,t.w),new g.Bc(1,1,1));var i=new g.G;i.setFromRotationMatrix(n);var a=(new g.Sb).setFromAxisAngle(new g.Bc(0,-1,0),i.z-(o.space.isMp?1.57:0));e.rotation.x=a.x,e.rotation.y=a.y,e.rotation.z=a.z,e.rotation.w=a.w})),o.space.glb.scene.updateMatrixWorld(!0),o.space.isMp||o.hotspots.forEach((function(e){var t=new g.Bc(e.position.x,e.position.y+e.cameraHeight,e.position.z),n=new g.Bc(0,-1,0).normalize(),i=new g.Zb;i.set(t,n);var a=i.intersectObject(o.space.glb.scene,!0);if(a.length>0){var r=a[0].point.y;e.cameraHeight+=e.position.y-r,e.position.y=r}})),o.space.cameraTopHeight&&o.space.goTopDistance&&i.viewportControls.setCustomFocusBbox(o.space.goTopDistance,o.space.cameraTopHeight),a(o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(v.a)(f.a.mark((function e(t,n,i){var a,o,r,s,c,u,l,h,d,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(/^(iPad|iPhone|iPod)/.test(window.navigator.platform)||/^Mac/.test(window.navigator.platform)&&window.navigator.maxTouchPoints>1)&&(window.createImageBitmap=void 0),a=t.space.cursorColor?t.space.cursorColor:"#ffffff",this.mousecursor=new En(a),this.mousecursor.opacity=.3,this.scene.add(this.mousecursor),(y.isMobile||G()(navigator.userAgent))&&(this.mousecursor.visible=!1),e.next=9,this.parseInput(t,i);case 9:if((o=e.sent).hotspots.forEach((function(e){e.hotspotColor=t.space.hotspotColor?t.space.hotspotColor:"#ffffff",e.hotspotScale||(e.hotspotScale=t.space.hotspotScale?t.space.hotspotScale:0)})),r=this.mediaManager.createHotspots(o.hotspots),(s=r.hotspotMeshes).forEach((function(e){o.space.disableHotspots||e.hide?e.object.visible=!1:e.object.visible=!0})),this.avatarsMgr.setHotspots(o.hotspots),this.animationMgr.initHotspotInfos(o.hotspots,s),this.animationMgr.displayHotspotNeighbors(void 0),this.gpuRaycaster.addTarget(s),c=this.mediaManager.createSceneModel(o),this.gpuRaycaster.addTarget(c,nn.RAYCASTTYPE.GETBOTH),this.viewportControls.setFocusBbox(c.center,c.size),this.animationMgr.init(this.viewportControls,c),this.animationMgr.enableCalcDurationByDistance=!0,this.animationMgr.setAnimationDurationParameters(null,null,null,250),o.space.skybox&&(this.skybox=wn.inst.resLoad.loadEnvCubeMap(o.space.skybox),this.scene.add(this.skybox)),null!=t.scene&&null!=t.scene.startHotspotId?(this.viewportControls.azimuthAngle=t.scene.azimuthAngle,this.animationMgr.goHotspot(t.scene.startHotspotId,c.center,t.scene.polarAngle)):this.animationMgr.goHotspot(void 0,c.center),Be.dispatch(Me(this.capture.bind(this))),u=[],l=[],h=[],d=[],o.mediaObjects.forEach((function(e){var n=e;n.type=n.type.toUpperCase();var i=t.tagsData;if((e.type===st.POSITIONPLANE||e.type===st.POSITIONCUBE)&&i.length>0){var a=i.filter((function(e){return e.id===n.name}))[0];if(void 0!=a){var o,r,s,c,p,f,v=n;v.swappedType=a.type.toUpperCase(),v.swappedProps={type:v.swappedType,fileUrl:null!==(o=a.url)&&void 0!==o?o:"",componentName:null!==(r=a.componentName)&&void 0!==r?r:"",componentData:null!==(s=a.componentData)&&void 0!==s?s:"",autoPlay:null!==(c=a.autoPlay)&&void 0!==c&&c,autoAudio:null!==(p=a.autoAudio)&&void 0!==p&&p,isRaycastable:!0,extData:null!==(f=a.extData)&&void 0!==f?f:{}}}}"VIDEO"===n.type?h.push(n):"TAG"===n.type?d.push(n):"MODEL"===n.type?l.push(n):u.push(n)})),3,this.createMedias(h,h.length),this.createMedias(d,d.length),this.createMedias(l,l.length),this.createMedias(u,u.length<3?u.length:3),!t.scene){e.next=44;break}if((t.scene.social||t.scene.fakeAudience)&&wn.inst.avatarsMgr.avatarQueueCreation(),null!=Be.getState().iframeReducer||!t.scene.social){e.next=43;break}return e.next=41,wn.inst.avatarsMgr.createRandomAvatarObject();case 41:p=e.sent,Be.dispatch(se(p));case 43:t.scene.fakeAudience&&wn.inst.avatarsMgr.createFakeAvatarObjects(100);case 44:0;case 45:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"createMedias",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r=this,s=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>1&&void 0!==s[1]?s[1]:1,i=!1,t.length>0&&"VIDEO"===t[0].type&&(i=!0),a=0;case 4:if(!(a<t.length)){e.next=11;break}return o=t.slice(a,a+n),e.next=8,this.mediaManager.createMediaObjects(o).then((function(e){for(var t=e.newMedias,n=0;n<t.length;n++){var i=t[n];r.gpuRaycaster.addTarget(i,nn.RAYCASTTYPE.GETBOTH)}}));case 8:a+=n,e.next=4;break;case 11:i&&(this.checkAutoPlay=!0);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"raycastMouseEnter",value:function(e){e instanceof dt&&this.events.emit(Tn.raycastMouseEnter,e)}},{key:"raycastMouseLeave",value:function(e){e instanceof dt&&this.events.emit(Tn.raycastMouseLeave,e)}},{key:"raycastMouseUp",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r,s,c,u,l,h,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(!this.agoraManager.user){e.next=5;break}if(""==this.agoraManager.follower){e.next=5;break}return e.abrupt("return");case 5:if(!qe.hasProperty(t.target.type,qe.AVATAR)){e.next=11;break}if((n=t.target.mediaClass).avatarData.hotspotId!==this.animationMgr.latestHotspotId){e.next=9;break}return e.abrupt("return");case 9:return null!==Be.getState().iframeReducer&&n.avatarData?this.avatarsMgr.avatars.length<=100&&(i=Be.getState().iframeReducer.sendMessage,console.log("[SDK] Click Avatar UserId "+n.avatarData.id),i(U.memberclick,{userId:n.avatarData.id})):this.conversationMgr.createConversation(n.avatarData),e.abrupt("return");case 11:if(qe.hasProperty(t.target.type,qe.REDIRECT)&&(window.location.href=t.target.url),!t.target.mediaClass||!t.target.mediaClass.floorTargetId){e.next=15;break}return this.handleFloorAction(t.target.mediaClass.floorTargetId),e.abrupt("return");case 15:if(void 0===t.target.mediaClass||!t.target.mediaClass.openLink){e.next=20;break}return a=t.target.mediaClass.openLink,(o=window.open(a,"_blank"))&&o.focus(),e.abrupt("return");case 20:if(void 0===t.target.mediaClass||qe.hasProperty(t.target.type,qe.MOVE)){e.next=29;break}if(!t.target.mediaClass.usdzObjectUrl){e.next=25;break}return r={id:t.target.id,glbUrl:"",usdzUrl:t.target.mediaClass.usdzObjectUrl,purchaseInfo:null,url:t.target.url,name:t.target.mediaClass.name},this.handleARTagClick(r),e.abrupt("return");case 25:return this.handleTagAction(t.target.mediaClass),e.abrupt("return");case 29:if(!qe.hasProperty(t.target.type,qe.SHOWMODAL)){e.next=40;break}if(!t.target.mediaClass||!t.target.mediaClass.glbObjectUrl){e.next=40;break}if(s=t.target.mediaClass,c=s.glbObjectUrl,u=s.usdzObjectUrl,!(l={id:t.target.id,glbUrl:c,usdzUrl:u,purchaseInfo:null,url:t.target.url,name:t.target.mediaClass.name}).glbUrl){e.next=40;break}if(l.url="".concat(Hn,"?url=").concat(l.glbUrl),!y.isMobile){e.next=40;break}return this.handleARTagClick(l),e.abrupt("return");case 40:qe.hasProperty(t.target.type,qe.MOVE)&&(h=t.target,d=t.position,this.animationMgr.goHotspot(h.id,d));case 41:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleTagAction",value:function(e,t){var n=t?t.tag:null;if(n&&!e){var i=this.mediaManager.mediaList.filter((function(e){return e.id===n.id}));i.length>0&&(e=i[0])}if(!n&&e&&(n={id:e.id,moduleId:e.moduleId,tokenId:e.tokenId,type:e.type,canOpenComponent:!0}),e&&e.type===st.VIDEO){var a=e;a.videoType===lt.youtube||a.videoType===lt.vimeo?a.toggle():a.videoPlayer&&a.videoPlayer.isPlaying||(this.handleVideoPlay(a,!1),n.canOpenComponent=!1)}n&&n.canOpenComponent&&(this.handleOpenComponent(n),Be.dispatch(Oe(n,!0)))}},{key:"handleOpenComponent",value:function(e){var t=!1;if(null!==Be.getState().iframeReducer&&e.id){t=!0;var n=Be.getState().iframeReducer.sendMessage;console.log("[SDK] send tagId "+e.id),n(U.opentag,{tagId:e.id})}if(t){var i=Be.getState().iframeReducer.sendMessage;e.moduleId?(i(U.opencomponent,{moduleId:e.moduleId,tagId:e.id}),console.log("[SDK] send moduleId "+e.moduleId)):e.tokenId&&(i(U.opencomponent,{tokenId:e.tokenId,tagId:e.id}),console.log("[SDK] send tokenId "+e.tokenId)),this.removeBoxHelper(),this.mousecursor.visible=!1}}},{key:"handleFloorAction",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendTickMessage",value:function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.agoraManager.RtmClient,n=this.avatarsMgr.avatarData,t&&n&&(this.tickIntervalId||(i=1e3,n.type===ae.audience&&(i=1500),this.tickIntervalId=window.setInterval(this.onChannelTick.bind(this),i)));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"raycastMouseDown",value:function(e){if(this.checkAutoPlay){if(this.playVideos(),null!==Be.getState().iframeReducer)(0,Be.getState().iframeReducer.sendMessage)(U.userhasinteract,{});this.checkAutoPlay=!1}}},{key:"raycastMousemove",value:function(e){if(this.sdkDebug,e){var t=n(46);if(y.isMobile||t(navigator.userAgent))this.mousecursor.visible=!1;else if(this.mousecursor){var i=e.rotation,a=e.position;this.mousecursor.set(i,a)}if(e.target){var o,r,s=e.target,c=s.object,u=s.mediaClass;if(c===this.hoverObject)return;if(!u||u.type===st.HOTSPOT||u.type===st.SCENEMODEL)return this.removeBoxHelper(),void(document.body.style.cursor="auto");this.mousecursor.visible=!1,document.body.style.cursor="pointer",this.hoverObject=c,null===(o=this.hoverBbox)||void 0===o||null===(r=o.parent)||void 0===r||r.remove(this.hoverBbox)}}}},{key:"removeBoxHelper",value:function(){var e,t;null===(e=this.hoverBbox)||void 0===e||null===(t=e.parent)||void 0===t||t.remove(this.hoverBbox),this.hoverBbox=void 0,this.hoverObject=void 0}},{key:"addBoxHelper",value:function(e){var t=e.quaternion.clone();e.quaternion.set(0,0,0,1),this.hoverBbox=new g.m(e,4325442),e.quaternion.copy(t),this.hoverBbox.applyMatrix4(e.matrixWorld.invert()),e.add(this.hoverBbox)}},{key:"handleARTagClick",value:function(e){if(null!==this.arLink){var t="";if(e.purchaseInfo){var n=e.purchaseInfo.split(",");t="applePayButtonType=buy&checkoutTitle=".concat(e.name,"&checkoutSubtitle=").concat(n[0],"&price=").concat(n[1]),this.arLink.href="".concat(e.usdzUrl,"#").concat(t)}else this.arLink.href="".concat(e.usdzUrl);this.arLink.click()}else if(y.isMobile&&y.isAndroid){var i=window.open("".concat(Hn,"?url=").concat(e.glbUrl),"_blank");i&&i.focus()}}},{key:"onChannelTick",value:function(){var e=this.avatarsMgr.avatarData;if(e.type===ae.audience)this.agoraManager.sendChannelMessage(an.AUDIENCESTATUS,{});else{e.hotspotId=this.animationMgr.latestHotspotId,this.agoraManager.sendChannelMessage(an.AVATARSTATUS,e);var t=this.viewportControls.azimuthAngle,n=this.viewportControls.polarAngle,i=this.animationMgr.currentMoveHotspotId,a=this.viewportControls.isTop,o=Be.getState().tagReducer;this.agoraManager.sendChannelMessage(an.SCENESYNC,{azimuthAngle:t,polarAngle:n,hotspotId:i,isTop:a}),this.agoraManager.sendChannelMessage(an.TAGSYNC,o)}}},{key:"godown",value:function(){this.animationMgr.godown()}},{key:"goup",value:function(){this.animationMgr.goTop()}},{key:"controlAllVideoAudios",value:function(e){this.mediaManager.mediaList.filter((function(e){return e.type===st.VIDEO})).forEach((function(t){t.videoPlayer&&t.videoPlayer.muted(e)}))}},{key:"handleAudioPlay",value:function(e){if(e&&e.videoPlayer){var t=!e.videoPlayer.isMuted;if(!t)this.mediaManager.mediaList.filter((function(e){return e.type===st.VIDEO})).forEach((function(t){t.id!==e.id&&t.videoPlayer&&t.videoPlayer.muted(!0)}));e.videoPlayer&&e.videoPlayer.muted(t)}}},{key:"handleVideoPlay",value:function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i,a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(a.length>1&&void 0!==a[1])||a[1],!y.isMobile&&!G()(navigator.userAgent)){e.next=9;break}if(t){e.next=4;break}return e.abrupt("return");case 4:this.mediaManager.mediaList.filter((function(e){return e.type===st.VIDEO})).forEach((function(e){e.id!==t.id&&e.videoPlayer&&e.videoPlayer.isPlaying&&e.toggle()})),t.toggle(),e.next=17;break;case 9:if(!n){e.next=13;break}this.playVideos(),e.next=17;break;case 13:return e.next=15,t.toggle();case 15:i=t.videoPlayer.isMuted,t.videoPlayer.muted(i);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopVideos",value:function(){this.mediaManager.mediaList.filter((function(e){return e.type===st.VIDEO})).forEach((function(e){e.videoType!==lt.youtube&&e.videoType!==lt.vimeo&&e.videoPlayer&&e.videoPlayer.isPlaying&&e.toggle()}))}},{key:"playVideos",value:function(){this.mediaManager.mediaList.filter((function(e){return e.type===st.VIDEO})).forEach(function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.videoPlayer&&t.videoPlayer.isPlaying){e.next=5;break}if(!t.autoPlay){e.next=5;break}return console.log("video autoPlay"),e.next=5,t.toggle();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"capture",value:function(){this.mediaManager.setCaptureMedia(!1),this.captureManager.captureScene(this.viewportControls.camera.position,this.scene,this.animationMgr.latestHotspotId),this.mediaManager.setCaptureMedia(!0)}},{key:"setAvatarData",value:function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.avatarsMgr.myAvatarData=Object.assign({},t);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setArRef",value:function(e){this.arLink=e.current}},{key:"animate",value:function(){var e,t;null===(e=this.stats)||void 0===e||e.begin(),Date.now()>=Fn&&(this.skybox&&this.skybox.userData.animation&&(this.skybox.rotation.y+=2e-4),this.ocean&&this.ocean.updateOcean(),this.foggy&&1==this.animationMgr.currentFloor&&!this.viewportControls.isTop?this.foggy.updateFoggy():this.foggy&&this.foggy.hide(),this.gridWave&&this.gridWave.updateWave(),Fn+=16.666666666666668,Date.now()>=Fn&&(Fn=Date.now())),this.gpuRaycaster.update(this.scene),this.viewportControls.render(this.scene),requestAnimationFrame(this.animate.bind(this)),Un.update(),this.mediaManager.mediaList.filter((function(e){return e.type===st.TAG})).forEach((function(e){null!=e.loader&&e.loader.animate()})),null===(t=this.stats)||void 0===t||t.end()}},{key:"clear",value:function(){clearInterval(this.tickIntervalId),this.tickIntervalId=null}}]),e}(),Wn=(n(293),n(13));function Gn(e,t){return e==t?"active":""}var Yn=function(e){var t=s.useState(0),n=Object(h.a)(t,2),i=n[0],a=n[1],o="/images/icon/human.svg",r="/images/icon/rectangle.svg",c="/3dviewer";return o="".concat(c,"/images/icon/human.svg"),r="".concat(c,"/images/icon/rectangle.svg"),Object(Wn.jsxs)("div",{className:"three-buttons",children:[Object(Wn.jsx)("button",{className:Gn(0,i),onClick:function(){e.godown(),a(0)},children:Object(Wn.jsx)("img",{src:o})}),Object(Wn.jsx)("button",{className:Gn(1,i),onClick:function(){e.goup(),a(1)},children:Object(Wn.jsx)("img",{src:r})})]})};function Zn(){var e=Object(s.useState)(void 0),t=Object(h.a)(e,2),n=t[0],i=t[1],a=Object(s.useState)(void 0),o=Object(h.a)(a,2),r=o[0],c=o[1],u=Object(s.useState)(!1),l=Object(h.a)(u,2),p=l[0],m=l[1],b=Object(s.useState)([]),g=Object(h.a)(b,2),w=g[0],x=g[1],O=Object(s.useState)([]),j=Object(h.a)(O,2),k=j[0],M=j[1],A=wn.inst.agoraMgr,E=A.RtcClient,T=yn.agoraAppId,C=Object(d.b)(),S=Object(d.c)((function(e){return e.cameraDeviceReducer}));Object(d.c)((function(e){return e.sceneReducer}));function I(e){return P.apply(this,arguments)}function P(){return(P=Object(v.a)(f.a.mark((function e(t){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},y.isIOS&&(n={bypassWebAudio:!0}),e.next=4,mn.a.createMicrophoneAudioTrack(n);case 4:return(i=e.sent).setVolume(150),c(i),C(Te(void 0,i)),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){return D.apply(this,arguments)}function D(){return(D=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.a.createCameraVideoTrack({});case 2:return(n=e.sent).setEncoderConfiguration("240p_3"),i(n),C(Te(n,void 0)),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return L.apply(this,arguments)}function L(){return(L=Object(v.a)(f.a.mark((function e(t,n){var a,o,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.a.createMicrophoneAndCameraTracks(t,n);case 2:return a=e.sent,o=Object(h.a)(a,2),r=o[0],(s=o[1]).setEncoderConfiguration("240p_3"),r.setVolume(150),c(r),i(s),C(Te(s,r)),e.abrupt("return",[r,s]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(v.a)(f.a.mark((function e(t,n){var i,a,o,r,s,c,u,l,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=A.sceneId,a=A.user,(o=i)||(o=i),E&&a){e.next=5;break}return e.abrupt("return");case 5:return a.type===ae.audience?E.setClientRole("audience",{level:1}):E.setClientRole("host"),e.next=8,E.join(T,o,n||null,a.id);case 8:if(!a.audio||!a.video){e.next=19;break}return e.next=11,B();case 11:return r=e.sent,s=Object(h.a)(r,2),c=s[0],u=s[1],e.next=17,E.publish([c,u]);case 17:e.next=39;break;case 19:if(!a.audio){e.next=28;break}return console.log("user only enable audio chat"),e.next=23,I();case 23:return l=e.sent,e.next=26,E.publish([l]);case 26:e.next=39;break;case 28:if(!a.video){e.next=37;break}return console.log("user only enable video chat"),e.next=32,R();case 32:return d=e.sent,e.next=35,E.publish([d]);case 35:e.next=39;break;case 37:console.log("user disabled audio and video chat"),C(Te(void 0,void 0));case 39:window.client=E,m(!0);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.client,n=void 0,i=S.audioTrack,t&&S&&S.videoTrack){e.next=11;break}return e.next=6,R();case 6:return n=e.sent,e.next=9,t.publish(n);case 9:e.next=19;break;case 11:if(!(n=S.videoTrack).enabled){e.next=17;break}return e.next=15,n.setEnabled(!1);case 15:e.next=19;break;case 17:return e.next=19,n.setEnabled(!0);case 19:C(Te(n,i));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(v.a)(f.a.mark((function e(){var t,n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.client,n=void 0,i=S.videoTrack,t&&S&&S.audioTrack){e.next=11;break}return e.next=6,I();case 6:return n=e.sent,e.next=9,t.publish(n);case 9:e.next=19;break;case 11:if(!(n=S.audioTrack).enabled){e.next=17;break}return e.next=15,n.setEnabled(!1);case 15:e.next=19;break;case 17:return e.next=19,n.setEnabled(!0);case 19:C(Te(i,n));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function H(){return(H=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r&&(r.stop(),r.close()),n&&(n.stop(),n.close()),x([]),m(!1),e.next=6,null===E||void 0===E?void 0:E.leave();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(s.useEffect)((function(){if(E){x(E.remoteUsers);var e=function(){var e=Object(v.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.subscribe(t,n);case 2:x((function(e){return Array.from(E.remoteUsers)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t=function(e){x((function(e){return Array.from(E.remoteUsers)}))},n=function(e){x((function(e){return Array.from(E.remoteUsers)}))},i=function(e){x((function(e){return Array.from(E.remoteUsers)}))};return E.on("user-published",e),E.on("user-unpublished",t),E.on("user-joined",n),E.on("user-left",i),E.enableAudioVolumeIndicator(),E.on("volume-indicator",(function(e){var t=[];e.forEach((function(e,n){t.push({id:e.uid.toString(),level:e.level}),console.log("".concat(n," UID ").concat(e.uid," Level ").concat(e.level))})),M(t)})),function(){E.off("user-published",e),E.off("user-unpublished",t),E.off("user-joined",n),E.off("user-left",i)}}}),[E]),{localAudioTrack:r,localVideoTrack:n,joinState:p,leave:function(){return H.apply(this,arguments)},setVideoTrack:z,setAudioTrack:U,joinRTC:function(e,t){return N.apply(this,arguments)},remoteUsers:w,speakUsers:k}}function Jn(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}var Kn,qn=n(94),Xn=(n(295),function(e){var t=Object(s.useRef)(null),n=Object(s.useState)("170px"),i=Object(h.a)(n,2),a=i[0],o=i[1],r=Object(s.useState)("170px"),c=Object(h.a)(r,2),u=c[0],l=c[1],p=Object(d.c)((function(e){return e.usersReducer})).filter((function(t){return t.id===e.userId})),f=p.length>0?p[0]:null,v=function(){var e=function(){return window.orientation},t=Object(s.useState)(Jn()),n=Object(h.a)(t,2),i=n[0],a=n[1],o=Object(s.useState)(e),r=Object(h.a)(o,2),c=r[0],u=r[1];return Object(s.useEffect)((function(){function t(){a(Jn())}function n(){u(e())}return window.addEventListener("resize",t),window.addEventListener("orientationchange",n),function(){window.removeEventListener("resize",t),window.removeEventListener("orientationchange",n)}}),[]),{windowDimensions:i,screenOrientation:c}}(),m=v.windowDimensions,b=v.screenOrientation;Object(s.useEffect)((function(){y.isMobile&&(90===b||-90===b?(o("".concat(.2*m.width,"px")),l("".concat(.2*m.width,"px"))):(o("".concat(.35*m.width,"px")),l("".concat(.35*m.width,"px"))))}),[m,b]),Object(s.useEffect)((function(){var n;if(t.current)return null===(n=e.videoTrack)||void 0===n||n.play(t.current),function(){var t;null===(t=e.videoTrack)||void 0===t||t.stop()}}),[t,e.videoTrack]),Object(s.useEffect)((function(){var t,n;return null===(t=e.audioTrack)||void 0===t||t.play(),null===(n=e.audioTrack)||void 0===n||n.setVolume(200),function(){var t;null===(t=e.audioTrack)||void 0===t||t.stop()}}),[e.audioTrack]);var g=qn.a.div(Kn||(Kn=Object(w.a)(["\n      position: absolute;\n      font-weight: bold;\n      font-size: 20px;\n      font-style: inherit;\n      font-family: inherit;\n      left: 50%;\n      width: 100%;\n      bottom: 5%;\n      transform: translate(-50%, -50%);\n      color: #fff;\n    "])));return Object(Wn.jsx)("div",{children:e.videoTrack&&Object(Wn.jsx)("div",{ref:t,className:"video-player",style:{width:a,height:u},children:Object(Wn.jsx)(g,{children:"local"===e.userId&&e.videoTrack?"\u60a8":f&&e.videoTrack?"".concat(f.name," (").concat(f.title,")"):""})})})});n(296);var Qn,$n,ei,ti=function(){var e,t=wn.inst.agoraMgr,n=wn.inst.avatarsMgr,i=Object(d.c)((function(e){return e.sceneReducer})),a=Object(d.c)((function(e){return e.usersReducer})),o=Object(d.c)((function(e){return e.avatarsReducer})),r=Object(d.c)((function(e){return e.avatarModeReducer})),c=Object(d.c)((function(e){return e.cameraDeviceReducer})),u=a.length>0?a[0]:null,l=Object(d.c)((function(e){return e.threeViewReducer})),p=Object(d.c)((function(e){return e.controlReducer})),m=Zn(),b=m.remoteUsers,g=m.speakUsers,y=m.joinRTC,w=function(){var e=wn.inst.agoraMgr,t=Object(s.useState)(null),n=Object(h.a)(t,2),i=n[0],a=n[1];Object(s.useEffect)((function(){if(i){var t=e.handleChannelMessage,n=e.handleMemberLeft,a=e.handleMemberJoined,o=e.handleMemberCountUpdated;return i.on("ChannelMessage",t),i.on("MemberLeft",n),i.on("MemberJoined",a),i.on("MemberCountUpdated",o),function(){i.off("ChannelMessage",t),i.off("MemberLeft",n),i.off("MemberJoined",a),i.off("MemberCountUpdated",o),e.RtmClient.logout()}}}),[i]);var o=function(){var t=Object(v.a)(f.a.mark((function t(n){var i,o,r,s,c;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.sceneId,o=e.user,r=e.RtmClient,s=r.createChannel(i),t.next=5,r.login({uid:o.id});case 5:return t.next=7,s.join();case 7:return c={name:o.name,photoUrl:o.photoUrl,type:ae[o.type],follow:" "},t.next=10,r.setLocalUserAttributes(c);case 10:e.channel=s,a(s);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{joinRTM:o}}(),x=w.joinRTM;return Object(s.useEffect)((function(){var e=function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([y(),x()]);case 2:l.setAvatarData(t.user),l.sendTickMessage();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();u&&i&&l&&(t.sceneId=i.sceneId,t.user||(t.user=Object.assign({},u)),e())}),[u,i,l]),Object(s.useEffect)((function(){p.sync?t.sendChannelMessage(an.ENABLESYNC,{}):t.sendChannelMessage(an.DISABLESYNC,{})}),[p.sync]),Object(s.useEffect)((function(){if(n.avatarData&&!r){var e,t=n.getAvatar(n.avatarData.id);t&&(null===(e=c.videoTrack)||void 0===e?void 0:e.enabled)?t.playStreamVideo(c.videoTrack):t&&t.stopStreamVideo()}}),[a,r,c]),Object(s.useEffect)((function(){b.forEach(function(){var e=Object(v.a)(f.a.mark((function e(i){var a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==Be.getState().iframeReducer&&(0,Be.getState().iframeReducer.sendMessage)(U.memberupdated,{id:i.uid,enabledVideo:i.hasVideo,enabledAudio:i.hasAudio}),i.hasAudio?(null===(a=i.audioTrack)||void 0===a||a.play(),null===(o=i.audioTrack)||void 0===o||o.setVolume(150)):console.log("".concat(i.uid," stop the audio")),r=n.getAvatar(i.uid.toString()),e.next=5,t.isFollower(i.uid.toString());case 5:e.sent&&(r=n.getAvatar(t.user.id)),r&&(i.hasVideo?r.playStreamVideo(i.videoTrack):(r.stopStreamVideo(),console.log("".concat(i.uid," stop the video"))));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[o.length,b]),Object(s.useEffect)((function(){var e=[],i=function(){var i=Object(v.a)(f.a.mark((function i(){var a,o,r;return f.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a=0;case 1:if(!(a<g.length)){i.next=12;break}if(!(g[a].level>=1)){i.next=9;break}return o=n.getAvatar(g[a].id),i.next=6,t.isFollower(g[a].id);case 6:i.sent&&(o=n.getAvatar(t.user.id)),o&&e.push(o);case 9:a++,i.next=1;break;case 12:r=n.getRemainAvatar(e),e.forEach((function(e){e.playVolumeAnimation()})),r.forEach((function(e){e.stopVolumeAnimation()}));case 15:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();i()}),[g]),Object(Wn.jsx)("div",{className:"live",children:Object(Wn.jsx)("div",{id:"players",children:r&&c&&(null===(e=c.videoTrack)||void 0===e?void 0:e.enabled)&&Object(Wn.jsx)("div",{className:"local-player-wrapper",children:Object(Wn.jsx)(Xn,{userId:"local",videoTrack:c.videoTrack,audioTrack:null})})})})},ni=n(199),ii=n.n(ni),ai=(n(297),n(355));var oi=function(){var e=wn.inst.conversationMgr,t=Object(d.c)((function(e){return e.usersReducer})),n=t.length>0?t[0]:null,i=c.a.createRef(),a=Object(s.useState)(null),o=Object(h.a)(a,2),r=o[0],u=o[1],l=qn.a.div(Qn||(Qn=Object(w.a)(["\n        overflow: hidden;\n        background-color: transparent;\n        -webkit-background-size: cover;\n        -moz-background-size: cover;\n        background-size: cover;\n        background-repeat: no-repeat;\n        background-position: center center;\n        position: relative;\n        width: 44px;\n        height: 44px;\n        margin-right: 6px;\n        cursor: pointer;\n    "]))),p=Object(qn.a)(l)($n||($n=Object(w.a)(["\n        border-radius: 50%;\n        background-image: url(",");\n    "])),(function(e){return e.thumbnail})),f=qn.a.div(ei||(ei=Object(w.a)(["\n        padding-left: 10px;\n        font-weight: 500;\n        font-size: 15px;\n        font-style: inherit;\n        font-family: inherit;\n        color: #fff;\n    "])));return Object(s.useEffect)((function(){n&&e.init(n,u)}),[n]),Object(s.useEffect)((function(){r&&i.current&&e.createSingleChatbox(i.current)}),[r,i.current]),r?Object(Wn.jsxs)("div",{style:y.isMobile||G()(navigator.userAgent)?{height:"70%",width:"80%",display:"flex",flexDirection:"column",left:"50%",top:"50%",transform:"translate(-50%, -50%)",position:"fixed",zIndex:100}:{height:"70%",width:"600px",display:"flex",flexDirection:"column",right:"50px",top:"50%",left:"auto",transform:"translate(0, -50%)",position:"fixed",zIndex:100},children:[Object(Wn.jsxs)("div",{className:"chatbox-header",children:[Object(Wn.jsxs)("div",{className:"avatar-info",children:[Object(Wn.jsx)(p,{thumbnail:r.photoUrl}),Object(Wn.jsx)(f,{children:r.name})]}),Object(Wn.jsx)("div",{className:"control-panel",children:Object(Wn.jsx)(ai.a,{size:"medium",onClick:function(){return u(null),void e.destroyChatBox()},children:Object(Wn.jsx)(ii.a,{style:{color:"white"}})})})]}),Object(Wn.jsx)("div",{id:"talkjs-container",style:{flexGrow:1},ref:function(e){i.current=e}})]}):Object(Wn.jsx)("div",{})};function ri(e){return new Promise((function(t){fetch(e).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){console.warn("media json not found"),t(void 0)}))}))}function si(){return(si=Object(v.a)(f.a.mark((function e(t){var n,i,a,o,r,s,c,u,l,h;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="./api/".concat(t,".json"),i=Be.getState().sceneReducer,a=void 0,o=void 0,r=void 0,s=void 0,c=void 0,e.next=9,ri(n);case 9:if(void 0!==(s=e.sent)){e.next=18;break}return n="".concat("https://api.metaspace.place/api","/scene?id=").concat(t),e.next=14,ri(n);case 14:void 0!=(u=e.sent)&&void 0!=u.space&&(s=u.space,delete u.space,c=u),e.next=20;break;case 18:s=(c=s).space;case 20:if(c&&null!=c.floor&&Be.dispatch(Q(c.floor)),null!==Be.getState().iframeReducer&&((0,Be.getState().iframeReducer.sendMessage)(U.sceneinfo,{name:c.name,thumbnail:c.thumbnail,imageHash:c.imageHash,music:c.music,floor:c.floor}),console.log("SDK send scene info "+c.name)),r=[],!i.tags){e.next=27;break}o=i.tags,e.next=36;break;case 27:return l="./media3d/".concat(t,".json"),e.next=30,ri(l);case 30:if(void 0!=(h=e.sent)){e.next=35;break}return e.next=34,ri("".concat("https://api.metaspace.place/api","/tag?id=").concat(t));case 34:h=e.sent;case 35:o=h||void 0;case 36:return null!==Be.getState().iframeReducer&&((0,Be.getState().iframeReducer.sendMessage)(U.taginfo,o),console.log("SDK send tag info "+c.name)),e.abrupt("return",new Promise((function(e){var t,n;s&&s.glbUrl&&s.hotSpots?e({space:s,scene:c,hotspots:s.hotSpots,tagsData:a?a.extras.tags:[],mediaObjects:null!==(t=o)&&void 0!==t?t:[],positioningObjects:null!==(n=r)&&void 0!==n?n:[]}):e(void 0)})));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ci=c.a.createContext({modalBoxDisplay:"block",setModalDisplay:function(){},url:"",setUrl:function(){},actions:{goTop:function(){},goDown:function(){}},setActions:function(){},property:{value:"",update:function(e){}},setProperty:function(){}}),ui=(n(299),function(e){var t=104*Math.PI;return Object(Wn.jsxs)("div",{className:"progressbar",children:[Object(Wn.jsx)("img",{id:"thumbnail",src:e.url.replace("256","1024")}),Object(Wn.jsx)("div",{className:"overlay"}),Object(Wn.jsx)("div",{id:"progress",children:Object(Wn.jsx)("svg",{className:"progress-ring",width:"120",height:"120",children:Object(Wn.jsx)("circle",{className:"progress-ring__circle",stroke:"white",strokeWidth:"4",strokeDasharray:"".concat(t," ").concat(t),strokeDashoffset:t-e.percent*t,fill:"transparent",r:52..toString(),cx:"60",cy:"60"})})})]})}),li=n(132),hi=n(357),di=n(358),pi=n(89),fi=n(369),vi=n(359),mi=n(361),bi=n(360),gi=Object(hi.a)((function(e){return Object(di.a)({root:{display:"flex"},details:{display:"flex",flexDirection:"column",justifyContent:"center"},content:{flex:"1 0 auto"},cover:{width:90}})})),yi=function(e){var t=gi(),n=(Object(pi.a)(),Object(d.b)()),i=wn.inst.animationMgr,a=wn.inst.mediaManager,o=e.product,r=Object(d.c)((function(e){return e.controlReducer})),s=function(e){var t,o=e.id,s=a.mediaList.filter((function(e){return e.productId&&e.productId===o}))[0];i.goNearHotspotWithAngle(s,!0,void 0,o),n((t=!r.productCatalog,{type:ge,payload:t}))};return Object(Wn.jsxs)(fi.a,{className:t.root,onClick:function(){return s(o)},children:[Object(Wn.jsx)("div",{className:t.details,children:Object(Wn.jsxs)(vi.a,{className:t.content,children:[Object(Wn.jsx)(bi.a,{component:"h6",variant:"h6",children:o.name}),Object(Wn.jsx)(bi.a,{variant:"subtitle1",color:"textSecondary",children:o.title})]})}),Object(Wn.jsx)(mi.a,{className:t.cover,image:o.thumbnail,title:o.name})]})},wi=Object(hi.a)((function(e){return Object(di.a)({cards:{position:"fixed",bottom:"5%",left:"50%",transform:"translate(-50%, 0)",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",width:500,"@media (min-width: 1000px)":{width:1e3}},card:{"@media (min-width: 1000px)":{width:300},width:130,paddingRight:15,paddingBottom:15,cursor:"pointer"}})}));function xi(){var e=wi(),t=(Object(pi.a)(),Object(d.c)((function(e){return e.productsReducer})));return Object(Wn.jsx)("div",{className:e.cards,children:t.map((function(t){return Object(Wn.jsx)("div",{className:e.card,children:Object(Wn.jsx)(yi,{product:t},t.id)})}))})}n(368),n(209),n(367),n(208),n(207),n(206),n(205),n(202),n(203),n(204),n(201),n(200),Object(hi.a)((function(e){return Object(di.a)({speedDial:{position:"fixed",bottom:50,right:50},fab:{backgroundColor:"#29333E"}})}));function Oi(){Object(d.b)();var e=function(e){try{if("string"===typeof e.data)JSON.parse(e.data).command}catch(t){console.error(t)}};return Object(s.useEffect)((function(){return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}}),[]),{sendMessage:function(e,t){window&&window.parent&&window.parent.postMessage(JSON.stringify({command:U[e],data:t}),"*")}}}n(179);var ji=n(130),ki=n.n(ji),Mi=Object(hi.a)({tooltip:{display:"-webkit-box",position:"fixed",overflow:"hidden",zIndex:2,maxWidth:120,"-webkit-line-clamp":3,"-webkit-box-orient":"vertical",textAlign:"left",pointerEvents:"none",textOverflow:"ellipsis",color:"white",borderRadius:3,fontSize:14,padding:"2px 6px",backgroundColor:"rgba(0,0,0,0.7)"}}),Ai=function(){var e=Mi(),t=Be.getState().threeViewReducer,n=c.a.useState(null),i=Object(h.a)(n,2),a=i[0],o=i[1],r=c.a.useState({x:0,y:0}),s=Object(h.a)(r,2),u=s[0],l=s[1],d=c.a.useRef(""),p=[st.GIF,st.TAG,st.PHOTO,st.MODEL];return c.a.useEffect((function(){null!=t&&(t.events.on(Tn.raycastMouseEnter,(function(e){var n=t.viewportControls.getSrceenCoordinate(e.object.position);p.includes(e.type)&&n&&!e.json.unclickable&&e.showTitle&&(o(e.json),l({x:100*n.x,y:100*n.y}),d.current=e.json.id,document.body.style.cursor="pointer",t.mousecursor.visible=!1)})),t.events.on(Tn.raycastMouseLeave,(function(e){d.current===e.json.id&&(o(null),document.body.style.cursor="auto"),t.mousecursor.visible=!0})))}),[t]),a?Object(Wn.jsx)("div",{className:ki()("no-select",e.tooltip,{display:0===a.name.length?"none":"block"}),style:{left:u.x+"%",top:u.y+"%"},children:a.title}):null},Ei=n(214),Ti=n.n(Ei),Ci=n(212),Si=n.n(Ci),Ii=n(213),Pi=n.n(Ii),Ri=n(211),Di=n.n(Ri),Bi=n(215),Li=n.n(Bi),Ni=n(136),zi=n.n(Ni),Ui=n(46),Hi=function(){var e,t,n=Be.getState().threeViewReducer,i=c.a.useState(!1),a=Object(h.a)(i,2),o=a[0],r=a[1],s=c.a.useState(null),u=Object(h.a)(s,2),l=u[0],d=u[1],p=c.a.useState({x:0,y:0}),f=Object(h.a)(p,2),v=f[0],m=f[1],b=c.a.useState(0),g=Object(h.a)(b,2),w=(g[0],g[1]),x=c.a.useRef(null),O=c.a.useReducer((function(e){return e+1}),0),j=Object(h.a)(O,2),k=(j[0],j[1]);return c.a.useEffect((function(){null!=n&&(n.events.on(Tn.raycastMouseEnter,(function(e){if(e instanceof Ht){var t,i=n.viewportControls.getSrceenCoordinate(e.object.position);if(i&&!n.viewportControls.isTop)x.current=e.videoPlayer,null===(t=x.current)||void 0===t||t.getVolume().then(w),d(e),r(!0),m({x:100*i.x,y:100*i.y}),document.body.style.cursor="pointer",n.mousecursor.visible=!1}})),n.events.on(Tn.raycastMouseLeave,(function(e){e instanceof Ht&&(x.current=null,r(!1),d(null),document.body.style.cursor="auto"),n.mousecursor.visible=!0})))}),[n]),Object(Wn.jsxs)("div",{style:{position:"fixed",left:v.x+"%",top:v.y+"%",backgroundColor:"rgba(255,255,255, 0.6)",padding:"3px 8px",borderRadius:5,zIndex:2,fontSize:10,display:o?"block":"none"},className:ki()("no-select"),children:[Object(Wn.jsx)(zi.a,{size:"small",onClick:function(){n.handleOpenComponent(l)},children:Object(Wn.jsx)(Di.a,{})}),!y.isMobile&&!Ui(navigator.userAgent)&&Object(Wn.jsx)(zi.a,{size:"small",onClick:function(){n.handleVideoPlay(l,!1),k()},children:(null===(e=x.current)||void 0===e?void 0:e.isPlaying)?Object(Wn.jsx)(Si.a,{}):Object(Wn.jsx)(Pi.a,{})}),Object(Wn.jsx)(zi.a,{size:"small",onClick:function(){n.handleAudioPlay(l),k()},children:(null===(t=x.current)||void 0===t?void 0:t.isMuted)?Object(Wn.jsx)(Ti.a,{}):Object(Wn.jsx)(Li.a,{})})]})},Vi=n(322);function Fi(e){var t=s.useContext(ci).setModalDisplay,n=s.useState(0),i=Object(h.a)(n,2),a=(i[0],i[1]),o=s.useState(""),r=Object(h.a)(o,2),u=(r[0],r[1]),l=Object(d.c)((function(e){return e.usersReducer})),p=l.length>0?l[0]:null,m=s.useState(!0),b=Object(h.a)(m,2),g=b[0],w=b[1],x=s.useContext(ci),O=(x.actions,x.setActions),j=s.createRef(),k=s.useState(null),M=Object(h.a)(k,2),A=M[0],E=M[1],T=Object(d.b)(),C=Oi(),S=Object(d.c)((function(e){return e.controlReducer})),I=Object(d.c)((function(e){return e.tagReducer})),P=Object(d.c)((function(e){return e.sceneReducer}));!function(){var e,t,n,i,a,o,r=Object(d.b)(),u=c.a.useContext(ci).actions,l=Object(d.c)((function(e){return e.floorReducer})),h=Object(d.c)((function(e){return e.avatarModeReducer})),p=Object(d.c)((function(e){return e.threeViewReducer})),m=Object(d.c)((function(e){return e.cameraDeviceReducer})),b=Zn(),g=b.setVideoTrack,y=b.setAudioTrack;Object(s.useEffect)((function(){void 0!=u&&(n=wn.inst.avatarsMgr,t=wn.inst.animationMgr,a=wn.inst.agoraMgr,o=wn.inst.conversationMgr,window.users={enableMicrophone:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(null===(t=m.audioTrack)||void 0===t?void 0:t.enabled)||p.controlAllVideoAudios(!0),e.next=4,y();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),enableVideo:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setAvatarAnimation:function(e){"animation"in e&&(n.animation=e.animation)},enableAvatarMode:function(){var e=Object(v.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=!h)?n.enableScreenAvatar(!1):n.enableScreenAvatar(!0),r(pe(t));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),inviteMember:function(){var e=Object(v.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.isFollowing;case 2:e.sent||a.sendChannelMessage(an.INVITEFOLLOW,{});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),followMember:function(e){"id"in e&&(n.enableFollowerAvatar(e.id,!0),r(pe(!1)),a.follow(e.id))},unFollowMember:function(){n.enableFollowerAvatar("",!1),a.unfollow(),a.sendChannelMessage(an.DISABLESYNC,{})},chatMember:function(e){if("id"in e){var t=a.getChannelUser(e.id);o.createConversation(t)}}})}),[u,m,h]),Object(s.useEffect)((function(){return void 0==u?(e=wn.inst.mediaManager,t=wn.inst.animationMgr,n=wn.inst.avatarsMgr,window.init=function(e){wn.inst.sdkKey=e},window.setUser=function(){var e=Object(v.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"id"in t&&"photoUrl"in t&&"bodyImageUrl"in t&&(n={id:t.id,photoUrl:t.photoUrl,bodyImageUrl:t.bodyImageUrl,animations:t.animations,type:ae[t.type],name:t.name,isVertical:!0,followCamera:!0,video:t.type!=ae[ae.audience]&&t.video,audio:t.type!=ae[ae.audience]&&t.audio},r(se(n)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),window.setScene=function(){var e=Object(v.a)(f.a.mark((function e(t){var n,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=wn.inst.sdkKey)||(n=t.key),i="".concat("https://api.metaspace.place/api","/enterprise?key=").concat(n),e.next=5,ri(i);case 5:e.sent.verify?"sceneId"in t&&r({type:K,payload:{sceneId:(a=t).sceneId,tags:a.tags,sdkDebug:a.sdkDebug,userId:a.userId,camera:a.camera,mic:a.mic}}):console.warn("sdk key invaild!");case 7:case"end":return e.stop()}var a}),e)})));return function(t){return e.apply(this,arguments)}}(),window.getMediaList=function(){return e.toJson()}):u&&(t=wn.inst.animationMgr,i=wn.inst.viewportController,e=wn.inst.mediaManager,window.setDollHouseMode=function(){i.isTop?t.godown():t.goTop()},window.getAllHotspots=function(e){var n=Object.keys(t.hotspotdict),i=[];return n.forEach((function(n){var a=t.hotspotdict[n];e?a.floor===e&&i.push(a):i.push(a)})),i},window.enableHotspots=function(t){e.hideAllHotspots(t)},window.controls={goTagLocation:function(){var n=Object(v.a)(f.a.mark((function n(i){var a,o;return f.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,a=e.mediaList.filter((function(e){return e.id===i})),!(a.length>0)){n.next=6;break}return o=a[0],n.next=6,t.goNearHotspotWithAngle(o);case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}(),getCameraInformation:function(){var e=t.latestHotspotId;if(e)return{floor:t.currentFloor,position:{x:t.hotspotdict[e].position.x,y:t.hotspotdict[e].position.y,z:t.hotspotdict[e].position.z},hotspotId:t.latestHotspotId,azimuthAngle:i.azimuthAngle,polarAngle:i.polarAngle}},goHotspotLocation:function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!("hotspotId"in n)){e.next=4;break}return e.next=4,t.goHotspot(n.hotspotId,void 0,n.polarAngle,n.azimuthAngle);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),goFloorLocation:function(){var e=Object(v.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.goFloorWithNumber(n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),setDollHouseMode:function(){i.isTop?t.godown():t.goTop()}},window.getAllFloorNumbers=function(){try{var e=[];return Object.keys(t.hotspotdict).forEach((function(n){var i=t.hotspotdict[n];e.includes(i.floor)||e.push(i.floor)})),e}catch(n){console.log(n)}},window.closeComponent=function(t){var n=t.id,i=Be.getState().threeViewReducer,a=e.mediaList.filter((function(e){return e.id===n}))[0];if(a instanceof Ht){var o=a;i.handleVideoPlay(o)}else i.handleVideoPlay(null);Be.dispatch(Oe(null,!1))}),function(){}}),[u,l])}(),Object(s.useEffect)((function(){console.log("OSENSE Viewer SDK VERSION: "+Vi.version)}),[Vi]),Object(s.useEffect)((function(){I&&(I.visible?t("block"):t("none"))}),[I]);Object(s.useEffect)((function(){var e;T((e=C.sendMessage,{type:ee,payload:{sendMessage:e}}))}),[]),Object(s.useEffect)((function(){if(null!==P&&null===A){var e=new _n(P.userId,P.sdkDebug);return E(e),T({type:Z,payload:e}),T((t=re.Viewer,{type:Se,payload:t})),R(e,P.sceneId),function(){e.clear()}}var t}),[P]),Object(s.useEffect)((function(){}),[]);var R=function(t,n){(function(e){return si.apply(this,arguments)})(n).then((function(n){n?(u(n.space.thumbnail),t.init(n,e.userId,(function(e){C.sendMessage(U.progressbar,e.loaded/e.total*.99),a(e.loaded/e.total*.99)})).then((function(){C.sendMessage(U.progressbar,1),a(1)}))):w(!1)})),t.animate(),O({goDown:t.godown,goTop:t.goup}),t.setArRef(j)};return Object(Wn.jsxs)("div",{className:"viewerContainer",children:[Object(Wn.jsx)("div",{id:"css3d"}),Object(Wn.jsx)("canvas",{id:"three-root"}),y.isIOS&&Object(Wn.jsx)("a",{rel:"ar",href:"model.usdz",ref:j,children:Object(Wn.jsx)("img",{})}),Object(Wn.jsx)(Hi,{}),Object(Wn.jsx)(Ai,{}),Object(Wn.jsx)(li.a,{onChange:function(e){(y.isMobile||G()(navigator.userAgent))&&e&&A&&A.playVideos()}}),p&&Object(Wn.jsx)(ti,{}),p&&Object(Wn.jsx)(oi,{}),!1,S.productCatalog&&Object(Wn.jsx)(xi,{}),!1,!1,!g&&Object(Wn.jsx)("div",{id:"error",children:Object(Wn.jsx)("span",{children:Object(Wn.jsxs)("h1",{children:["Space ","".concat(e.buildingId)," not found."]})})})]})}var _i=n(148),Wi=n(32);function Gi(e){var t=s.useContext(ci).setModalDisplay,n=s.useState(0),i=Object(h.a)(n,2),a=i[0],o=(i[1],s.useState("")),r=Object(h.a)(o,2),c=r[0],u=(r[1],s.useState(!0)),l=Object(h.a)(u,2),p=l[0],f=(l[1],s.useState({godown:function(){},goup:function(){}})),v=Object(h.a)(f,2),m=v[0],b=(v[1],s.useState(null)),g=Object(h.a)(b,2),y=g[0],w=(g[1],Object(d.b)(),Oi(),Object(d.c)((function(e){return e.controlReducer})),Object(d.c)((function(e){return e.tagReducer})));Object(d.c)((function(e){return e.sceneReducer}));Object(s.useEffect)((function(){w&&(w.visible?t("block"):t("none"))}),[w]);Object(s.useEffect)((function(){}),[]);return Object(Wn.jsxs)("div",{className:"viewerContainer",children:[Object(Wn.jsx)("div",{id:"css3d"}),Object(Wn.jsx)("canvas",{id:"three-root"}),Object(Wn.jsx)(li.a,{onChange:function(e){e&&y&&y.playVideos()}}),Object(Wn.jsx)(Yn,{godown:m.godown,goup:m.goup}),1!==a&&Object(Wn.jsx)(ui,{url:c,percent:a}),!p&&Object(Wn.jsx)("div",{id:"error",children:Object(Wn.jsx)("span",{children:Object(Wn.jsxs)("h1",{children:["Space ","".concat(e.buildingId)," not found."]})})})]})}function Yi(e){var t=e.location.pathname,n=new URLSearchParams(Object(Wi.f)().search),i=n.get("id"),a=n.get("userId");return"/template"===t.toLowerCase()?Object(Wn.jsx)(Gi,{buildingId:i}):Object(Wn.jsx)(Fi,{buildingId:i,userId:a})}var Zi=function(){var e=c.a.useState({value:"",update:function(e){}}),t=Object(h.a)(e,2),n=t[0],i=t[1],a=c.a.useState(void 0),o=Object(h.a)(a,2),r=o[0],s=o[1],u=c.a.useState("none"),l=Object(h.a)(u,2),p=l[0],f=l[1],v=c.a.useState(""),m=Object(h.a)(v,2),b={modalBoxDisplay:p,setModalDisplay:f,url:m[0],setUrl:m[1],actions:r,setActions:s,property:n,setProperty:i};return Object(Wn.jsx)(d.a,{store:Be,children:Object(Wn.jsx)("div",{className:"App",children:Object(Wn.jsx)(ci.Provider,{value:b,children:Object(Wn.jsx)(_i.a,{children:Object(Wn.jsx)(Wi.c,{children:Object(Wn.jsx)(Wi.a,{path:"/*",exact:!0,component:Yi})})})})})})},Ji=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,372)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),i(e),a(e),o(e),r(e)}))};l.a.render(Object(Wn.jsx)(c.a.StrictMode,{children:Object(Wn.jsx)(Zi,{})}),document.getElementById("root")),Ji()}},[[324,1,2]]]);